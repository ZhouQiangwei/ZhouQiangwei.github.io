<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Qiangwei&#39;s blog</title>
  
  <subtitle>coding and learning</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhouqiangwei.github.io/"/>
  <updated>2019-04-10T06:13:31.267Z</updated>
  <id>https://zhouqiangwei.github.io/</id>
  
  <author>
    <name>Qiangwei</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>project-dayday</title>
    <link href="https://zhouqiangwei.github.io/2019/04/08/project-dayday/"/>
    <id>https://zhouqiangwei.github.io/2019/04/08/project-dayday/</id>
    <published>2019-04-08T07:16:20.000Z</published>
    <updated>2019-04-10T06:13:31.267Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="不同基因组位置转换liftover"><a href="#不同基因组位置转换liftover" class="headerlink" title="不同基因组位置转换liftover"></a>不同基因组位置转换liftover</h3><p>方法一：Picard，可以参考mm9tomm10vcf文章。<br>方法二：UCSC liftover<br><code>wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/liftOver</code><br>但是这个liftover二进制文件是编译后的，与目前系统不符合。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[14:01:45] qwzhou@node102:~ :</span><br><span class="line">$ ./liftOver</span><br><span class="line">./liftOver: /lib64/libc.so.6: version `GLIBC_2.14<span class="string">' not found (required by ./liftOver)</span></span><br><span class="line"><span class="string">./liftOver: /lib64/libc.so.6: version `GLIBC_2.17'</span> not found (required by ./liftOver)</span><br></pre></td></tr></table></figure></p><p><code>https://genome.sph.umich.edu/wiki/LiftOver#Binary_liftOver_tool</code><br>方法三：CrossMap<br><code>wget https://sourceforge.net/projects/crossmap/files/CrossMap-0.3.4.tar.gz</code><br>因为0.2.9以上版本需要python3，重新下载低版本<br><code>wget https://sourceforge.net/projects/crossmap/files/CrossMap-0.2.9.tar.gz</code><br>安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install --root=/public/home/qwzhou/software/CrossMap-0.2.9</span><br><span class="line">... 安装失败</span><br></pre></td></tr></table></figure></p><p>还是用方法一吧。。。<br>首先，转文件为vcf格式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[13:46:41] qwzhou@comput54:~/practice/k562/WGBS :</span><br><span class="line">$ awk -v OFS=<span class="string">"\t"</span> <span class="string">'ARGIND==1 &amp;&amp; $1~/^#/&#123;print $0&#125;ARGIND==2 &amp;&amp; FNR&gt;1&#123;print "chr"$1,$2,".",$3,$4,"600\tPASS\t.\tGT\t0/1"&#125;'</span> wgbs.replace.mdups.snp.filtered.sort.vcf tum.letters.haplotyped_across_tumor.passing.cleaned.called.txt &gt; tum.letters.haplotyped_across_tumor.passing.cleaned.called.vcf</span><br></pre></td></tr></table></figure></p><p>下载hg19 to hg38 chain文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[13:48:58] qwzhou@login:~/practice/Genome/hg38 :</span><br><span class="line">$ wget http://hgdownload.soe.ucsc.edu/goldenPath/hg19/liftOver/hg19ToHg38.over.chain.gz</span><br><span class="line">gunzip hg19ToHg38.over.chain.gz</span><br></pre></td></tr></table></figure></p><p>运行liftover：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[13:47:36] qwzhou@comput54:~/practice/k562/WGBS :</span><br><span class="line">$ java -jar ~/software/picard.jar LiftoverVcf I=tum.letters.haplotyped_across_tumor.passing.cleaned.called.vcf O=tum.letters.haplotyped_across_tumor.passing.cleaned.called.hg38.vcf CHAIN=~/practice/Genome/hg38/hg19ToHg38.over.chain REJECT=rejected_variants.vcf R=~/practice/Genome/hg38/hg38.chr.fa</span><br></pre></td></tr></table></figure></p><p><strong>运行错误</strong>，这里无法确认allle1与allele2哪个是ref哪个是var，不能改转vcf。还是想办法用bed格式。<br>测试方法二中liftover，在142发现可以正常运行：<br>运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[14:11:49] qwzhou@mn02:~/hapvswgs :</span><br><span class="line">$ ../liftOver tum.letters.haplotyped_across_tumor.passing.cleaned.called.bed hg19ToHg38.over.chain.gz k562.bed k562.unlifted.bed</span><br></pre></td></tr></table></figure></p><p>发现输出文件为空，查阅后发现，我们转换的bed格式不准确，需要间隔1bp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[13:58:40] qwzhou@comput54:~/practice/k562/WGBS :</span><br><span class="line">$ awk -v OFS=<span class="string">"\t"</span> <span class="string">'FNR&gt;1&#123;print "chr"$1,$2,$2+1,$3,$4&#125;'</span> tum.letters.haplotyped_across_tumor.passing.cleaned.called.txt &gt; tum.letters.haplotyped_across_tumor.passing.cleaned.called.bed</span><br></pre></td></tr></table></figure></p><p>可用工具汇总：<br><code>https://www.biostars.org/p/65558/</code></p><h3 id="vector-deque-list-效率比较"><a href="#vector-deque-list-效率比较" class="headerlink" title="vector/deque/list 效率比较"></a>vector/deque/list 效率比较</h3><p>==================================================<br>DNA甲基化单倍型组装 methyhaplo<br>数据运行过程速度太慢，运行大约近一周时间，进度只完成一半左右。检查原因：<br>1，读取bam文件，需要处理每条序列，删选可能的潜在C位点，之后根据该位点覆盖度计算valid C位点，实际有很多序列无需进行这一步处理，因为C位点不满足我们的要求（validC - coverage &gt;=4 and hetero-methylation）。<br>解决办法：<br>读入甲基化位点文件，methratio，根据位点甲基化覆盖度以及水平来对read进行处理，为满足该条件的位点的覆盖read不做任何处理。</p><p>2，read的甲基化state：SSSSShx==x==z===========hh=====h=x====hh====hx=========D==============Ih========h=============x=====h=hhh=x=T=Z=hx<br>我们在获取序列第i位点信息时，计算方法为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(;ReadStep&lt;<span class="built_in">strlen</span>(read.methState);ReadStep++)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">if</span>(RealLen==index) <span class="keyword">break</span>;</span><br><span class="line">             <span class="keyword">if</span>(read.methState[ReadStep] == <span class="string">'S'</span> || read.methState[ReadStep] == <span class="string">'I'</span>)</span><br><span class="line">             &#123;</span><br><span class="line">                     <span class="keyword">continue</span>;</span><br><span class="line">             &#125;<span class="keyword">else</span> <span class="keyword">if</span>(read.methState[ReadStep] == <span class="string">'D'</span>)</span><br><span class="line">             &#123;</span><br><span class="line">                     RealLen++;</span><br><span class="line">                     <span class="keyword">continue</span>;</span><br><span class="line">             &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                     RealLen++;</span><br><span class="line">             &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></p><p>需要对read做循环处理，但是由于每条read上可能存在n个validC，因此该序列可能需要被计算n次。<br>解决办法：<br>在第一次处理时，将S，I替换为’’。然后或许该序列i位置信息方法，read.methstate[i]。</p><p>但是在将这些部分预期可能的耗时地方注释掉之后，程序时间有了一定的提高，但是非常不理想。进一步检查可能的原因，在检查代码过程中，想到代码中对vector进行了大量的操作。对vector的内存机制查看之前的资料发现，因为我们存储的read处理之后需要从vector头部删掉erase（vector.begin()），vector在erase操作后实际减少了本身的size但是vector本身操作需要申请一段连续的内存地址，在capacity不够是会以0.5~1倍的空间增大，而erase删除存储单元后，vector本身的capacity并不会减少，因此会出现随着数据运行vector的size是波动的（1-10000左右），但是capacity是随着处理read的增加一直在增加的。<br>解决办法：<br>1，在初始化vector时，定义该vector的内存容量capacity（reserve(50000)），并且在处理过程中需要定期释放以及删除的内存区域，我们知道在C++中vector的删除v1.clear()只会删掉所有size，但并未释放capacity内存区域，需要我们释放即将v1与空vector进行交换：vector<t>().swap(v1)，而根据vector size大小删除未占用的内存是类似的操作：（vector<t>(v1).swap(v1)）。<br>效果：在完成该操作后，我们对程序的占用内存进行查看（ps aux），发现内存的增加以及vector的capacity是稳定的（初始化大小50000），不会随read的处理而无限的增大，但是对时间的改善很小。<br>进一步寻找原因：<br>我们知道vector需要申请一段连续的内存地址，在进行尾端的插入以及删除erase时不会对整个vector的内存地址发生改变，但是如果我们需要在vector的首端进行删除erase（这是我们程序中一直在操作的内容），vector在去掉首端的第一个元素后，剩下的元素会全部迁移一个单位，这是非常耗时的操作，因为一开始网上未找到有实际时间验证的信息，所以对vector、list、deque的添加 <strong>插入删除</strong> 所需要的时间进行测试：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">###<span class="meta">#testvector.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">int</span> y;</span><br><span class="line">        Point():x(<span class="number">0</span>),y(<span class="number">0</span>)</span><br><span class="line">        &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">clock_t</span> s1,f1,s2,f2,s3,f3;</span><br><span class="line">        <span class="keyword">int</span> N=<span class="number">1000000</span>;</span><br><span class="line">        s1=clock();</span><br><span class="line">        <span class="built_in">vector</span>&lt;Point&gt; point_vec(N);</span><br><span class="line">        f1=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f1-s1)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        s3=clock();</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=N;i++) &#123;</span><br><span class="line">                Point P;</span><br><span class="line">                point_vec.push_back(P);</span><br><span class="line">        &#125;</span><br><span class="line">        f3=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f3-s3)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        s2=clock();</span><br><span class="line">        <span class="keyword">while</span>(point_vec.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                point_vec.erase(point_vec.begin());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        f2=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f2-s2)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></t></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">##<span class="meta">#testlist.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">int</span> y;</span><br><span class="line">        Point():x(<span class="number">0</span>),y(<span class="number">0</span>)</span><br><span class="line">        &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">clock_t</span> s1,f1,s2,f2,s3,f3;</span><br><span class="line">        <span class="built_in">list</span>&lt;Point&gt; point_vec;</span><br><span class="line">        s1=clock();</span><br><span class="line">        <span class="keyword">int</span> i;<span class="keyword">int</span> N=<span class="number">10000000</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=N;i++) &#123;</span><br><span class="line">                Point P;</span><br><span class="line">                point_vec.push_front(P);</span><br><span class="line">        &#125;</span><br><span class="line">        f1=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f1-s1)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        s3=clock();</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=N;i++) &#123;</span><br><span class="line">                Point P;</span><br><span class="line">                point_vec.push_back(P);</span><br><span class="line">        &#125;</span><br><span class="line">        f3=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f3-s3)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        s2=clock();</span><br><span class="line">        <span class="keyword">while</span>(point_vec.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                point_vec.pop_front();</span><br><span class="line">        &#125;</span><br><span class="line">        f2=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f2-s2)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">###<span class="meta">#testdeque.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">int</span> y;</span><br><span class="line">        Point():x(<span class="number">0</span>),y(<span class="number">0</span>)</span><br><span class="line">        &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">clock_t</span> s1,f1,s2,f2,s3,f3;</span><br><span class="line">        <span class="built_in">deque</span>&lt;Point&gt; point_vec;</span><br><span class="line">        s1=clock();</span><br><span class="line">        <span class="keyword">int</span> i;<span class="keyword">int</span> N=<span class="number">10000000</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=N;i++) &#123;</span><br><span class="line">                Point P;</span><br><span class="line">                point_vec.push_front(P);</span><br><span class="line">        &#125;</span><br><span class="line">        f1=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f1-s1)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        s3=clock();</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=N;i++) &#123;</span><br><span class="line">                Point P;</span><br><span class="line">                point_vec.push_back(P);</span><br><span class="line">        &#125;</span><br><span class="line">        f3=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f3-s3)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        s2=clock();</span><br><span class="line">        <span class="keyword">while</span>(point_vec.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                point_vec.pop_front();</span><br><span class="line">        &#125;</span><br><span class="line">        f2=clock();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="keyword">double</span>)(f2-s2)/CLOCKS_PER_SEC&lt;&lt;<span class="string">" S"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要测试内容为插入N个元素 尾端插入、首端插入、首端删除：<br>1，N=100000<br>结果：<br>vector：<br>0.001484 S<br>0.004673 S<br>3.4818 S<br>list：<br>0.017136 S<br>0.016473 S<br>0.022026 S<br>deque:<br>0.004028 S<br>0.004597 S<br>0.002443 S<br>2,N=1000000<br>结果：<br>vector:<br>0.013873 S<br>0.048349 S<br>1112.85 S<br>list:<br>0.154731 S<br>0.157853 S<br>0.217059 S<br>deque:<br>0.038313 S<br>0.047 S<br>0.025429 S<br>结论：从我们结果可以看出我们在vector、list、deque测试中，首端以及尾端的插入vector以及deque要快于list，但是在进行首端的删除时deque &gt; list &gt;&gt;vector，deque大约时vector的1000倍以上，而且随着元素数增大时间差别更大。红色显示为最慢时间，绿色为最快。而对三者的尾端删除以及中间插入删除因为程序中不需要这部分操作因此并未进行测序。<br>在查阅资料中看到有测试显示list&gt;deque （<a href="https://baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html#），进一步发现同样有做过详细的测试工作针对deque、list、vector等，结论也是首端删除deque&gt;" target="_blank" rel="noopener">https://baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html#），进一步发现同样有做过详细的测试工作针对deque、list、vector等，结论也是首端删除deque&gt;</a> list &gt;&gt; vector （<a href="http://www.cppblog.com/sailing/articles/161659.html）。" target="_blank" rel="noopener">http://www.cppblog.com/sailing/articles/161659.html）。</a><br>因此修改程序内vector为deque，由于vector Pvalues，并未进行erase操作，而且我们需要对Pvalue完成排序以及逆向计算Qvalues，而我们查到的资料显示后向遍历deque最快但是与vector以及list相差不大，不做更改，查找资料显示逆向遍历时间。（当然这部分可以更改，未更改原因我们需要进行排序：1，sort同样适合deque 2，但是deque复杂度大，因此对deque的操作不如直接使用vector，并且认为时间相差不大。）<br>接下来还是要将vector Pvalue改为deque测试比较一下（强迫症难受）<br>vector list deque<br>0.885 0.879 0.690。</p><p>将文档中所有vector（除Pvalue外）改为deque后，结果：</p><ol><li>处理10000条序列：<br>samtools view -h -f 96,144 A549.methstate.sort.bam | head -10000 &gt; test.sam<br>取正链10000条序列。（但是在测试中发现程序中负链函数同样启动了，检查原因发现我们忽略了一些情况，例如：0x200  QCFAIL        .. not passing quality controls以及正负链同样出现在同一read中，这种情况不明白原因，后续需要解决。先完成时间测试）<br>old version（vector）<br>start time： 16:37:24<br>end time：16:38:35<br>total time: 71s<br>new version (deque)<br>start time: 16:39:05<br>end time: 16:39:08<br>total time: 3s</li></ol><p>2,处理30000条序列：<br>samtools view -h -f 96,144 A549.methstate.sort.bam | head -30000 &gt; test.sam<br>old version<br>start：16:42:33<br>end：16:54:57<br>time：744s<br>new version：<br>start ：16:41:12<br>end： 16:41:22<br>total：10s<br>结论：因为3万条序列后，随着序列增加old version需要时间太久，不做进一步测试，但是我们同样可以看到新的版本修改deque后时间效率具有非常明显的提高。</p><h3 id="R-取某列"><a href="#R-取某列" class="headerlink" title="R, 取某列"></a>R, 取某列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ma&lt;-a[c(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)]</span><br></pre></td></tr></table></figure><h3 id="R-添加列名"><a href="#R-添加列名" class="headerlink" title="R, 添加列名"></a>R, 添加列名</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">names(profile_text)=c(<span class="string">"chr"</span>,<span class="string">"coord"</span>,<span class="string">"SNV"</span>, <span class="string">"MethSNV.SNV"</span>, <span class="string">"MethSNV"</span>)</span><br></pre></td></tr></table></figure><h3 id="R-每一列一个样本，画点图、boxplot、线图"><a href="#R-每一列一个样本，画点图、boxplot、线图" class="headerlink" title="R, 每一列一个样本，画点图、boxplot、线图"></a>R, 每一列一个样本，画点图、boxplot、线图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">profile_text &lt;- read.table(&quot;C:/Users/qwzhou/Desktop/code/phaseddensity.chr1.txt&quot;, header=T, row.names=1, quote=&quot;&quot;)</span><br><span class="line">#names(profile_text)=c(&quot;chr&quot;,&quot;coord&quot;,&quot;SNV&quot;, &quot;MethSNV.SNV&quot;, &quot;MethSNV&quot;)</span><br><span class="line">#head(profile_text)</span><br><span class="line">#Meth.SNP SNP Meth.SNP.SNP. </span><br><span class="line">#10000       10             3   3</span><br><span class="line">#10001       34            28  30</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(reshape2)</span><br><span class="line">profile_text$xvariable = rownames(profile_text)</span><br><span class="line">data_m &lt;- melt(profile_text, id.vars=c(&quot;xvariable&quot;))</span><br><span class="line">data_m$xvariable &lt;- as.numeric(data_m$xvariable)</span><br><span class="line">## 点图</span><br><span class="line">p &lt;- ggplot(data_m, aes(x=xvariable, y=value,color=variable,group=variable)) +geom_point() +ylim(0,100)#+ stat_smooth(method=&quot;auto&quot;, se=FALSE) + theme(legend.position=c(0.85,0.2))</span><br><span class="line">p</span><br><span class="line">## boxplot</span><br><span class="line">data_m$value &lt;- pmin(data_m$value,100)</span><br><span class="line">p &lt;- ggplot(data_m, aes(x=variable, y=value,color=variable,group=variable)) +geom_boxplot()</span><br><span class="line">p</span><br><span class="line">## 线图</span><br><span class="line">data_m2&lt;-data_m[data_m$variable!=&quot;MethSNV&quot;,]</span><br><span class="line">p &lt;- ggplot(data_m2, aes(x=xvariable, y=value,color=variable,group=variable)) + stat_smooth(method=&quot;auto&quot;, se=FALSE)</span><br><span class="line">p +labs(title=&quot;&quot;,x=&quot;&quot;, y = &quot;Phased number&quot;)+</span><br><span class="line">  theme_bw() + ## 背景</span><br><span class="line">  theme(panel.grid =element_blank()) + ## 删去网格线</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.5, size = 18, colour = &quot;black&quot;, face = &quot;bold&quot;) ,axis.title.y = </span><br><span class="line">          element_text(size=16,colour = &quot;black&quot;,face = &quot;bold&quot;), </span><br><span class="line">        axis.text.y = element_text(size=10, colour = &quot;black&quot;), </span><br><span class="line">        axis.text.x = element_text(size=16, colour = &quot;black&quot;), legend.position = c(0.85,0.5))</span><br></pre></td></tr></table></figure><h3 id="sort-vcf"><a href="#sort-vcf" class="headerlink" title="sort vcf"></a>sort vcf</h3><p>chr_order目前是必须指定的，其实可以根据bam/genome生成某一文件包含所有染色体名<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">input=$1</span><br><span class="line">out=$2</span><br><span class="line">chr_order="chrM\nchr1\nchr2\nchr3\nchr4\nchr5\nchr6\nchr7\nchr8\nchr9\nchr10\nchr11\nchr12\nchr13\nchr14\nchr15\nchr16\nchr17\nchr18\nchr19\nchr20\nchr21\nchr22\nchrY\nchrX"</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> -e <span class="variable">$chr_order</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">do</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="built_in">echo</span> <span class="variable">$line</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">done</span></span></span><br><span class="line">cat $input | grep "^#" &gt; .header.vcf</span><br><span class="line">cat $input | grep -v "^#" | sort -k1,1 -k2,2n &gt; .pre.sorted.vcf</span><br><span class="line">echo -e $chr_order | while read line</span><br><span class="line">do</span><br><span class="line">    cat .pre.sorted.vcf | grep "^$line"$'\t' &gt;&gt; .header.vcf</span><br><span class="line">done</span><br><span class="line">mv .header.vcf  $&#123;out&#125; &amp;&amp; rm .pre.sorted.vcf</span><br></pre></td></tr></table></figure></p><h3 id="DNA甲基化单倍型hapcut2"><a href="#DNA甲基化单倍型hapcut2" class="headerlink" title="DNA甲基化单倍型hapcut2"></a>DNA甲基化单倍型hapcut2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$3=="+" &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,".\tC\tT\t600\tPASS\t.\tGT\t0/1"&#125;' k562.mr.methratio.txt &gt; k562.mr.methratio.p.txt</span><br><span class="line">cat wgbs.replace.mdups.snp.filtered.sort.vcf k562.mr.methratio.p.txt &gt; k562.snpwithmr.p.vcf</span><br><span class="line">sh run.sortvcf.sh k562.snpwithmr.p.vcf k562.snpwithmr.p.sort.vcf</span><br><span class="line"></span><br><span class="line">sh run.Sstrand.sh wgbs.sort.bam</span><br><span class="line">~/software/HapCUT2/build/extractHAIRS --bam wgbs.sort.p.bam --VCF k562.snpwithmr.p.sort.vcf --out k562.snpwithmr.hapcut2.fragment</span><br><span class="line">~/software/HapCUT2/build/HAPCUT2 --fragments k562.snpwithmr.hapcut2.fragment --vcf k562.snpwithmr.p.sort.vcf --output k562.snpwithmr.hapcut2.haplo.txt</span><br><span class="line"></span><br><span class="line">awk -v OFS="\t" '$3=="-" &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,".\tG\tA\t600\tPASS\t.\tGT\t0/1"&#125;' k562.mr.methratio.txt &gt; k562.mr.methratio.n.txt</span><br><span class="line">cat wgbs.replace.mdups.snp.filtered.sort.vcf k562.mr.methratio.n.txt &gt; k562.snpwithmr.n.vcf</span><br><span class="line">sh run.sortvcf.sh k562.snpwithmr.n.vcf k562.snpwithmr.n.sort.vcf</span><br><span class="line">~/software/HapCUT2/build/extractHAIRS --bam wgbs.sort.n.bam --VCF k562.snpwithmr.n.sort.vcf --out k562.snpwithmr.n.hapcut2.fragment</span><br><span class="line">~/software/HapCUT2/build/HAPCUT2 --fragments k562.snpwithmr.n.hapcut2.fragment --vcf k562.snpwithmr.n.sort.vcf --output k562.snpwithmr.n.hapcut2.haplo.txt</span><br></pre></td></tr></table></figure><h3 id="genome-按照固定长度分割基因组到bed格式文件："><a href="#genome-按照固定长度分割基因组到bed格式文件：" class="headerlink" title="genome 按照固定长度分割基因组到bed格式文件："></a>genome 按照固定长度分割基因组到bed格式文件：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'&#123;bin=2000;len=int($2/bin);for(i=0;i&lt;len;i++)&#123;print $1,i*bin+1,(i+1)*bin&#125;;if(len*bin &lt; $2)&#123;print $1,len*bin+1, $2&#125;&#125;'</span> ~/practice/Genome/arabidopsis/TAIR10_chr_all.fa.fai &gt; TAIR10.splitby2k.bed</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      常用的line command
    
    </summary>
    
      <category term="project" scheme="https://zhouqiangwei.github.io/categories/project/"/>
    
    
      <category term="project" scheme="https://zhouqiangwei.github.io/tags/project/"/>
    
  </entry>
  
  <entry>
    <title>sublimetext3-usage</title>
    <link href="https://zhouqiangwei.github.io/2019/04/07/sublimetext3-usage/"/>
    <id>https://zhouqiangwei.github.io/2019/04/07/sublimetext3-usage/</id>
    <published>2019-04-07T10:08:30.000Z</published>
    <updated>2019-04-07T10:29:41.310Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="Install-Package时出现There-are-no-packages-available-for-installation问题"><a href="#Install-Package时出现There-are-no-packages-available-for-installation问题" class="headerlink" title="Install Package时出现There are no packages available for installation问题"></a>Install Package时出现There are no packages available for installation问题</h2><p><strong>官网描述</strong><br>To help resolve the issue, follow these steps:</p><p>Select the View &gt; Show Console menu entry<br>Look for any lines starting with Package Control:<br>Try enabling the debug log for more information<br>Ensure any proxy information is set in the Package Control settings<br>If you have a proxy and it rewrites secure connections, add its CA cert as trusted:<br>Click the Preferences &gt; Browse Packages… menu<br>Open the User folder<br>Create a file named Package Control.user-ca-bundle and paste in a PEM-formatted version of the certificate<br>Make sure you have the latest version of Package Control installed: 3.3.0<br>If you are still having trouble, review the open issues. If you do not find a relevant issue, please open a new one, and be sure to include your debug log.</p><p><strong>解决办法</strong><br>在Preferences-&gt;Package Setting-&gt;Package Control -&gt;Setting User 中可以进行用户设置。将文件下载后，进行本地访问。<br>首先访问<a href="https://packagecontrol.io/channel_v3.json，右键另存为channel_v3.json，然后在Setting" target="_blank" rel="noopener">https://packagecontrol.io/channel_v3.json，右键另存为channel_v3.json，然后在Setting</a> User设置中，添加代码路径。<br>{<br>    “channels”:<br>    [<br>        “/Users/qiangweizhou/channel_v3.json”<br>    ]<br>}<br>解决！</p><h2 id="常用的插件"><a href="#常用的插件" class="headerlink" title="常用的插件"></a>常用的插件</h2><p>名称  功能<br>ConvertToUTF8   解决文件编码转换的问题 Emmet：快速编写html、css、js的神级插件<br>BracktHighLighter   括号高亮显示 ColorPicke：颜色选择器<br>HTMLBeautify    HTML格式化插件<br>IMESupport  输入法支持插件<br>Material Theme  一个主题<br>ChineseLocalization 汉化插件<br>SideBarEnhancements 增加左边栏的功能</p>]]></content>
    
    <summary type="html">
    
      sublime text 3
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>project_batmeth2</title>
    <link href="https://zhouqiangwei.github.io/2019/04/03/project-batmeth2/"/>
    <id>https://zhouqiangwei.github.io/2019/04/03/project-batmeth2/</id>
    <published>2019-04-03T07:50:12.000Z</published>
    <updated>2019-04-07T10:25:25.495Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script>]]></content>
    
    <summary type="html">
    
      batmeth2 work log
    
    </summary>
    
      <category term="project" scheme="https://zhouqiangwei.github.io/categories/project/"/>
    
    
      <category term="project" scheme="https://zhouqiangwei.github.io/tags/project/"/>
    
      <category term="batmeth2" scheme="https://zhouqiangwei.github.io/tags/batmeth2/"/>
    
  </entry>
  
  <entry>
    <title>project_alleleweb</title>
    <link href="https://zhouqiangwei.github.io/2019/04/03/project-alleleweb/"/>
    <id>https://zhouqiangwei.github.io/2019/04/03/project-alleleweb/</id>
    <published>2019-04-03T07:39:33.000Z</published>
    <updated>2019-04-06T07:35:22.551Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="Allele-数据库"><a href="#Allele-数据库" class="headerlink" title="Allele 数据库"></a>Allele 数据库</h2><h3 id="Data-list"><a href="#Data-list" class="headerlink" title="Data list"></a>Data list</h3><p><img src="/2019/04/03/project-alleleweb/image-20190319164036887.png" alt="image-20190319164036887"></p><p>上图：</p><p>1 对应该gsm数据在genome browser可视化情况（DNA甲基化水平bw、或者基因表达水平bw）</p><p>2 DNA甲基化数据对应BatMeth2分析结果可视化情况。RNAseq还没想好，好像也不需要这个。（可以试着完成如下，如果是BS-Seq数据显示，如果是RNA-Seq数据那么不显示这个小图标）</p><p>3 DNA甲基化数据对应等位差异DNA甲基化（链接到具体位置表、在每条染色体上的分布饼状图/柱状图、在基因组上的密度分布等）</p><p>RNAseq数据对应等位差异表达基因（连接到具体基因表）</p><p>4 sra list</p><h3 id="RNAseq-分析流程"><a href="#RNAseq-分析流程" class="headerlink" title="RNAseq 分析流程"></a>RNAseq 分析流程</h3><p>数据预处理（fastp）</p><p>比对 （hisat2）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># build index</span></span></span><br><span class="line">hisat2-build genomefile indexprefix</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#paired-end</span></span></span><br><span class="line">hisat2 -p 8 -x /index/location/indexprefix -1 R1.fq.gz  -2 R2.fq.gz -S outprefix.sam</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#single</span></span></span><br><span class="line">hisat2 -p 8 -x /index/location/indexprefix -U R1.fq.gz -S outprefix.sam</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#多个文件，可以用逗号间隔</span></span></span><br></pre></td></tr></table></figure><p> 等位差异分析 （ASEQ）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># gene.bed 格式：chr start end geneid</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># vcf.list 文件内包含snp文件路径，改文件通过与之对应的BS-Seq数据获得（bssnpcall）。</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># rnaseq.list 文件内包含RNAseq.sort.bam文件路径，例如在本文件夹下，则为./outprefix.sort.bam</span></span></span><br><span class="line">samtools sort -O BAM -@ 6 -o outprefix.sort.bam outprefix.sam</span><br><span class="line">ASEQ vcflist=vcf.list bamlist=rnaseq.list genes=gene.bed mode=ASE threads=6 mbq=20 mrq=20 mdc=10 pht=0.01 pft=0.01 out=./ASEQ/</span><br></pre></td></tr></table></figure><p> 基因表达水平分布 （deeptools，bam2bw）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bamCoverage -b outprefix.sort.bam -o outprefix.bw</span><br></pre></td></tr></table></figure><h3 id="BS-Seq数据分析"><a href="#BS-Seq数据分析" class="headerlink" title="BS-Seq数据分析"></a>BS-Seq数据分析</h3><p>BatMeth2流程分析 （DNA甲基化水平、DNA甲基化可视化结果、bw、）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># snp检测，线程不要超过四个</span></span></span><br><span class="line">bssnpcall -g genome -i sort.bam -o outprefix.vcf -p 4</span><br></pre></td></tr></table></figure><p>等位差异甲基化分析（methyhaplo）</p><p>等位差异DNA甲基化在染色体功能元件的分布（bedtools inersect | awk  ‘gff id’ | sort -rn | head -6 &gt; barplot）</p><p>等位差异DNA甲基化在染色体上的密度分布（？）bedtools/deeptools</p><h2 id="Django-Mysql"><a href="#Django-Mysql" class="headerlink" title="Django Mysql"></a>Django Mysql</h2><h3 id="安装mysql-in-mac"><a href="#安装mysql-in-mac" class="headerlink" title="安装mysql in mac"></a>安装mysql in mac</h3><p><code>brew install mysql</code></p><h3 id="更改密码"><a href="#更改密码" class="headerlink" title="更改密码"></a>更改密码</h3><p><code>/usr/bin/mysql_secure_installation</code> </p><h3 id="Enter-password-ERROR-2002-HY000-Can’t-connect-to-local-MySQL"><a href="#Enter-password-ERROR-2002-HY000-Can’t-connect-to-local-MySQL" class="headerlink" title="Enter password: ERROR 2002 (HY000): Can’t connect to local MySQL"></a>Enter password: ERROR 2002 (HY000): Can’t connect to local MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqld stop</span><br><span class="line">mysql.server restart</span><br></pre></td></tr></table></figure><h3 id="安装pymysql"><a href="#安装pymysql" class="headerlink" title="安装pymysql"></a>安装pymysql</h3><p><code>pip install pymysql</code></p><h3 id="修改settings-py"><a href="#修改settings-py" class="headerlink" title="修改settings.py"></a>修改settings.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/ref/settings/#databases</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 数据库配置 默认的数据库为sqlite</span></span><br><span class="line"><span class="comment"># DATABASES = &#123;</span></span><br><span class="line"><span class="comment">#  'default': &#123;</span></span><br><span class="line"><span class="comment">#   'ENGINE': 'django.db.backends.sqlite3',</span></span><br><span class="line"><span class="comment">#   'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),</span></span><br><span class="line"><span class="comment">#  &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line"> <span class="string">'default'</span>: &#123;</span><br><span class="line">  <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>, <span class="comment"># 数据库引擎</span></span><br><span class="line">  <span class="string">'NAME'</span>: <span class="string">'django_mysql'</span>, <span class="comment"># 数据库名</span></span><br><span class="line">  <span class="string">'USER'</span>: <span class="string">'root'</span>, <span class="comment"># 账号</span></span><br><span class="line">  <span class="string">'PASSWORD'</span>: <span class="string">'root'</span>, <span class="comment"># 密码</span></span><br><span class="line">  <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>, <span class="comment"># HOST</span></span><br><span class="line">  <span class="string">'POST'</span>: <span class="number">3306</span>, <span class="comment"># 端口</span></span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置init-py"><a href="#配置init-py" class="headerlink" title="配置init.py"></a>配置init.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">setting中的配置默认为sqlite3数据库 当需要修改成MySql时</span></span><br><span class="line"><span class="string">并且在setting.py的同级目录的__init__.py 加入如下配置</span></span><br><span class="line"><span class="string">否则会报错： Error loading MySQLdb module.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure><h3 id="在app文件的models-py文件中-创建数据表（GSEid）"><a href="#在app文件的models-py文件中-创建数据表（GSEid）" class="headerlink" title="在app文件的models.py文件中 创建数据表（GSEid）"></a>在app文件的models.py文件中 创建数据表（GSEid）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"> 该类是用来生成数据库的 必须要继承models.Model</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GSMid</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">创建如下几个表的字段</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># GEO ID primary_key=True: 该字段为主键</span></span><br><span class="line">Geoid = models.CharField(<span class="string">'geoid'</span>, primary_key=<span class="keyword">True</span>, max_length=<span class="number">15</span>)</span><br><span class="line"><span class="comment"># 碱基数目 字符串 最大长度20</span></span><br><span class="line">Bases = models.CharField(<span class="string">'Bases'</span>, max_length=<span class="number">20</span>)</span><br><span class="line"><span class="comment"># 测序设备 整数 null=False, 表示该字段不能为空</span></span><br><span class="line">Instrument = models.CharField(<span class="string">'Instrument'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># Layout 布尔类型 默认True: 男生 False:女生</span></span><br><span class="line">Layout = models.CharField(<span class="string">'Layout'</span>, max_length=<span class="number">15</span>)</span><br><span class="line"><span class="comment"># Library strategy unique=True 该字段唯一</span></span><br><span class="line">Library = models.CharField(<span class="string">'Library'</span>, max_length=<span class="number">15</span>)</span><br><span class="line"><span class="comment"># Organism </span></span><br><span class="line">Organism = models.CharField(<span class="string">'Organism'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># Organization</span></span><br><span class="line">Organization = models.CharField(<span class="string">'Organization'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># SRA </span></span><br><span class="line">sra = models.CharField(<span class="string">'SRA list'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># Source</span></span><br><span class="line">Source = models.CharField(<span class="string">'Source'</span>, max_length=<span class="number">100</span>)</span><br><span class="line"><span class="comment"># Title</span></span><br><span class="line">Title = models.CharField(<span class="string">'Title'</span>, max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 指定表名 不指定默认APP名字——类名(app_demo_Student)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">db_table = <span class="string">'gsmid'</span></span><br></pre></td></tr></table></figure><h3 id="在利用models-py文件生成数据库表之前，手动的先创建数据库"><a href="#在利用models-py文件生成数据库表之前，手动的先创建数据库" class="headerlink" title="在利用models.py文件生成数据库表之前，手动的先创建数据库"></a>在利用models.py文件生成数据库表之前，手动的先创建数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`mysql&gt; ``create` `database` `django_mysql;``Query OK, 1 row affected (0.01 sec)`</span><br></pre></td></tr></table></figure><h3 id="终端运行命令"><a href="#终端运行命令" class="headerlink" title="终端运行命令"></a>终端运行命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: MethAelle, admin, auth, contenttypes, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying MethAelle.0001_initial... OK</span><br><span class="line">  Applying MethAelle.0002_gsmid... OK</span><br><span class="line">  Applying MethAelle.0003_auto_20190317_0524... OK</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br></pre></td></tr></table></figure><h3 id="查看我们的django-mysql数据库，其中GSMid就是用models文件生成的表，其他的表是项目自动生成的，可以先不用管"><a href="#查看我们的django-mysql数据库，其中GSMid就是用models文件生成的表，其他的表是项目自动生成的，可以先不用管" class="headerlink" title="查看我们的django_mysql数据库，其中GSMid就是用models文件生成的表，其他的表是项目自动生成的，可以先不用管"></a>查看我们的django_mysql数据库，其中GSMid就是用models文件生成的表，其他的表是项目自动生成的，可以先不用管</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use django_mysql</span><br><span class="line">Database changed</span><br><span class="line"> </span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------------------+</span><br><span class="line">| Tables_in_django_mysql     |</span><br><span class="line">+----------------------------+</span><br><span class="line">| auth_group                 |</span><br><span class="line">| auth_group_permissions     |</span><br><span class="line">| auth_permission            |</span><br><span class="line">| auth_user                  |</span><br><span class="line">| auth_user_groups           |</span><br><span class="line">| auth_user_user_permissions |</span><br><span class="line">| django_admin_log           |</span><br><span class="line">| django_content_type        |</span><br><span class="line">| django_migrations          |</span><br><span class="line">| django_session             |</span><br><span class="line">| GSMid                      |</span><br><span class="line">| MethAelle_item             |</span><br><span class="line">+----------------------------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="表结构-desc查看表结构"><a href="#表结构-desc查看表结构" class="headerlink" title="表结构,desc查看表结构"></a>表结构,desc查看表结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc GSMid;</span><br><span class="line">+--------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field        | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Geoid        | varchar(15)  | NO   | PRI | NULL    |       |</span><br><span class="line">| Bases        | varchar(20)  | NO   |     | NULL    |       |</span><br><span class="line">| Instrument   | varchar(50)  | NO   |     | NULL    |       |</span><br><span class="line">| Layout       | varchar(15)  | NO   |     | NULL    |       |</span><br><span class="line">| Library      | varchar(15)  | NO   |     | NULL    |       |</span><br><span class="line">| Organism     | varchar(50)  | NO   |     | NULL    |       |</span><br><span class="line">| Organization | varchar(50)  | NO   |     | NULL    |       |</span><br><span class="line">| sra          | varchar(50)  | NO   |     | NULL    |       |</span><br><span class="line">| Source       | varchar(100) | NO   |     | NULL    |       |</span><br><span class="line">| Title        | varchar(100) | NO   |     | NULL    |       |</span><br><span class="line">+--------------+--------------+------+-----+---------+-------+</span><br><span class="line">10 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>至此Django利用models文件创建数据库表的功能已经完毕。</p><h3 id="接下来用代码的方式演示一下Django如何进行增删改查"><a href="#接下来用代码的方式演示一下Django如何进行增删改查" class="headerlink" title="接下来用代码的方式演示一下Django如何进行增删改查"></a>接下来用代码的方式演示一下Django如何进行增删改查</h3><h3 id="增加数据-views-py"><a href="#增加数据-views-py" class="headerlink" title="增加数据 (views.py)"></a>增加数据 (views.py)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> MethAelle.models <span class="keyword">import</span> GSMid</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">插入list数据</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loaddatalist</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">6</span>):</span><br><span class="line">        <span class="comment"># 从models文件中获取GSMid对象</span></span><br><span class="line">        gsmid = GSMid()</span><br><span class="line">        <span class="comment"># 给对象赋值</span></span><br><span class="line">        gsmid.Geoid = <span class="string">"GSM-"</span> + str(i)</span><br><span class="line">        gsmid.Bases = <span class="string">"1.5G"</span></span><br><span class="line">        gsmid.Instrument = <span class="string">"Illumina hiseq2000"</span></span><br><span class="line">        gsmid.Layout = <span class="string">"Paired"</span></span><br><span class="line">        gsmid.Library = <span class="string">"BS-seq"</span></span><br><span class="line">        gsmid.Organism=<span class="string">"Arabidopsis thaliana"</span></span><br><span class="line">        gsmid.Organization = <span class="string">"HZAU"</span></span><br><span class="line">        gsmid.sra = <span class="string">"srr01029-"</span> + str(i)</span><br><span class="line">        gsmid.Source = <span class="string">"seed-"</span> + str(i)</span><br><span class="line">        gsmid.Title = <span class="string">"Test1"</span></span><br><span class="line">        <span class="comment"># 插入数据</span></span><br><span class="line">        gsmid.save()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'datalist load done!'</span>)</span><br></pre></td></tr></table></figure><h3 id="urls-py-文件中-urlpatterns中配置"><a href="#urls-py-文件中-urlpatterns中配置" class="headerlink" title="urls.py 文件中 urlpatterns中配置"></a>urls.py 文件中 urlpatterns中配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^loaddatalist$'</span>, views.loaddatalist, name=<span class="string">"loaddatalist"</span>)</span><br></pre></td></tr></table></figure><h3 id="查看是否插入成功"><a href="#查看是否插入成功" class="headerlink" title="查看是否插入成功"></a>查看是否插入成功</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from GSMid;</span><br></pre></td></tr></table></figure><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`&quot;&quot;&quot;``查询``&quot;&quot;&quot;``def` `find(request):`` ``#sql = &apos;select * from student&apos;`` ``# django 也可以执行原生的sql语句`` ``#result = Student.objects.raw(sql)` ` ``# 查询name = tom1的数据`` ``result ``=` `Student.objects.``filter``(name``=``&apos;tom1&apos;``)`` ``&quot;&quot;&quot;`` ``result为&lt;class &apos;django.db.models.query.QuerySet&apos;&gt;的对象`` ``需要进行数据处理`` ``&quot;&quot;&quot;`` ``arr ``=` `[]`` ``for` `i ``in` `result:``  ``content ``=` `&#123;``&apos;学号&apos;``: i.studentNum, ``&apos;姓名&apos;``: i.name, ``&apos;性别&apos;``: i.sex&#125;``  ``arr.append(content)`` ``print``(arr)`` ``print``(``type``(arr))`` ``return` `HttpResponse(arr)`</span><br></pre></td></tr></table></figure><h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">删除</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">def delete(request, Geoid):</span><br><span class="line"> gsmid = GSMid.objects.get(Geoid=Geoid)</span><br><span class="line"> gsmid.delete()</span><br><span class="line"> return HttpResponse(&apos;删除成功.&apos;)</span><br></pre></td></tr></table></figure><p>settings.py中urlpatterns的配置如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`url(r``&apos;^delete/(?P&lt;studentNum&gt;.+)&apos;``, views.delete)`</span><br></pre></td></tr></table></figure><h2 id="修改显示mysql到table"><a href="#修改显示mysql到table" class="headerlink" title="修改显示mysql到table"></a>修改显示mysql到table</h2><h3 id="修改views-py"><a href="#修改views-py" class="headerlink" title="修改views.py"></a>修改views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">table</span><span class="params">(request)</span>:</span></span><br><span class="line">    gsmlist=GSMid.objects.all()  <span class="comment">#获取我们的数据库信息到names里</span></span><br><span class="line">    <span class="comment">#return render(request,'table.html',&#123;'form':table_form&#125;)</span></span><br><span class="line">    <span class="comment">#return render_to_response('MethAelle/table.html',locals()) #必须用这个return</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'MethAelle/table.html'</span>, locals())</span><br></pre></td></tr></table></figure><h3 id="修改table-js"><a href="#修改table-js" class="headerlink" title="修改table.js"></a>修改table.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"ajax"</span>: <span class="string">"/static/MethAelle/data/objects.txt"</span>,  </span><br><span class="line">改为</span><br><span class="line"><span class="string">"ajax"</span>: <span class="string">""</span>, <span class="comment">//   /static/MethAelle/data/objects.txt</span></span><br><span class="line">        <span class="string">"columns"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"class"</span>:          <span class="string">"details-control"</span>,</span><br><span class="line">                <span class="string">"orderable"</span>:      <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"data"</span>:           <span class="literal">null</span>,</span><br><span class="line">                <span class="string">"defaultContent"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Geoid"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"sra"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Library"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Source"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Layout"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Instrument"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Organization"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Organism"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Title"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Bases"</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"order"</span>: [[<span class="number">1</span>, <span class="string">'asc'</span>]]</span><br><span class="line">首先去掉本地显示文件</span><br></pre></td></tr></table></figure><h3 id="修改table-html"><a href="#修改table-html" class="headerlink" title="修改table.html"></a>修改table.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"example"</span> <span class="attr">class</span>=<span class="string">"display"</span> <span class="attr">style</span>=<span class="string">"width:100%"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>GEO ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>SRA<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Library<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Source<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Layout<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Bases<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Organization<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Instrument<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% for gsm in gsmlist %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Geoid&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.sra&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Library&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Source&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Layout&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Bases&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Organization&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Instrument&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">tfoot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>GEO ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>SRA<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Library<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Source<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Layout<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Bases<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Organization<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Instrument<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tfoot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="参考：-https-www-jb51-net-article-151269-htm"><a href="#参考：-https-www-jb51-net-article-151269-htm" class="headerlink" title="参考： https://www.jb51.net/article/151269.htm"></a>参考： <a href="https://www.jb51.net/article/151269.htm" target="_blank" rel="noopener">https://www.jb51.net/article/151269.htm</a></h3><h2 id="navmenu"><a href="#navmenu" class="headerlink" title="navmenu"></a>navmenu</h2><h3 id="主页下拉菜单点击后背景变成灰色，设置为透明色（如下）"><a href="#主页下拉菜单点击后背景变成灰色，设置为透明色（如下）" class="headerlink" title="主页下拉菜单点击后背景变成灰色，设置为透明色（如下）"></a>主页下拉菜单点击后背景变成灰色，设置为透明色（如下）</h3><p><img src="/2019/04/03/project-alleleweb/image-20190318102429380.png" alt="image-20190318102429380"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*navmenu*/</span></span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span> <span class="selector-class">.dropdown</span>&#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e7e7e705</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">a</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#20ae3d</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#e7e7e705</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-class">.open</span>&gt;<span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-class">.open</span>&gt;<span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-id">#methnavmenu</span><span class="selector-class">.navbar-default</span> <span class="selector-class">.navbar-nav</span>&gt;<span class="selector-class">.open</span>&gt;<span class="selector-tag">a</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#20ae3d</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#e7e7e705</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现三级菜单"><a href="#实现三级菜单" class="headerlink" title="实现三级菜单"></a>实现三级菜单</h3><p><img src="/2019/04/03/project-alleleweb/image-20190318110528486.png" alt="image-20190318110528486"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span> <span class="attr">id</span>=<span class="string">"nav_table_menu"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>Data List <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;a href="&#123;% url 'table' %&#125;" role="button" &gt;Table &lt;span class="caret"&gt;&lt;/span&gt;&lt;/a&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown-submenu"</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--需要在css中添加submenu的格式，否则不显示下一级菜单--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">            Animals</span><br><span class="line">            <span class="tag">&lt;<span class="name">b</span> <span class="attr">class</span>=<span class="string">"caret-right"</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--需要在css中添加caret格式，向右的箭头--&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Human<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Mouse<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span>&gt;</span>Arabidopsis thaliana<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* dropdown submenu*/</span></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span> &gt; <span class="selector-class">.dropdown-menu</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">-webkit-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">-moz-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-class">.dropdown-menu</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bigd-dropup</span> <span class="selector-class">.dropdown-submenu</span> &gt; <span class="selector-class">.dropdown-menu</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: auto;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: -<span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">-webkit-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">-moz-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: -<span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent;</span><br><span class="line">    <span class="attribute">border-left-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">border-style</span>: solid;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">border-left-color</span>: <span class="number">#fff</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span><span class="selector-class">.bigd-pull-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-submenu</span><span class="selector-class">.bigd-pull-left</span> &gt; <span class="selector-class">.dropdown-menu</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">-webkit-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">-moz-border-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">/*向右的箭头*/</span></span><br><span class="line"><span class="selector-class">.caret-right</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">4px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">left</span>: auto;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">' '</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*三级菜单 done*/</span></span><br></pre></td></tr></table></figure><h3 id="主页添加描述内容"><a href="#主页添加描述内容" class="headerlink" title="主页添加描述内容"></a>主页添加描述内容</h3><p>主要问题：添加描述内容两边宽度（class=container），以及上下间隔（class=index）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- end header --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"index"</span>&gt;</span> <span class="comment">&lt;!-- padding=15px --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text-justify"</span> <span class="attr">style</span>=<span class="string">"font-size: 18px"</span>&gt;</span></span><br><span class="line">  The Allele-specific DNA Methylation databases (AlleleMeth) is a database that</span><br><span class="line">                integrates genome-wide DNA methylomes and Allele-specific DNA methylation across a variety of species and provides an interactive browser</span><br><span class="line">                for visualization of high-resolution DNA methylation data.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- panel --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Index css</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*home 预留间隔*/</span></span><br><span class="line"><span class="selector-class">.index</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">15px</span> <span class="number">15px</span> <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">3px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0, 0, 0, .05);</span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">3px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0, 0, 0, .05);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="navbar-三级菜单选中颜色"><a href="#navbar-三级菜单选中颜色" class="headerlink" title="navbar 三级菜单选中颜色"></a>navbar 三级菜单选中颜色</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在dropdown-menu添加id，其实也可以统一添加类,去掉id，添加focuslist类--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--animals--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown-submenu"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">                Animals</span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span> <span class="attr">class</span>=<span class="string">"caret-right"</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              &lt;ul class="dropdown-menu focuslist" &lt;!--id="navbar_animals"--&gt; &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span>&gt;</span>Human<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span>&gt;</span>Mouse<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--PLANT--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown-submenu"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">                Plants</span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span> <span class="attr">class</span>=<span class="string">"caret-right"</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              &lt;ul class="dropdown-menu focuslist" &lt;!--id="navbar_plants"--&gt; &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span>&gt;</span>Arabidopsis thaliana<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span>&gt;</span>Oryza<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!----&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* navbar 三级菜单选中颜色-绿色*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#navbar_animals &gt; li &gt; a:hover,</span></span><br><span class="line"><span class="comment">#navbar_animals &gt; li &gt; a:focus,</span></span><br><span class="line"><span class="comment">#navbar_plants &gt; li &gt; a:hover,</span></span><br><span class="line"><span class="comment">#navbar_plants &gt; li &gt; a:focus &#123;</span></span><br><span class="line"><span class="comment">  color: #20ae3d;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.focuslist</span> &gt; <span class="selector-tag">li</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.focuslist</span> &gt; <span class="selector-tag">li</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#20ae3d</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加位置标示"><a href="#添加位置标示" class="headerlink" title="添加位置标示"></a>添加位置标示</h3><p><img src="/2019/04/03/project-alleleweb/image-20190318123309210.png" alt="image-20190318123309210"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'home' %&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-home"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa font-awesome"</span>&gt;</span>Data List<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span>data<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.breadcrumb</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改body字体"><a href="#修改body字体" class="headerlink" title="修改body字体"></a>修改body字体</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*修改body字体*/</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Arial, <span class="string">"Microsoft YaHei"</span>, <span class="string">"微软雅黑"</span>, serif;</span><br><span class="line">    <span class="comment">/*font-size: 16px;*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="插入icons"><a href="#插入icons" class="headerlink" title="插入icons"></a>插入icons</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-area-chart"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mac删除定时任务"><a href="#mac删除定时任务" class="headerlink" title="mac删除定时任务"></a>mac删除定时任务</h3><p>crontab -e进入配置文件，删除以下自动换桌面命令</p><p><code>0 12 * * 1 /bin/bash /Users/qiangweizhou/tools/Mac-command-wallpaper/wallpaper randweb com</code></p><h2 id="表格信息excel批量导入mysql"><a href="#表格信息excel批量导入mysql" class="headerlink" title="表格信息excel批量导入mysql"></a>表格信息excel批量导入mysql</h2><p><code>loadexcel2mysql.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql.cursors <span class="comment">#用来操作数据库  参考地址： https://pypi.org/project/PyMySQL/#downloads 如果报错请按照</span></span><br><span class="line">这个链接安装 pip3 install PyMySQL</span><br><span class="line"><span class="comment">#import xlrd # 用来读excel 参考地址: https://www.cnblogs.com/MrLJC/p/3715783.html</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook <span class="comment"># 可以支持xlsx的工具,https://www.cnblogs.com/anpengapple/p/6399304.html?utm</span></span><br><span class="line">_source=itdadao&amp;utm_medium=referral</span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># 用来度文件 参考地址: https://www.cnblogs.com/mufenglin/p/7676160.html</span></span><br><span class="line"><span class="keyword">import</span> re <span class="comment"># 正则表达式模块  参考地址: http://www.runoob.com/python/python-reg-expressions.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">connection = pymysql.connect(host=<span class="string">'localhost'</span>, <span class="comment"># 数据库地址</span></span><br><span class="line">                             user=<span class="string">'root'</span>,       <span class="comment"># 数据库用户名</span></span><br><span class="line">                             password=<span class="string">'qiangwei12'</span>,<span class="comment"># 数据库密码</span></span><br><span class="line">                             db=<span class="string">'django_mysql'</span>,         <span class="comment"># 数据库名称</span></span><br><span class="line">                             charset=<span class="string">'utf8mb4'</span>,</span><br><span class="line">                             cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line">cursor = connection.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库</span></span><br><span class="line">tablename = <span class="string">'GSMid'</span></span><br><span class="line"><span class="comment">#sql = "CREATE TABLE `"+tablename+"` (`pmid` int(11) NOT NULL,`article_title` varchar(1024) DEFAULT NULL,`auth</span></span><br><span class="line">or_list` varchar(<span class="number">1024</span>) DEFAULT NULL,`abstract_text` text DEFAULT NULL,`keywords` varchar(<span class="number">1025</span>) DEFAULT NULL,`p</span><br><span class="line">mcid` char(<span class="number">255</span>) DEFAULT NULL,`pub_med_pub_date` char(<span class="number">255</span>) DEFAULT NULL,`journal_issue` char(<span class="number">255</span>) DEFAULT NULL,</span><br><span class="line">`serch_text` char(<span class="number">255</span>) DEFAULT NULL) ENGINE=MyISAM DEFAULT CHARSET=utf8<span class="string">"</span></span><br><span class="line"><span class="string">#cursor.execute("</span>DROP TABLE IF EXISTS `<span class="string">"+tablename+"</span>`<span class="string">")</span></span><br><span class="line"><span class="string">#cursor.execute(sql)</span></span><br><span class="line"><span class="string">#connection.commit()</span></span><br><span class="line"><span class="string">count=0</span></span><br><span class="line"><span class="string"># 遍历目录</span></span><br><span class="line"><span class="string">basedir = '/Users/qiangweizhou/科研/DNA甲基化数据库/data_result/organism/'</span></span><br><span class="line"><span class="string">rootdir = os.listdir(basedir)</span></span><br><span class="line"><span class="string">#for subdir in rootdir: # 遍历第一层目录 1 2 3 4 5 6</span></span><br><span class="line"><span class="string">#    if os.path.isdir(subdir):</span></span><br><span class="line"><span class="string">#        subrootdir = os.listdir(basedir+subdir)</span></span><br><span class="line"><span class="string">for files in rootdir: # 遍历第二层目录 如 1下面的目录</span></span><br><span class="line"><span class="string">    print(os.path.splitext(files)[0])</span></span><br><span class="line"><span class="string">    if files[0]!='~' and os.path.splitext(files)[1]=='.xlsx': # 如果是excel文件</span></span><br><span class="line"><span class="string">        # data = xlrd.open_workbook(basedir+subdir+'/'+files)</span></span><br><span class="line"><span class="string">        # table = data.sheets()[0]</span></span><br><span class="line"><span class="string">        wb = load_workbook(basedir+files)</span></span><br><span class="line"><span class="string">        table = wb.get_sheet_by_name("</span>Sheet1<span class="string">")</span></span><br><span class="line"><span class="string">        print("</span>导入<span class="string">",basedir+files,"</span>数据中,已经导入<span class="string">",count,"</span>条数据<span class="string">")</span></span><br><span class="line"><span class="string">        ##### 下面的方法是一个excel运行一次插入语句，经验证太慢，一个excel导入耗时超过3分钟</span></span><br><span class="line"><span class="string">        # thissql = 'insert into '+tablename+' values '</span></span><br><span class="line"><span class="string">        # for row in range(1,table.nrows):</span></span><br><span class="line"><span class="string">        #     value = '('</span></span><br><span class="line"><span class="string">        #     for col in range(0,9):</span></span><br><span class="line"><span class="string">        #         value += "</span><span class="string">'"+str(table.cell(row,col).value)+"'</span>,<span class="string">"</span></span><br><span class="line"><span class="string">        #     value = value[:(len(value)-1)]+"</span>),<span class="string">"</span></span><br><span class="line"><span class="string">        #     thissql +=value</span></span><br><span class="line"><span class="string">        # thissql = thissql[:(len(thissql))]</span></span><br><span class="line"><span class="string">        # cursor.execute(thissql)</span></span><br><span class="line"><span class="string">        # connection.commit()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ##### 下面的方法是一行运行一次插入语句</span></span><br><span class="line"><span class="string">        thissql = 'insert into '+tablename+' values(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)'</span></span><br><span class="line"><span class="string">        for row in range(2,table.max_row+1): ## table.max_row+1因为range是开合的，需要+1</span></span><br><span class="line"><span class="string">            #print(table.cell(row=row,column=1).value, table.max_row, row)</span></span><br><span class="line"><span class="string">            if table.cell(row=row,column=1).value == "</span>N<span class="string">":</span></span><br><span class="line"><span class="string">                continue</span></span><br><span class="line"><span class="string">            organism=(table.cell(row=row,column=8).value)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            Source=(table.cell(row=row,column=10).value).split('&lt;a href', 1)[0]</span></span><br><span class="line"><span class="string">            if Source.find(';'):</span></span><br><span class="line"><span class="string">                Source=(Source).split(';', 1)[1] ## 爬虫时候title+sample，去掉title部分</span></span><br><span class="line"><span class="string">            if len(Source) &gt; 500:</span></span><br><span class="line"><span class="string">                Source = Source[0:500]</span></span><br><span class="line"><span class="string">            #print(Source)</span></span><br><span class="line"><span class="string">            cursor.execute(thissql,(</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=3).value,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=1).value,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=4).value,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=5).value,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=6).value,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=7).value,</span></span><br><span class="line"><span class="string">            organism,</span></span><br><span class="line"><span class="string">            table.cell(row=row,column=9).value,</span></span><br><span class="line"><span class="string">            Source,table.cell(row=row,column=11).value,))</span></span><br><span class="line"><span class="string">            count+=1</span></span><br><span class="line"><span class="string">        connection.commit()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print('批量导入数据完毕，共导入:',count,'条数据')</span></span><br><span class="line"><span class="string"># 关闭数据库</span></span><br><span class="line"><span class="string">connection.close()</span></span><br></pre></td></tr></table></figure><p>首先清空数据库table</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use django_mysql</span><br><span class="line">show tables; #查看表格</span><br><span class="line">select * from GSMid; #显示内容</span><br><span class="line">TRUNCATE TABLE GSMid; #情况</span><br></pre></td></tr></table></figure><p>运行导入到mysql：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python loadexcel2mysql.py</span><br></pre></td></tr></table></figure><h2 id="Show-5-entries"><a href="#Show-5-entries" class="headerlink" title="Show 5 entries"></a>Show 5 entries</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'MethAelle/vendor/datatables/js/jquery.dataTables.js' %&#125;"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>文件路径：<code>MethAelle/vendor/datatables/js/jquery.dataTables.js</code></p><p>首先在选项中添加5，<code>&quot;aLengthMenu&quot;: [ 5, 10, 25, 50, 100 ],</code></p><p><img src="/2019/04/03/project-alleleweb/image-20190319103124461.png" alt="image-20190319103124461"></p><p>修改<code>iDisplayLength</code>为5，默认长度</p><p><img src="/2019/04/03/project-alleleweb/image-20190319102900921.png" alt="image-20190319102900921"></p><h3 id="控制table不超出div"><a href="#控制table不超出div" class="headerlink" title="控制table不超出div"></a>控制table不超出div</h3><p>在table上层div添加<code>overflow: auto;</code></p><p>文档：<code>table.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>&#123;&#123;Organism&#125;&#125; Datasets List<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span> <span class="attr">style</span>=<span class="string">"overflow: auto;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- end col-left --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="jquery-datatables"><a href="#jquery-datatables" class="headerlink" title="jquery.datatables"></a>jquery.datatables</h2><h3 id="第一列可以显示内容"><a href="#第一列可以显示内容" class="headerlink" title="第一列可以显示内容"></a>第一列可以显示内容</h3><p>文件：<code>table.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将第一列data:null替换</span></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dt = $(<span class="string">'#tabledatalistid'</span>).DataTable( &#123;</span><br><span class="line">        <span class="comment">// "processing": true,</span></span><br><span class="line">        <span class="comment">// "serverSide": true,</span></span><br><span class="line">        <span class="string">"ajax"</span>: <span class="string">""</span>, <span class="comment">//   /static/MethAelle/data/objects.txt</span></span><br><span class="line">        <span class="string">"columns"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"class"</span>:          <span class="string">"details-control"</span>,</span><br><span class="line">                <span class="string">"orderable"</span>:      <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"data"</span>:           <span class="string">"visul"</span>, <span class="comment">//numm</span></span><br><span class="line">                <span class="string">"defaultContent"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Geoid"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"sra"</span>,</span><br><span class="line">              <span class="string">"visible"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Library"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Source"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Layout"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Bases"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Organization"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Instrument"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Title"</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"order"</span>: [[<span class="number">1</span>, <span class="string">'asc'</span>]]</span><br><span class="line">    &#125; );</span><br></pre></td></tr></table></figure><p><code>table.html</code>内添加内容 （添加的是<i>图标）</i></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for gsm in gsmlist %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'jbrowse' %&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-area-chart"</span> <span class="attr">aria-hidden</span>=<span class="string">"false"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'jbrowse' %&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-pie-chart"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'jbrowse' %&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-venus-mars"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=&#123;&#123;gsm.Geoid&#125;&#125;"</span>&gt;</span></span><br><span class="line">            &#123;&#123;gsm.Geoid&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.ncbi.nlm.nih.gov/sra/&#123;&#123;gsm.sra&#125;&#125;"</span>&gt;</span></span><br><span class="line">            &#123;&#123;gsm.sra&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Library&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Source&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Layout&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Bases&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Organization&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Instrument&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;gsm.Title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><img src="/2019/04/03/project-alleleweb/image-20190319161459294.png" alt="image-20190319161459294"></p><h3 id="第三列隐藏，并显示在第一列点击后出现"><a href="#第三列隐藏，并显示在第一列点击后出现" class="headerlink" title="第三列隐藏，并显示在第一列点击后出现"></a>第三列隐藏，并显示在第一列点击后出现</h3><p>修改<code>table.js</code>内第三列，添加<code>&quot;visible&quot;: false</code>，内容可查看上一节</p><p>第一列点击出现：</p><p>修改<code>table.js</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//format d.sra 显示第三列sra内容</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format</span> (<span class="params"> d </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'The child row is a SRA list: '</span> + d.sra;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dt = $(<span class="string">'#tabledatalistid'</span>).DataTable( &#123;</span><br><span class="line">        <span class="comment">// "processing": true,</span></span><br><span class="line">        <span class="comment">// "serverSide": true,</span></span><br><span class="line">        <span class="string">"ajax"</span>: <span class="string">""</span>, <span class="comment">//   /static/MethAelle/data/objects.txt</span></span><br><span class="line">        <span class="string">"columns"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"class"</span>:          <span class="string">"details-control"</span>,</span><br><span class="line">                <span class="string">"orderable"</span>:      <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"data"</span>:           <span class="string">"visul"</span>,</span><br><span class="line">                <span class="string">"defaultContent"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Geoid"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"sra"</span>,</span><br><span class="line">              <span class="string">"visible"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Library"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Source"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Layout"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Bases"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Organization"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Instrument"</span> &#125;,</span><br><span class="line">            &#123; <span class="string">"data"</span>: <span class="string">"Title"</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"order"</span>: [[<span class="number">1</span>, <span class="string">'asc'</span>]]</span><br><span class="line">    &#125; );</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Array to track the ids of the details displayed rows</span></span><br><span class="line">    <span class="keyword">var</span> detailRows = [];</span><br><span class="line">     $(<span class="string">'#tabledatalistid tbody'</span>).on( <span class="string">'click'</span>, <span class="string">'tr td.details-control'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tr = $(<span class="keyword">this</span>).closest(<span class="string">'tr'</span>);</span><br><span class="line">        <span class="keyword">var</span> row = dt.row( tr );</span><br><span class="line">        <span class="keyword">var</span> idx = $.inArray( tr.attr(<span class="string">'id'</span>), detailRows );</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> ( row.child.isShown() ) &#123;</span><br><span class="line">            tr.removeClass( <span class="string">'details'</span> );</span><br><span class="line">            row.child.hide();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Remove from the 'open' array</span></span><br><span class="line">            detailRows.splice( idx, <span class="number">1</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tr.addClass( <span class="string">'details'</span> );</span><br><span class="line">            row.child( format( row.data() ) ).show();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Add to the 'open' array</span></span><br><span class="line">            <span class="keyword">if</span> ( idx === <span class="number">-1</span> ) &#123;</span><br><span class="line">                detailRows.push( tr.attr(<span class="string">'id'</span>) );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// On each draw, loop over the `detailRows` array and show any child rows</span></span><br><span class="line">    dt.on( <span class="string">'draw'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.each( detailRows, <span class="function"><span class="keyword">function</span> (<span class="params"> i, id </span>) </span>&#123;</span><br><span class="line">            $(<span class="string">'#'</span>+id+<span class="string">' td.details-control'</span>).trigger( <span class="string">'click'</span> );</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p><img src="/2019/04/03/project-alleleweb/image-20190319162102042.png" alt="image-20190319162102042"></p><h3 id="去掉边框，底线变绿色"><a href="#去掉边框，底线变绿色" class="headerlink" title="去掉边框，底线变绿色"></a>去掉边框，底线变绿色</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#methnavmenu</span>&#123;   </span><br><span class="line"><span class="attribute">border-width</span>: <span class="number">0px</span>;</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#099722</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2019/04/03/project-alleleweb/alleleweb-log.png" alt="image-20190321095447714"></p><h3 id="边角弧度"><a href="#边角弧度" class="headerlink" title="边角弧度"></a>边角弧度</h3><p>需要添加到div下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#bs-example-navmenu-collapse-1</span>&#123;</span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#099722</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="navbar选择list下某一网页，需要激活li"><a href="#navbar选择list下某一网页，需要激活li" class="headerlink" title="navbar选择list下某一网页，需要激活li"></a>navbar选择list下某一网页，需要激活li</h3><p>实现效果如下：</p><p><img src="/2019/04/03/project-alleleweb/image-20190321110908996.png" alt="image-20190321110908996"></p><p>在file网页中添加：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- navbar --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// $('#nav_file').click(function (e) &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//e.preventDefault();</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// $('#nav_file').removeClass('active');</span></span></span><br><span class="line"><span class="javascript">  $(<span class="string">'#navbar_analysis'</span>).addClass(<span class="string">'active'</span>);</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应navbar中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Analysis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span> <span class="attr">id</span>=<span class="string">"navbar_analysis"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'table' %&#125;"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>Analysis/ Function <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;a href="&#123;% url 'table' %&#125;" role="button" &gt;Table &lt;span class="caret"&gt;&lt;/span&gt;&lt;/a&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'file' %&#125;"</span>&gt;</span>Allele Meth visulization<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>ASM analysis<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Differential analysis<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>One more separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="RNAseq不显示BatMeth2网页结果，因此需要判断数据类型"><a href="#RNAseq不显示BatMeth2网页结果，因此需要判断数据类型" class="headerlink" title="RNAseq不显示BatMeth2网页结果，因此需要判断数据类型"></a>RNAseq不显示BatMeth2网页结果，因此需要判断数据类型</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if gsm.Library == "Bisulfite-Seq" %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'jbrowse' %&#125;"</span>&gt;</span> <span class="comment">&lt;!--batmeth2 results--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-pie-chart"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p><img src="/2019/04/03/project-alleleweb/image-20190321115609628.png" alt="image-20190321115609628"></p><h2 id="django-send-email-发邮件"><a href="#django-send-email-发邮件" class="headerlink" title="django send email 发邮件"></a>django send email 发邮件</h2><p>设置app下的setting.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## send e-mail</span></span><br><span class="line">EMAIL_BACKEND = <span class="string">'django.core.mail.backends.smtp.EmailBackend'</span>  <span class="comment">#email后端</span></span><br><span class="line">EMAIL_USE_TLS = <span class="keyword">False</span>   <span class="comment">#是否使用TLS安全传输协议</span></span><br><span class="line">EMAIL_USE_SSL = <span class="keyword">True</span>    <span class="comment">#是否使用SSL加密，qq企业邮箱要求使用</span></span><br><span class="line">EMAIL_HOST = <span class="string">'smtp.qq.com'</span>   <span class="comment">#发送邮件的邮箱 的 SMTP服务器，这里用了qq企业邮箱</span></span><br><span class="line">EMAIL_PORT = <span class="number">465</span>     <span class="comment">#发件箱的SMTP服务器端口 or 25</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">'1010170266@qq.com'</span>    <span class="comment">#发送邮件的邮箱地址</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">'ksglqeziekpibdeh'</span>         <span class="comment">#发送邮件的邮箱密码，账号的密码必须是授权码，忘了的可以在qq邮箱里面设置，把已关闭 |  开启 IMAP/SMTP服务</span></span><br></pre></td></tr></table></figure><p>view. py中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.mail <span class="keyword">import</span> send_mail</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendMessage</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    request.encoding=<span class="string">'utf-8'</span></span><br><span class="line">    <span class="keyword">print</span> (request.GET)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'name'</span> <span class="keyword">in</span> request.GET:</span><br><span class="line">        name = request.GET[<span class="string">'name'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'subject_title'</span> <span class="keyword">in</span> request.GET:</span><br><span class="line">        Subject = request.GET[<span class="string">'subject_title'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'email'</span> <span class="keyword">in</span> request.GET:</span><br><span class="line">        email = request.GET[<span class="string">'email'</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'message'</span> <span class="keyword">in</span> request.GET:</span><br><span class="line">        message = email + <span class="string">"\n"</span> + request.GET[<span class="string">'message'</span>]</span><br><span class="line">    send_mail(</span><br><span class="line">        Subject,</span><br><span class="line">        message,</span><br><span class="line">        <span class="string">'1010170266@qq.com'</span>,</span><br><span class="line">        [<span class="string">'1010170266@qq.com'</span>],</span><br><span class="line">        </span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'MethAelle/contact.html'</span>, &#123;<span class="string">"message"</span>:<span class="string">"Send successful, thanks! We will check your message asap."</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="添加横线"><a href="#添加横线" class="headerlink" title="添加横线"></a>添加横线</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">margin-top</span>: 0;</span><br></pre></td></tr></table></figure><h3 id="响应式布局中重要的meta标签设置-适用于手机浏览器兼容性设置"><a href="#响应式布局中重要的meta标签设置-适用于手机浏览器兼容性设置" class="headerlink" title="响应式布局中重要的meta标签设置.适用于手机浏览器兼容性设置"></a>响应式布局中重要的meta标签设置.适用于手机浏览器兼容性设置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- #手机浏览器兼容性设置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"application/xhtml+xml;charset=UTF-8"</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"no-cache,must-revalidate"</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"no-cache"</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"0"</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"telephone=no, address=no"</span> <span class="attr">name</span>=<span class="string">"format-detection"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> <span class="attr">name</span>=<span class="string">"viewport"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black-translucent"</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- #手机浏览器兼容性设置 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">粘贴到顶部后和原来的meta标签对齐.</span><br><span class="line">可以实现响应式布局.</span><br></pre></td></tr></table></figure><h3 id="手机模式下拉菜单关闭不了，点击后只是闪烁一下"><a href="#手机模式下拉菜单关闭不了，点击后只是闪烁一下" class="headerlink" title="手机模式下拉菜单关闭不了，点击后只是闪烁一下"></a>手机模式下拉菜单关闭不了，点击后只是闪烁一下</h3><p><img src="/2019/04/03/project-alleleweb/image-20190324145341353.png" alt="image-20190324145341353"></p><p>发现在custom.css内设置了格式如下，删除后正常。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#bs-example-navmenu-collapse-1</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  background-image: url('/static/MethAelle/img/2.jpg');</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: -<span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="发现手机中菜单栏，点不开，一点就关闭"><a href="#发现手机中菜单栏，点不开，一点就关闭" class="headerlink" title="发现手机中菜单栏，点不开，一点就关闭"></a>发现手机中菜单栏，点不开，一点就关闭</h3><p>解决：是bootstrap3.3.7中的bug，替换为4.1.0后正常</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>删除：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改文件：file、table、jbrowse、gragh</p><p>其他文件未调用该bootstrap，所以不存在问题。</p>]]></content>
    
    <summary type="html">
    
      allele meth web
    
    </summary>
    
      <category term="project" scheme="https://zhouqiangwei.github.io/categories/project/"/>
    
    
      <category term="project" scheme="https://zhouqiangwei.github.io/tags/project/"/>
    
      <category term="alleleweb" scheme="https://zhouqiangwei.github.io/tags/alleleweb/"/>
    
  </entry>
  
  <entry>
    <title>project_methhap</title>
    <link href="https://zhouqiangwei.github.io/2019/04/03/project-methhap/"/>
    <id>https://zhouqiangwei.github.io/2019/04/03/project-methhap/</id>
    <published>2019-04-03T07:36:47.000Z</published>
    <updated>2019-04-09T02:34:46.014Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>1 整理拟南芥数据结果。</p><p>拟南芥单倍型长度、覆盖repeat数目、ASM</p><p>2 HiC + BS 单倍型组装</p><p>IMR90 K562 etc. HiC haplotype</p><p>根据SNP信息，整合单倍型结果</p><p>3 K562 HepG2 DNA单倍型文章组装DNA单倍型</p><h3 id="k562-HepG2-单倍型与WGS比较"><a href="#k562-HepG2-单倍型与WGS比较" class="headerlink" title="k562 HepG2 单倍型与WGS比较"></a>k562 HepG2 单倍型与WGS比较</h3><h4 id="首先完成WGBS-meth-snv检测单倍型"><a href="#首先完成WGBS-meth-snv检测单倍型" class="headerlink" title="首先完成WGBS meth+snv检测单倍型"></a>首先完成WGBS meth+snv检测单倍型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10:45:12] qwzhou@login:~/practice/k562/WGBS :</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'sh run.hapcut2.sh'</span> | qsub -l nodes=1:ppn=8 -d ./ -e ./ -N k562</span></span><br></pre></td></tr></table></figure><h3 id="拟南芥"><a href="#拟南芥" class="headerlink" title="拟南芥"></a>拟南芥</h3><p>目录：[10:25:19] qwzhou@login:~/practice/tair_zwang/PM : [150]<br>合并正负链，并输出到bed格式。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | bedtools merge | less</span><br></pre></td></tr></table></figure></p><p>替换染色体，保持一致，并去掉子类，防止重复。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'sub(/Chr/,"",$1) &amp;&amp; $4!~/transposon_fragment/'</span> TAIR10_Transposable_Elements.bed &gt; TAIR10_Transposable_Elements.replacechr.bed</span><br></pre></td></tr></table></figure></p><p>bedtools merge/sort error:<br>Error: Sorted input specified, but the file - has the following out of order record</p><p>统计覆盖repeat的数目：</p><ol><li><p>DNA甲基化+SNP组装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[10:56:25] qwzhou@login:~/practice/tair_zwang/PM :</span><br><span class="line"><span class="meta">$</span><span class="bash"> awk -v OFS=<span class="string">"\t"</span> <span class="string">'$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;'</span> BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS=<span class="string">"\t"</span> <span class="string">'$1~/^=/&#123;print $2,$3,$4&#125;'</span> | sort -k1,1 -k2,2n -k3,3n | bedtools merge | bedtools intersect -a - -b TAIR10_Transposable_Elements.replacechr.bed -wo | awk <span class="string">'&#123;a[$7]&#125;END&#123;print length(a)&#125;'</span></span></span><br><span class="line">10927</span><br></pre></td></tr></table></figure></li><li><p>SNP组装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.hapcut2.snp.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | bedtools intersect -a - -b TAIR10_Transposable_Elements.replacechr.bed -wo | awk '&#123;a[$7]&#125;END&#123;print length(a)&#125;'</span><br><span class="line">3890</span><br></pre></td></tr></table></figure></li><li><p>DNA甲基化+SNP组装 (但是包含SNP)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | bedtools merge | bedtools intersect -a - -b BS-cviler.snp.hetero.vcf -wo | awk -v OFS="\t" '&#123;print $1,$2,$3&#125;' |bedtools intersect -a - -b TAIR10_Transposable_Elements.replacechr.bed -wo | awk '&#123;a[$7]&#125;END&#123;print length(a)&#125;'</span><br><span class="line">6544</span><br></pre></td></tr></table></figure></li></ol><h4 id="统计单倍型长度"><a href="#统计单倍型长度" class="headerlink" title="统计单倍型长度"></a>统计单倍型长度</h4><ol><li><p>DNA甲基化 + SNP</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | bedtools merge &gt; BS-cviler.hapcut2.haplo.merge.bed</span><br><span class="line">[11:08:48] qwzhou@login:~/practice/tair_zwang/PM :</span><br><span class="line"><span class="meta">$</span><span class="bash"> awk <span class="string">'&#123;if($3-$2&gt;2000)&#123;a++&#125;else if($3-$2&gt;1000)&#123;b++&#125;else if($3-$2&gt;500)&#123;c++&#125;&#125;END&#123;print a,b,c&#125;'</span> BS-cviler.hapcut2.haplo.merge.bed</span></span><br><span class="line">558 1533 5535</span><br></pre></td></tr></table></figure></li><li><p>SNP</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" '$1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0)&#123;print "=== "chr,start,end"\n"inf&#125;;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.hapcut2.snp.haplo.txt | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | awk '&#123;if($3-$2&gt;2000)&#123;a++&#125;else if($3-$2&gt;1000)&#123;b++&#125;else if($3-$2&gt;500)&#123;c++&#125;&#125;END&#123;print a,b,c&#125;'</span><br><span class="line">14 162 785</span><br></pre></td></tr></table></figure></li><li><p>DNA甲基化+SNP组装 (但是包含SNP)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" 'ARGIND==1&#123;v[$1" "$2]&#125;ARGIND!=1 &amp;&amp; $1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0 &amp;&amp; pp==1)&#123;print "=== "chr,start,end"\n"inf&#125;;pp=0;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0 &amp;&amp; pp==1)&#123;print "=== "chr,start,end"\n"inf&#125;;pp=0;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if($4" "$5 in v)&#123;pp=1&#125;;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.snp.hetero.vcf BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | bedtools merge | awk '&#123;if($3-$2&gt;2000)&#123;a++&#125;else if($3-$2&gt;1000)&#123;b++&#125;else if($3-$2&gt;500)&#123;c++&#125;&#125;END&#123;print a,b,c&#125;'</span><br><span class="line">474 1325 4406</span><br></pre></td></tr></table></figure></li></ol><h4 id="统计单倍型总长度"><a href="#统计单倍型总长度" class="headerlink" title="统计单倍型总长度"></a>统计单倍型总长度</h4><ol start="2"><li>DNA甲基化+SNP (包含SNP)<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS="\t" 'ARGIND==1&#123;v[$1" "$2]&#125;ARGIND!=1 &amp;&amp; $1!~/\*/&#123;if($1~/BLOCK/)&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0 &amp;&amp; pp==1)&#123;print "=== "chr,start,end"\n"inf&#125;;pp=0;chr="";start=0;end=0;inf="";&#125;else&#123;if($2=="-")&#123;if(chr!="" &amp;&amp; end&gt;start &amp;&amp; start!=0 &amp;&amp; pp==1)&#123;print "=== "chr,start,end"\n"inf&#125;;pp=0;chr="";start=0;end=0;inf=""&#125;else if($2==0 || $2==1)&#123;if($4" "$5 in v)&#123;pp=1&#125;;if(start==0)&#123;chr=$4;start=$5;inf=$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7&#125;else&#123;inf=inf"\n"$2"\t"$3"\t"$4"\t"$5"\t"$6"\t"$7;if($5&gt;end)&#123;end=$5&#125;&#125;&#125;&#125;&#125;' BS-cviler.snp.hetero.vcf BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt  | awk -v OFS="\t" '$1~/^=/&#123;print $2,$3,$4&#125;' | sort -k1,1 -k2,2n -k3,3n | bedtools merge | awk '&#123;a+=($3-$2);b++&#125;END&#123;print a,b,a/b&#125;'</span><br><span class="line">13787280 54362 253.62</span><br></pre></td></tr></table></figure></li></ol><h4 id="统计覆盖在基因组上phased信息"><a href="#统计覆盖在基因组上phased信息" class="headerlink" title="统计覆盖在基因组上phased信息"></a>统计覆盖在基因组上phased信息</h4><p>首先切割基因组：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'&#123;bin=2000;l=1;len=int($2/bin);for(i=0;i&lt;len;i++)&#123;print $1,i*bin+1,(i+1)*bin,l;l++&#125;;if(len*bin &lt; $2)&#123;print $1,len*bin+1, $2,l&#125;&#125;'</span> ~/practice/Genome/arabidopsis/TAIR10_chr_all.fa.fai &gt; TAIR10.splitby2k.bed</span><br></pre></td></tr></table></figure></p><p>处理meth haplo，因为正负链不在一个文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'$1!~/^B/ &amp;&amp; $1!~/^*/&#123;print $4"\t"$5&#125;'</span> BS-cviler.p.hapcut2.haplo.txt BS-cviler.n.hapcut2.haplo.txt | sort -k1,1 -k2,2n &gt; BS-cviler.hapcut2.methsnv.sites.txt</span><br></pre></td></tr></table></figure></p><p>统计phased数目<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'ARGIND==1 &amp;&amp; $1!~/^#/&#123;sn[$1"\t"$2]&#125;ARGIND==2&#123;a[$4"\t"int($5/2000+1)]++&#125;ARGIND==3&#123;if($1"\t"$2 in sn)&#123;b[$1"\t"int($2/2000+1)]++&#125;&#125;ARGIND==4&#123;c[$1"\t"int($2/2000+1)]++&#125;ARGIND==5&#123;if($1"\t"$4 in a)&#123;v=a[$1"\t"$4]&#125;else&#123;v=0&#125;; if($1"\t"$4 in b)&#123;mv=b[$1"\t"$4]&#125;else&#123;mv=0&#125;;if($1"\t"$4 in c)&#123;m=c[$1"\t"$4]&#125;else&#123;m=0&#125;; print $1,$4,v,mv,m&#125;'</span> BS-cviler.snp.hetero.vcf  BS-cviler.hapcut2.snp.haplo.txt BS-cviler.hapcut2.methsnv.sites.txt BS-cviler.hapcut2.methsnv.sites.txt TAIR10.splitby2k.bed &gt; phased.txt</span><br></pre></td></tr></table></figure></p><p>–&gt; 2Kb太短了，换成10Kb<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## split genome</span></span><br><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'&#123;bin=10000;l=1;len=int($2/bin);for(i=0;i&lt;len;i++)&#123;print $1,i*bin+1,(i+1)*bin,l;l++&#125;;if(len*bin &lt; $2)&#123;print $1,len*bin+1, $2,l&#125;&#125;'</span> ~/practice/Genome/arabidopsis/TAIR10_chr_all.fa.fai &gt; TAIR10.splitby10k.bed</span><br><span class="line"><span class="comment">## 统计数目</span></span><br><span class="line">awk -v bin=10000 -v OFS=<span class="string">"\t"</span> <span class="string">'ARGIND==1 &amp;&amp; $1!~/^#/&#123;sn[$1"\t"$2]&#125;ARGIND==2&#123;a[$4"\t"int($5/bin+1)]++&#125;ARGIND==3&#123;if($1"\t"$2 in sn)&#123;b[$1"\t"int($2/bin+1)]++&#125;&#125;ARGIND==4&#123;c[$1"\t"int($2/bin+1)]++&#125;ARGIND==5&#123;if($1"\t"$4 in a)&#123;v=a[$1"\t"$4]&#125;else&#123;v=0&#125;; if($1"\t"$4 in b)&#123;mv=b[$1"\t"$4]&#125;else&#123;mv=0&#125;;if($1"\t"$4 in c)&#123;m=c[$1"\t"$4]&#125;else&#123;m=0&#125;; print $1,$4,v,mv,m&#125;'</span> BS-cviler.snp.hetero.vcf  BS-cviler.hapcut2.snp.haplo.txt BS-cviler.hapcut2.methsnv.sites.txt BS-cviler.hapcut2.methsnv.sites.txt TAIR10.splitby10k.bed &gt; phased.10k.txt</span><br></pre></td></tr></table></figure></p><p>画线图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">a&lt;-read.table(&quot;phased.10k.txt&quot;)</span><br><span class="line">names(a)=c(&quot;chr&quot;,&quot;coord&quot;,&quot;SNV&quot;, &quot;MethSNV.SNV&quot;, &quot;MethSNV&quot;)</span><br><span class="line">a&lt;-a[a$chr==&quot;1&quot;,]</span><br><span class="line">profile_text&lt;-a[c(3,4,5)]</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(reshape2)</span><br><span class="line">profile_text$xvariable = rownames(profile_text)</span><br><span class="line">data_m &lt;- melt(profile_text, id.vars=c(&quot;xvariable&quot;))</span><br><span class="line">data_m$xvariable &lt;- as.numeric(data_m$xvariable)</span><br><span class="line"></span><br><span class="line">##线图</span><br><span class="line">data_m2&lt;-data_m[data_m$variable!=&quot;MethSNV&quot;,]</span><br><span class="line">p &lt;- ggplot(data_m2, aes(x=xvariable, y=value,color=variable,group=variable)) + stat_smooth(method=&quot;auto&quot;, se=FALSE)</span><br><span class="line">p +labs(title=&quot;&quot;,x=&quot;&quot;, y = &quot;Phased number&quot;)+</span><br><span class="line">  theme_bw() + ## 背景</span><br><span class="line">  theme(panel.grid =element_blank()) + ## 删去网格线</span><br><span class="line">  theme(plot.title = element_text(hjust = 0.5, size = 18, colour = &quot;black&quot;, face = &quot;bold&quot;) ,axis.title.y = </span><br><span class="line">          element_text(size=16,colour = &quot;black&quot;,face = &quot;bold&quot;), </span><br><span class="line">        axis.text.y = element_text(size=10, colour = &quot;black&quot;), </span><br><span class="line">        axis.text.x = element_text(size=16, colour = &quot;black&quot;), legend.position = c(0.85,0.5))</span><br><span class="line">## 箱线图</span><br><span class="line">names(a)=c(&quot;chr&quot;,&quot;coord&quot;,&quot;SNV&quot;, &quot;MethSNV.SNV&quot;, &quot;MethSNV&quot;)</span><br><span class="line">profile_text&lt;-a[c(3,4,5)]</span><br><span class="line">profile_text$xvariable = rownames(profile_text)</span><br><span class="line">data_m &lt;- melt(profile_text, id.vars=c(&quot;xvariable&quot;))</span><br><span class="line">data_m$xvariable &lt;- as.numeric(data_m$xvariable)</span><br><span class="line">data_m2&lt;-data_m[data_m$variable!=&quot;MethSNV&quot;,]</span><br><span class="line">data_m2$value &lt;- pmin(data_m2$value,100)</span><br><span class="line">pdf(&quot;tet.pdf&quot;)</span><br><span class="line">p &lt;- ggplot(data_m2, aes(x=variable, y=value,color=variable,group=variable)) +geom_boxplot()</span><br><span class="line">p</span><br><span class="line">dev.off()</span><br></pre></td></tr></table></figure></p><h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p>Chen, Z., Hagen, D. E., Ji, T., Elsik, C. G., &amp; Rivera, R. M. (2017). Global misregulation of genes largely uncoupled to DNA methylome epimutations characterizes a congenital overgrowth syndrome. <em>Scientific reports</em>, <em>7</em>(1), 12667. doi:10.1038/s41598-017-13012-z</p><p>值得注意的是，在骨骼肌中，参与成肌细胞增殖和肌管融合的多种途径在LOS胎儿中被错误调节。此外，骨骼肌DNA甲基组的特征表明LOS和对照组之间存在许多局部甲基化差异；然而，只有一小部分差异表达基因（DEG），包括印记基因IGF2R，可能与相邻的差异甲基化区域有关。总之，我们不仅表明非印记基因的错误调节和印记缺失是ART诱导的过度生长综合征的特征，而且证明大多数DEG与DNA甲基体表观突变没有直接关联。</p><p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5477265/" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5477265/</a></p><p>Hap-ASM</p><p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5320668/" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5320668/</a></p><p>Vincent, M., Mundbjerg, K., Skou Pedersen, J., Liang, G., Jones, P. A., Ørntoft, T. F., … Wiuf, C. (2017). epiG: statistical inference and profiling of DNA methylation from whole-genome bisulfite sequencing data. <em>Genome biology</em>, <em>18</em>(1), 38. doi:10.1186/s13059-017-1168-4</p><p>DNA甲基化单倍型与核小体占有率</p><p>Cheung, W. A., Shao, X., Morin, A., Siroux, V., Kwan, T., Ge, B., … Grundberg, E. (2017). Functional variation in allelic methylomes underscores a strong genetic contribution and reveals novel epigenetic alterations in the human epigenome. <em>Genome biology</em>, <em>18</em>(1), 50. doi:10.1186/s13059-017-1173-7</p><p>七百多个样本检测ASM与表型相关的基因。</p><p>Marzi, S. J., Meaburn, E. L., Dempster, E. L., Lunnon, K., Paya-Cano, J. L., Smith, R. G., … Mill, J. (2016). Tissue-specific patterns of allelically-skewed DNA methylation. <em>Epigenetics</em>, <em>11</em>(1), 24–35. doi:10.1080/15592294.2015.1127479</p><p>虽然DNA甲基化通常被认为是对称的两个等位基因，但也有一些值得注意的例外。基因组印记和X染色体失活是等位基因特异性甲基化（ASM）的两个被广泛研究的来源，但最近的研究表明，更复杂的模式，即基因型变异可能与顺式结构中等位基因偏斜的DNA甲基化有关。鉴于已知的跨组织和细胞类型的DNA甲基化的异质性，我们研究了人脑的几个区域和来自多个个体的全血中ASM的个体间和个体内变异。与以前的研究一致，我们发现广泛的ASM，在被询问的22万个位点中有4%以上的位点显示出等位基因甲基化的证据。我们确定了ASM侧翼已知的印记区域，并表明ASM位点富含dnase I超敏位点，通常位于中间DNA甲基化的扩展基因组背景中。我们还发现了基因型驱动的ASM的例子，其中一些是组织特异性的。这些发现有助于我们理解组织间差异DNA甲基化的性质，并对复杂疾病的遗传学研究具有重要意义。作为社区的一种资源，所研究的每个组织的ASM模式都可以在一个可搜索的在线数据库中找到：<a href="http://epigenemics.essex.ac.uk/asmbranblood。" target="_blank" rel="noopener">http://epigenemics.essex.ac.uk/asmbranblood。</a></p><p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5373555/" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5373555/</a></p><p>Li, W., Xu, W., Fu, G., Ma, L., Richards, J., Rao, W., … Song, Q. (2015). High-accuracy haplotype imputation using unphased genotype data as the references. <em>Gene</em>, <em>572</em>(2), 279–284. doi:10.1016/j.gene.2015.07.082</p><p>大量增长的基因组数据集对缺失的数据输入提出了新的挑战，这是一项众所周知的资源需求任务。单倍型需要种族匹配的参考。然而，迄今为止，在世界上大多数人口中没有单倍型参考。我们试图利用现有的非相位基因型（这是啥？）数据作为参考；如果成功，它将覆盖世界上几乎所有的种群。结果表明，我们的hifi软件成功地获得了99.43%的准确率，与无相基因型参考。该方法为突破大数据时代单倍型插补参考可用性有限的瓶颈提供了一种经济有效的解决方案。</p><p>单倍型的重要性</p><p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4254418/" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4254418/</a></p><p>Glusman, G., Cox, H. C., &amp; Roach, J. C. (2014). Whole-genome haplotyping approaches and genomic medicine. <em>Genome medicine</em>, <em>6</em>(9), 73. doi:10.1186/s13073-014-0073-7</p><p>报道的单倍型而非基因型的基因组信息对于个体化医学将越来越重要。目前的技术产生的二倍体序列数据很少被分解成其组成的单倍型。此外，考虑基因组信息的范例是基于解释基因型而不是单倍型。然而，单倍型在历史上一直是有用的背景下，从群体遗传学到疾病基因绘图的努力。分阶段基因组序列数据的主要方法是分子单倍体、遗传单倍体和基于人群的推断。长读测序技术使分子单倍型更长，而全基因组测序成本的降低使全染色体遗传单倍型测序成为可能。混合方法结合了高吞吐量短读汇编和战略方法，使物理或虚拟分块的读单倍型是使多基因单倍型产生的单个个体。这些技术可以与遗传和种群方法进一步结合。在这里，我们回顾了全基因组单倍体方法的进展，并讨论了单倍体在基因组医学中的重要性。临床应用包括通过识别复合杂合子和分阶段调节变异编码变异来诊断。单倍型比单核苷酸变异体等不太复杂的变异体更具特异性，在预后和诊断、肿瘤分析和移植组织分型中也有应用。未来的进展将包括技术创新，应用标准指标评估单倍型质量，以及开发将单倍型与疾病联系起来的数据库。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h2 id=&quot;工作&quot;&gt;&lt;a href=&quot;#工作&quot; class=&quot;headerlink&quot; title=&quot;工作&quot;&gt;&lt;/a&gt;工作&lt;/h2&gt;&lt;p&gt;1 整理拟南芥数据结果。&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="project" scheme="https://zhouqiangwei.github.io/categories/project/"/>
    
    
      <category term="project" scheme="https://zhouqiangwei.github.io/tags/project/"/>
    
      <category term="methhap" scheme="https://zhouqiangwei.github.io/tags/methhap/"/>
    
  </entry>
  
  <entry>
    <title>project_log</title>
    <link href="https://zhouqiangwei.github.io/2019/03/19/project-log/"/>
    <id>https://zhouqiangwei.github.io/2019/03/19/project-log/</id>
    <published>2019-03-19T08:38:48.000Z</published>
    <updated>2019-04-08T02:06:14.965Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="temp-work-need-to-finish"><a href="#temp-work-need-to-finish" class="headerlink" title="temp work need to finish"></a>temp work need to finish</h2><h3 id="DNA甲基化单倍型"><a href="#DNA甲基化单倍型" class="headerlink" title="DNA甲基化单倍型"></a>DNA甲基化单倍型</h3><h4 id="拟南芥F1"><a href="#拟南芥F1" class="headerlink" title="拟南芥F1"></a>拟南芥F1</h4><pre><code>1. 单倍型长度2. 覆盖repeat数目3. ASM</code></pre><h4 id="HepG2-K562-WGS单倍型"><a href="#HepG2-K562-WGS单倍型" class="headerlink" title="HepG2 K562 WGS单倍型"></a>HepG2 K562 WGS单倍型</h4><h4 id="HiC-WGBS-单倍型整合"><a href="#HiC-WGBS-单倍型整合" class="headerlink" title="HiC + WGBS 单倍型整合"></a>HiC + WGBS 单倍型整合</h4><h4 id="HiC-DNA甲基化-单倍型"><a href="#HiC-DNA甲基化-单倍型" class="headerlink" title="HiC-DNA甲基化 单倍型"></a>HiC-DNA甲基化 单倍型</h4><h3 id="DNA甲基化数据库"><a href="#DNA甲基化数据库" class="headerlink" title="DNA甲基化数据库"></a>DNA甲基化数据库</h3><h4 id="根据excel-RNAseq与BSseq对应关系，测试数据。"><a href="#根据excel-RNAseq与BSseq对应关系，测试数据。" class="headerlink" title="根据excel RNAseq与BSseq对应关系，测试数据。"></a>根据excel RNAseq与BSseq对应关系，测试数据。</h4><h3 id="DNA甲基化SNP检测"><a href="#DNA甲基化SNP检测" class="headerlink" title="DNA甲基化SNP检测"></a>DNA甲基化SNP检测</h3><p><strong>想法：</strong></p><ol><li>每条read的信息； readid pos var</li><li>忘记了 😂， 在冲锋衣口袋里</li></ol>]]></content>
    
    <summary type="html">
    
      summary of project
    
    </summary>
    
      <category term="project" scheme="https://zhouqiangwei.github.io/categories/project/"/>
    
    
      <category term="project" scheme="https://zhouqiangwei.github.io/tags/project/"/>
    
      <category term="summary" scheme="https://zhouqiangwei.github.io/tags/summary/"/>
    
  </entry>
  
  <entry>
    <title>伯努利分布、二项式分布、beta分布、bayesian</title>
    <link href="https://zhouqiangwei.github.io/2019/03/07/statics-distribution/"/>
    <id>https://zhouqiangwei.github.io/2019/03/07/statics-distribution/</id>
    <published>2019-03-07T09:28:47.000Z</published>
    <updated>2019-03-07T09:41:54.021Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1-伯努力分布-Bernoulli-distribution"><a href="#1-伯努力分布-Bernoulli-distribution" class="headerlink" title="1. 伯努力分布 (Bernoulli distribution)"></a>1. 伯努力分布 (Bernoulli distribution)</h2><p>伯努利分布及两点分布，0-1分布。伯努利分布结果只能是两种情况，例如抛硬币。</p><p>如果独立重复n次，则称为n重伯努利。伯努利分布属于离散型概率分布。</p><h2 id="2-二项式分布-Binomial-distribution"><a href="#2-二项式分布-Binomial-distribution" class="headerlink" title="2. 二项式分布 (Binomial distribution)"></a>2. 二项式分布 (Binomial distribution)</h2><p>伯努利分布是二项式分布在n=1时的特例，n表示重复次数。</p><p>二项分布的典型例子是扔硬币，硬币正面朝上概率为p, 重复n次，k次为正面的概率即为一个二项分布概率。    k~B(n,p)</p><h2 id="3-多项分布"><a href="#3-多项分布" class="headerlink" title="3. 多项分布"></a>3. 多项分布</h2><blockquote><p>多项式分布(Multinomial Distribution)是二项式分布的推广。二项式做n次伯努利实验，规定了每次试验的结果只有两个，如果现在还是做n次试验，只不过每次试验的结果可以有多m个，且m个结果发生的概率互斥且和为1，则发生其中一个结果X次的概率就是多项式分布。</p><p>扔骰子是典型的多项式分布。</p></blockquote>]]></content>
    
    <summary type="html">
    
      伯努利分布、二项式分布、beta分布、贝叶斯介绍。
    
    </summary>
    
      <category term="统计" scheme="https://zhouqiangwei.github.io/categories/%E7%BB%9F%E8%AE%A1/"/>
    
    
      <category term="伯努利分布" scheme="https://zhouqiangwei.github.io/tags/%E4%BC%AF%E5%8A%AA%E5%88%A9%E5%88%86%E5%B8%83/"/>
    
      <category term="二项式分布" scheme="https://zhouqiangwei.github.io/tags/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%88%86%E5%B8%83/"/>
    
      <category term="beta分布" scheme="https://zhouqiangwei.github.io/tags/beta%E5%88%86%E5%B8%83/"/>
    
      <category term="贝叶斯" scheme="https://zhouqiangwei.github.io/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF/"/>
    
  </entry>
  
  <entry>
    <title>paper</title>
    <link href="https://zhouqiangwei.github.io/2018/12/27/paper/"/>
    <id>https://zhouqiangwei.github.io/2018/12/27/paper/</id>
    <published>2018-12-27T11:12:44.000Z</published>
    <updated>2019-01-06T07:34:11.913Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1st"><a href="#1st" class="headerlink" title="1st"></a>1st</h2><h3 id="2018"><a href="#2018" class="headerlink" title="2018"></a>2018</h3><p>An Integrated Package for Bisulfite DNA Methylation Data Analysis with Indel-sensitive Mapping</p><p><img src="/2018/12/27/paper/batmeth2.png" alt="batmeth2"></p><h3 id="2016"><a href="#2016" class="headerlink" title="2016"></a>2016</h3><p>Tan, F., Zhou, C., <strong>Zhou, Q</strong>., Zhou, S., Yang, W., Zhao, Y., Li, G., … Zhou, D. X. (2016). Analysis of Chromatin Regulators Reveals Specific Features of Rice DNA Methylation Pathways. <em>Plant physiology</em>, <em>171</em>(3), 2041-54.</p><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="2018-1"><a href="#2018-1" class="headerlink" title="2018"></a>2018</h3><p>Zhou, C., Wang, C., Liu, H., <strong>Zhou, Q.</strong>, Liu, Q., Guo, Y., Peng, T., Song, J., Zhang, J., Chen, L., Zhao, Y., Zeng, Z., Zhou, D.-X., 2018. Identification and analysis of adenine N6-methylation sites in the rice genome. Nature Plants 4, 554-563.</p><h3 id="2016-1"><a href="#2016-1" class="headerlink" title="2016"></a>2016</h3><p>Zhou, S., Liu, X., Zhou, C., <strong>Zhou, Q.</strong>, Zhao, Y., Li, G., &amp; Zhou, D. X. (2016). Cooperation between the H3K27me3 Chromatin Mark and Non-CG Methylation in Epigenetic Regulation. <em>Plant physiology</em>, <em>172</em>(2), 1131-1141.</p><h2 id="2014"><a href="#2014" class="headerlink" title="2014"></a>2014</h2><p>Li, G., Cai, L., Chang, H., Hong, P., <strong>Zhou, Q.</strong>, Kulakova, E. V., Kolchanov, N. A., … Ruan, Y. (2014). Chromatin Interaction Analysis with Paired-End Tag (ChIA-PET) sequencing technology and application. <em>BMC genomics</em>, <em>15 Suppl 12</em>(Suppl 12), S11.</p>]]></content>
    
    <summary type="html">
    
      paper published
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="workfinished" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/workfinished/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="workfinished" scheme="https://zhouqiangwei.github.io/tags/workfinished/"/>
    
  </entry>
  
  <entry>
    <title>20181225</title>
    <link href="https://zhouqiangwei.github.io/2018/12/25/20181225/"/>
    <id>https://zhouqiangwei.github.io/2018/12/25/20181225/</id>
    <published>2018-12-25T03:14:03.000Z</published>
    <updated>2019-01-06T07:34:11.871Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="HapCut2-methylation"><a href="#HapCut2-methylation" class="headerlink" title="HapCut2 methylation"></a>HapCut2 methylation</h2><h3 id="F123-WGBS"><a href="#F123-WGBS" class="headerlink" title="F123 WGBS"></a>F123 WGBS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[11:12:27] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ awk -v OFS=<span class="string">"\t"</span> <span class="string">'$3=="+" &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,".\tC\tT\t600\tPASS\t.\tGT\t0/1"&#125;'</span> F123bt2.methratio.txt &gt; methyF123.mr.methratio.p.txt</span><br><span class="line">[11:27:05] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ awk -v OFS=<span class="string">"\t"</span> <span class="string">'$3=="-" &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,".\tG\tA\t600\tPASS\t.\tGT\t0/1"&#125;'</span> F123bt2.methratio.txt &gt; methyF123.mr.methratio.n.txt</span><br><span class="line"></span><br><span class="line">[11:40:03] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ cat ../methyHic/GSE48592_castx129_variants.mm10.vcf methyF123.mr.methratio.n.txt &gt; methyF123.snpwithmr.n.vcf</span><br><span class="line">[11:42:46] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ cat ../methyHic/GSE48592_castx129_variants.mm10.vcf methyF123.mr.methratio.p.txt &gt; methyF123.snpwithmr.p.vcf</span><br></pre></td></tr></table></figure><h4 id="sort-merged-vcf"><a href="#sort-merged-vcf" class="headerlink" title="sort merged vcf"></a>sort merged vcf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[11:46:23] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ sh run.sortvcf.sh methyF123.snpwithmr.n.vcf methyF123.snpwithmr.n.sort.vcf</span><br><span class="line"></span><br><span class="line">[11:46:23] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ sh run.sortvcf.sh methyF123.snpwithmr.p.vcf methyF123.snpwithmr.p.sort.vcf</span><br></pre></td></tr></table></figure><h3 id="只运行chr1："><a href="#只运行chr1：" class="headerlink" title="只运行chr1："></a>只运行chr1：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[14:17:00] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ awk <span class="string">'$1~/^#/ || $1=="chr1"'</span> methyF123.snpwithmr.p.sort.vcf &gt; methyF123.snpwithmr.p.sort.chr1.vcf</span><br><span class="line">[14:17:29] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ awk <span class="string">'$1~/^#/ || $1=="chr1"'</span> methyF123.snpwithmr.n.sort.vcf &gt; methyF123.snpwithmr.n.sort.chr1.vcf</span><br><span class="line"></span><br><span class="line"><span class="comment">###plus</span></span><br><span class="line">[11:43:55] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam F123.align.sort.p.bam --VCF methyF123.snpwithmr.p.sort.chr1.vcf --out methyF123.methsnv.p.chr1.fragment_file</span><br><span class="line"></span><br><span class="line">[09:33:13] qwzhou@node62:~/practice/mus_hic_mth/wgbs :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --fragments methyF123.methsnv.p.chr1.fragment_file --vcf methyF123.snpwithmr.p.sort.chr1.vcf --output methyF123.methsnv.p.haplo.chr1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">##neg</span></span><br><span class="line">[22:29:44] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam F123.align.sort.n.bam --VCF methyF123.snpwithmr.n.sort.chr1.chr1.vcf --out methyF123.methsnv.n.chr1.fragment_file</span><br><span class="line"></span><br><span class="line">[09:35:27] qwzhou@node62:~/practice/mus_hic_mth/wgbs :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --fragments methyF123.methsnv.n.chr1.fragment_file --vcf methyF123.snpwithmr.n.sort.chr1.vcf --output methyF123.methsnv.n.chr1.haplo.txt</span><br></pre></td></tr></table></figure><h3 id="hapcut2"><a href="#hapcut2" class="headerlink" title="hapcut2"></a>hapcut2</h3><h4 id="plus"><a href="#plus" class="headerlink" title="plus"></a>plus</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[11:43:55] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam F123.align.sort.p.bam --VCF methyF123.snpwithmr.p.sort.vcf --out methyF123.methsnv.p.fragment_file</span><br><span class="line"></span><br><span class="line">[09:33:13] qwzhou@node62:~/practice/mus_hic_mth/wgbs :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --fragments methyF123.methsnv.p.fragment_file --vcf methyF123.snpwithmr.p.sort.vcf --output methyF123.methsnv.p.haplo.txt</span><br></pre></td></tr></table></figure><h4 id="neg"><a href="#neg" class="headerlink" title="neg"></a>neg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[22:29:44] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam F123.align.sort.n.bam --VCF methyF123.snpwithmr.n.sort.vcf --out methyF123.methsnv.n.fragment_file</span><br><span class="line"></span><br><span class="line">[09:35:27] qwzhou@node62:~/practice/mus_hic_mth/wgbs :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --fragments methyF123.methsnv.n.fragment_file --vcf methyF123.snpwithmr.n.sort.vcf --output methyF123.methsnv.n.haplo.txt</span><br></pre></td></tr></table></figure><h2 id="F123-methyHiC"><a href="#F123-methyHiC" class="headerlink" title="F123 methyHiC"></a>F123 methyHiC</h2><h3 id="SNP-format"><a href="#SNP-format" class="headerlink" title="SNP format"></a>SNP format</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[22:32:05] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ awk -v OFS=&quot;\t&quot; &apos;$3==&quot;+&quot; &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,&quot;.\tC\tT\t600\tPASS\t.\tGT\t0/1&quot;&#125;&apos; methyHiC.mr.methratio.txt &gt; methyHiC.mr.methratio.p.txt</span><br><span class="line">[22:40:51] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ awk -v OFS=&quot;\t&quot; &apos;$3==&quot;-&quot; &amp;&amp; $6&gt;=10 &amp;&amp; ($7&gt;=0.2 &amp;&amp; $7&lt;=0.8)&#123;print $1,$2,&quot;.\tG\tA\t600\tPASS\t.\tGT\t0/1&quot;&#125;&apos; methyHiC.mr.methratio.txt &gt; methyHiC.mr.methratio.n.txt</span><br><span class="line">[22:50:56] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ cat GSE48592_castx129_variants.mm10.vcf methyHiC.mr.methratio.n.txt &gt; methyHiC.snpwithmr.n.vcf</span><br><span class="line">[22:51:52] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ cat GSE48592_castx129_variants.mm10.vcf methyHiC.mr.methratio.p.txt &gt; methyHiC.snpwithmr.p.vcf</span><br><span class="line">[22:55:22] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ sh run.sortvcf.sh methyHiC.snpwithmr.n.vcf methyHiC.snpwithmr.n.sort.vcf</span><br><span class="line">[23:07:29] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ sh run.sortvcf.sh methyHiC.snpwithmr.p.vcf methyHiC.snpwithmr.p.sort.vcf</span><br></pre></td></tr></table></figure><h3 id="methyHiC-hapcut"><a href="#methyHiC-hapcut" class="headerlink" title="methyHiC hapcut"></a>methyHiC hapcut</h3><h4 id="plus-1"><a href="#plus-1" class="headerlink" title="plus"></a>plus</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[22:29:44] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam methyHiC.sort.p.bam --VCF methyHiC.snpwithmr.p.sort.vcf --out methyHiC.methsnv.p.fragment_file</span><br><span class="line"></span><br><span class="line">[09:33:13] qwzhou@node62:~/practice/mus_hic_mth/methyHic :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --v 1 --t 80 --fragments methyHiC.methsnv.p.fragment_file --vcf methyHiC.snpwithmr.p.sort.vcf --output methyHiC.methsnv.p.haplo.txt</span><br></pre></td></tr></table></figure><h4 id="neg-1"><a href="#neg-1" class="headerlink" title="neg"></a>neg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[22:29:44] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam methyHiC.sort.n.bam --VCF methyHiC.snpwithmr.n.sort.vcf --out methyHiC.methsnv.n.fragment_file</span><br><span class="line"></span><br><span class="line">[09:35:27] qwzhou@node62:~/practice/mus_hic_mth/methyHic :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --v 1 --t 80 --fragments methyHiC.methsnv.n.fragment_file --vcf methyHiC.snpwithmr.n.sort.vcf --output methyHiC.methsnv.n.haplo.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h2 id=&quot;HapCut2-methylation&quot;&gt;&lt;a href=&quot;#HapCut2-methylation&quot; class=&quot;headerlink&quot; title=&quot;HapC
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://zhouqiangwei.github.io/2018/12/24/BSNPS/"/>
    <id>https://zhouqiangwei.github.io/2018/12/24/BSNPS/</id>
    <published>2018-12-24T06:23:24.000Z</published>
    <updated>2019-03-05T07:51:51.623Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Bisulfite-seq-Single-Nucleotide-Polymorphism-Scan-Calling-BSNPS-BSNPC"><a href="#Bisulfite-seq-Single-Nucleotide-Polymorphism-Scan-Calling-BSNPS-BSNPC" class="headerlink" title="Bisulfite-seq Single Nucleotide Polymorphism Scan/Calling (BSNPS/BSNPC)"></a>Bisulfite-seq Single Nucleotide Polymorphism Scan/Calling (BSNPS/BSNPC)</h1><h2 id="Results-1-Sample-HUES64"><a href="#Results-1-Sample-HUES64" class="headerlink" title="Results 1 [Sample: HUES64]"></a>Results 1 [Sample: HUES64]</h2><p><strong>workdir:</strong> [14:45:13] qwzhou@login:~/practice/HUES64/test</p><p><strong>data:</strong> HUES64</p><p><strong>Tested chromosome:</strong> chr1</p><h4 id="WGS"><a href="#WGS" class="headerlink" title="WGS"></a>WGS</h4><p><strong>filename:</strong> wgs.snp.all.default.vcf</p><p><strong>SNP:</strong> 285348</p><h4 id="WGBS"><a href="#WGBS" class="headerlink" title="WGBS"></a>WGBS</h4><h5 id="bssnper"><a href="#bssnper" class="headerlink" title="bssnper"></a>bssnper</h5><p><strong>filename:</strong> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out</p><p><strong>SNP:</strong> 185617</p><h5 id="bissnp"><a href="#bissnp" class="headerlink" title="bissnp"></a>bissnp</h5><p><strong>filename:</strong> [14:32:19] qwzhou@comput54: ~/practice/HUES64/tes/wgbs.replace.sort.snp.filtered.sort.vcf</p><p><strong>SNP:</strong> 134547</p><p>Overlap between WGS and WGBS</p><table><thead><tr><th style="text-align:left">Tools</th><th style="text-align:center">number of SNPs</th><th style="text-align:center">overlap with WGS</th></tr></thead><tbody><tr><td style="text-align:left">BS-SNPer</td><td style="text-align:center">185617</td><td style="text-align:center">118307 (63.7%)</td></tr><tr><td style="text-align:left">BiS-SNP</td><td style="text-align:center">134547</td><td style="text-align:center">116521 (86.6%)</td></tr><tr><td style="text-align:left">WGS</td><td style="text-align:center">285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/alldefault.png" width="300" height="256" div="" align="center"></p><h3 id="new-bsnps-v0-1"><a href="#new-bsnps-v0-1" class="headerlink" title="new-bsnps-v0.1"></a>new-bsnps-v0.1</h3><p><strong>Modify:</strong> bayes genotype function, likehood function.</p><p>Genotype: Bayesian modeling $P(G|D)$</p><p>$P(G|D) = P(G) * P(D|G) / P(D)$</p><p>The prior distribution of the genotype: $P(G)$</p><p>Likelihood: $P(D|G)$, probability of observing reads $D$ given genotype $G$</p><p>$P(D│G)= ∏^n_{(i=1)}P(D_i |G)$</p><p>Where $i=1, 2, …, n$, and n is the number of reads.</p><p>Genotypes: $AA, AT, AC, AG, TT, TC, TG, CC, CG, GG​$</p><h4 id="Available-base-in-BS-seq-data"><a href="#Available-base-in-BS-seq-data" class="headerlink" title="Available base in BS-seq data:"></a>Available base in BS-seq data:</h4><table><thead><tr><th style="text-align:center">Base</th><th style="text-align:center">Waston</th><th style="text-align:center">Crick</th></tr></thead><tbody><tr><td style="text-align:center">T</td><td style="text-align:center">T</td><td style="text-align:center">T</td></tr><tr><td style="text-align:center">C</td><td style="text-align:center">Cm / Tu</td><td style="text-align:center">C</td></tr><tr><td style="text-align:center">A</td><td style="text-align:center">A</td><td style="text-align:center">A</td></tr><tr><td style="text-align:center">G</td><td style="text-align:center">G</td><td style="text-align:center">Gm / Au</td></tr></tbody></table><p>BS-Seq data table of waston and crick bases in the sequencing read. m stands for methylated and u stands for unmethylated. We can see if there is a conflict between different bases according to this table, then calculated the mutation probability. </p><p>For example, if we want to calculate the mutation probability of C to T, it can be seen that both C and T have T in the waston strand, as shown in the following table. We mark the conflicting information in blue and available information in red. Therefore, the C to T mutation probability formula is: $crickT / ( crickT + crickC)$.  </p><table><tbody><br>    <tr><br>        <th>Base</th><th>Waston</th><th>Crick</th><br>    </tr><br>    <tr><br>        <td>C</td><br>        <td>Cm / <font color="LightSeaGreen">Tu</font></td><br>        <td><font color="Hotpink">C</font></td><br>    </tr><br>    <tr><br>        <td>T</td><br>        <td><font color="LightSeaGreen">T</font></td><br>        <td><font color="Hotpink">T</font></td><br>    </tr><br></tbody></table><h4 id="lilelihood-function"><a href="#lilelihood-function" class="headerlink" title="lilelihood function"></a>lilelihood function</h4><p>The likelihood function need consider bisulfite treatment in BS-Seq data. The details showed in below:</p><p>P: probability of the corresponding base call is correct</p><p>Q: probability of the corresponding base call is incorrect</p><p>wN: waston strand, N is A/T/C/G</p><p>cN: crick strand, N is A/T/C/G</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">1、AA</span><br><span class="line">if(wA&gt;0 and ref==&apos;G&apos;)&#123;</span><br><span class="line">AA = wA*P + （cT+wT+wC+cC+wG+cG）*Q</span><br><span class="line">&#125;</span><br><span class="line">if((wA&gt;0 || cA&gt;0) &amp;&amp; ref!=G)&#123;</span><br><span class="line">AA = (wA + cA)*P + （cT+wT+wC+cC+wG+cG）*Q</span><br><span class="line">&#125;</span><br><span class="line">2、GG</span><br><span class="line">if（(wG&gt;0|| cG&gt;0 || cA&gt;0) &amp;&amp; ref=!A）&#123;</span><br><span class="line">GG =  (wG+cG+cA)*P + (wA+cT+wT+cC+wC)*Q;</span><br><span class="line">&#125;</span><br><span class="line">if(（wG&gt;0 || cG&gt;0）&amp;&amp; ref==A)&#123;</span><br><span class="line">GG = (wG+cG)*P + (wA+cT+wT+cC+wC)*Q;</span><br><span class="line">&#125;</span><br><span class="line">3、TT</span><br><span class="line">if(cT&gt;0 &amp;&amp; ref==C)&#123;</span><br><span class="line">TT= cT*P+ (wA+cC+wG+cG+wC+cA)*Q;</span><br><span class="line">&#125;</span><br><span class="line">if((wT&gt;0 || cT&gt;0)&amp;&amp; ref!=C)&#123;</span><br><span class="line">TT=  (wT+cT）*P+ (wA+cC+wG+cG+wC+cA)*Q;</span><br><span class="line">&#125;</span><br><span class="line">4、CC</span><br><span class="line">if((cC&gt;0 || wC&gt;0) &amp;&amp; ref==T)&#123;</span><br><span class="line">CC = (cC+wC)*P + (wA+cA+cT+wG+cG)*Q;</span><br><span class="line">&#125;</span><br><span class="line">if((cC&gt;0 || wC&gt;0 || wT&gt;0) &amp;&amp; ref !=T)&#123;</span><br><span class="line">CC = (cC+wC+wT)*P + (wA+cA+cT+wG+cG)*Q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">5、AC</span><br><span class="line">if(（wA&gt;0|| cA&gt;0）&amp;&amp;ref！=“G”)&#123;</span><br><span class="line">    if((cC&gt;0 || wC&gt;0) &amp;&amp; ref==T)&#123;</span><br><span class="line">AC=(cC+wC+wA+cA)*P+(cT+wG+cG)*Q</span><br><span class="line">    &#125;</span><br><span class="line">    if((cC&gt;0 || wC&gt;0 || wT&gt;0) &amp;&amp; ref !=T)&#123;</span><br><span class="line">AC=(cC+wC+wT+wA+cA)*P+(cT+wG+cG)*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(wA&gt;0&amp;&amp;ref==“G”)&#123;</span><br><span class="line">    if((cC&gt;0 || wC&gt;0 || wT&gt;0))&#123;</span><br><span class="line">AC=(cC+wC+wT+wA)*P+(cT+wG+cG)*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">6、AG</span><br><span class="line">if( (wA&gt;0|| cA&gt;0) &amp;&amp; ref != G)&#123;</span><br><span class="line">    if（cG&gt;0 || wG&gt;0）&#123;</span><br><span class="line">    AG = (wA +cA+ wG + cG)*P + （cC+cT+wC+ wT）*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(wA&gt;0 &amp;&amp; ref == G)&#123;</span><br><span class="line">    if（cG&gt;0 || wG&gt;0）&#123;</span><br><span class="line">AG = (wA + wG + cG)*P + （cC+cT+wC+ wT）*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">7、AT</span><br><span class="line">if((wA&gt;0 || cA&gt;0)&amp;&amp;ref !=G)&#123;</span><br><span class="line">    if((wT &gt;0 || cT&gt;0)&amp;&amp; ref=!=C)&#123;</span><br><span class="line">AT = (wA+cA+wT+cT)*P + （cC+wG+wC+cG）*Q</span><br><span class="line">    &#125;</span><br><span class="line">    if(cT&gt;0 &amp;&amp; ref!==C)&#123;</span><br><span class="line">AT = (wA+cA+cT)*P + （cC+wG+wC+cG）*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(wA&gt;0 &amp;&amp; ref ==G)&#123;</span><br><span class="line">    if(wT&gt;0 || cT&gt;0)&#123;</span><br><span class="line">    AT = (wA+wT+cT)*P + （cC+wG+wC+cG）*Q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">8、TC</span><br><span class="line">if(cT&gt;0 &amp;&amp; ref==“C”)&#123;</span><br><span class="line">    if(wC&gt;0 || cC&gt;0)&#123;</span><br><span class="line">TC=(wC+cT+cC)*P + (wA+wG+cG+cA)*Q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(（cT&gt;0||wT&gt;0）&amp;&amp;ref!=“C”)&#123;</span><br><span class="line">    if(wC&gt;0 || cC&gt;0)&#123;</span><br><span class="line">    TC=  (wC+wT+cT+cC)*P + (wA+wG+cG+cA)*Q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">9、TG</span><br><span class="line">if((cT&gt;0||wT&gt;0)&amp;&amp;ref !=C )&#123;</span><br><span class="line">    if(（wG&gt;0 || cG&gt;0|| cA&gt;0）&amp;&amp; ref !=A)&#123;</span><br><span class="line">     TG= (cT+wT+wG+cG+cA) * P + (wA+cC+wC)*Q;         </span><br><span class="line">    &#125;</span><br><span class="line">    if(（wG&gt;0 || cG&gt;0）&amp;&amp; ref ==A)&#123;</span><br><span class="line">    TG= (cT+wT+wG+cG) * P + (wA+cC+wC)*Q;         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(cT&gt;0 &amp;&amp; ref==“C”)&#123;</span><br><span class="line">    if(wG&gt;0 || cG&gt;0||cA&gt;0)&#123;</span><br><span class="line">    TG=(cT+wG+cG+cA) * P + (wA+cC+wC)*Q;         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">10、CG</span><br><span class="line">if((cC&gt;0 || wC&gt;0) &amp;&amp; ref==T )&#123;</span><br><span class="line">CG= (cC+wG+wC+cG+cA)*P + (wA+cT)*Q;</span><br><span class="line">&#125;</span><br><span class="line">if((cC&gt;0 || wC&gt;0 || wT&gt;0) &amp;&amp; ref !=T)&#123;</span><br><span class="line">    if((wG&gt;0 || cG&gt;0||wT&gt;0) &amp;&amp; ref==A)&#123;</span><br><span class="line">    CG= (cC+wG+wC+cG+wT)*P + (wA+cT)*Q;</span><br><span class="line">    &#125;</span><br><span class="line">    if((wG&gt;0 || cG&gt;0||cA&gt;0) &amp;&amp; ref !=A)&#123;</span><br><span class="line">    CG= (cC+wG+wC+cG+ wT+cA)*P + (wA+cT)*Q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Filename:</strong> SNP.out</p><p><strong>SNP:</strong> 331110</p><table><thead><tr><th style="text-align:left">Tools</th><th style="text-align:center">number of SNPs</th><th style="text-align:center">overlap with WGS</th></tr></thead><tbody><tr><td style="text-align:left">BS-SNPer</td><td style="text-align:center">185617</td><td style="text-align:center"><strong>118307</strong> (63.7%)</td></tr><tr><td style="text-align:left">newBSNPSv0.1</td><td style="text-align:center"><strong>331110</strong></td><td style="text-align:center">139565 (42.1%)</td></tr><tr><td style="text-align:left">BiS-SNP</td><td style="text-align:center">134547</td><td style="text-align:center">116521 <strong>(86.6%)</strong></td></tr><tr><td style="text-align:left">WGS</td><td style="text-align:center">285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/bssnpsv0.1.png" width="300" height="256" div="" align="center"></p><h3 id="new-bsnps-v0-2"><a href="#new-bsnps-v0-2" class="headerlink" title="new-bsnps-v0.2"></a>new-bsnps-v0.2</h3><p>Modify: allowed max error rate 0.02 in per read.</p><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>185617</td><td>118307 (63.7%)</td></tr><tr><td>BSNPSv0.2</td><td><strong>254706</strong></td><td><strong>134720</strong> (52.9%)</td></tr><tr><td>BiS-SNP</td><td>134547</td><td>116521 <strong>(86.6%)</strong></td></tr><tr><td>WGS</td><td>285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/bssnpsv0.2.png" width="300" height="256" div="" align="center"></p><h3 id="new-bsnps-v0-3"><a href="#new-bsnps-v0-3" class="headerlink" title="new-bsnps-v0.3"></a>new-bsnps-v0.3</h3><p><strong>Modify:</strong> add pvalue by fisher’s exact test</p><blockquote><p>float  fishers_exact(int expValue1, int expValue2, int obsValue1, int obsValue2)</p><p>Calculates significance of variants</p><p>Parameters:</p><p>expValue1 - Total reads depth * Q</p><p>expValue2 - Total reads depth</p><p>1th of variant (observed)</p><p>obsValue2 - Total reads depth (observed)</p><p>Returns:</p><p>double, P-value from Fisher’s Exact Test</p><p>Q: probability of sequence error,  $0.1^{(AverQual/10)}/3​$ </p></blockquote><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>185617</td><td>118307 (63.7%)</td></tr><tr><td>BSNPSv0.3</td><td>130148</td><td><strong>120189 (92.3%)</strong></td></tr><tr><td>BiS-SNP</td><td><strong>134547</strong></td><td>116521 (86.6%)</td></tr><tr><td>WGS</td><td>285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/bssnpsv0.3.png" width="300" height="256" div="" align="center"></p><h3 id="new-bsnps-v0-4"><a href="#new-bsnps-v0-4" class="headerlink" title="new-bsnps-v0.4"></a>new-bsnps-v0.4</h3><p>Modify: fix some bugs in genotype function</p><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>185617</td><td>118307 (63.7%)</td></tr><tr><td>BSNPSv0.4</td><td><strong>139347</strong></td><td><strong>126704 (90.9%)</strong></td></tr><tr><td>BiS-SNP</td><td>134547</td><td>116521 (86.6%)</td></tr><tr><td>WGS</td><td>285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/bssnpsv0.4.png" width="300" height="256" div="" align="center"></p><h3 id="new-bsnps-v0-5"><a href="#new-bsnps-v0-5" class="headerlink" title="new-bsnps-v0.5"></a>new-bsnps-v0.5</h3><p><strong>Modify:</strong>  1, If variant position filter quality is Low, we also can set <code>AD&gt;minvarread, ALFR&gt;minvarrate, pvalue &lt; pvalue_cutoff + 0.01</code> as PASS.</p><p>AD, Total allelic depths</p><p>ALFR, Allele frequency</p><p>default, set minvarread = 5, minvarrate = 0.3.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[12:39:37] qwzhou@login:~/software/BSsnpscan : </span><br><span class="line">$ awk <span class="string">'$1=="chr1" &amp;&amp; $7=="Low"'</span> ~/practice/HUES64/<span class="built_in">test</span>/chr1.mpall.vcf  | awk <span class="string">'split($8,a,";") &amp;&amp; split($10,b,":") &amp;&amp; gsub(/AD=/,"",a[5]) &amp;&amp; a[5]&gt;5 &amp;&amp; b[5]&gt;0.3 &amp;&amp; b[2]&lt;0.06&#123;print $1" "$2&#125;'</span> |wc -l</span><br><span class="line">9882</span><br><span class="line"></span><br><span class="line">[12:39:06] qwzhou@login:~/software/BSsnpscan : </span><br><span class="line">$ awk <span class="string">'$1=="chr1" &amp;&amp; $7=="Low"'</span> ~/practice/HUES64/<span class="built_in">test</span>/chr1.mpall.vcf  | awk <span class="string">'split($8,a,";") &amp;&amp; split($10,b,":") &amp;&amp; gsub(/AD=/,"",a[5]) &amp;&amp; a[5]&gt;5 &amp;&amp; b[5]&gt;0.3 &amp;&amp; b[2]&lt;0.06 &#123;print $1"\t"$2&#125;'</span> | awk <span class="string">'ARGIND==1 &#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> - ~/practice/HUES64/<span class="built_in">test</span>/wgs.snp.all.default.vcf |wc -l</span><br><span class="line">9212</span><br></pre></td></tr></table></figure><p>if <code>AD&gt;minvarread, ALFR&gt;minvarrate, pvalue &lt; pvalue_cutoff + 0.01</code> is true:</p><p>​    9882</p><p>validated by WGS: </p><p>​    9212 (93.2%)</p><p><strong>Modify:  </strong> 2, add multi-thread</p><p><strong>Modify:  </strong> 3, t test</p><p>Results:</p><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>185617</td><td>118307 (63.7%)</td></tr><tr><td>BSNPSv0.5</td><td>152387</td><td>138908 (91.2%)</td></tr><tr><td>BSNPS (with bis-snp realign and recall bam)</td><td>153972</td><td>141836 (92.1%)</td></tr><tr><td>BiS-SNP</td><td>134547</td><td>116521 (86.6%)</td></tr><tr><td>Bis-SNP (realign + recall)</td><td>145649</td><td>136946 (94.0%)</td></tr><tr><td>WGS</td><td>285348</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/huesbsnpsv0.5.png" width="300" height="256" div="" align="center"></p><h3 id="Used-time"><a href="#Used-time" class="headerlink" title="Used time"></a>Used time</h3><table><thead><tr><th>Tools</th><th>Thread x1 (hours)</th><th>Thread x4 (hours)</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>5.1</td><td>N</td></tr><tr><td>BSNPSv0.5</td><td><strong>2.3</strong></td><td><strong>0.56</strong></td></tr><tr><td>BiS-SNP</td><td>152.1</td><td>64.2</td></tr><tr><td>BiS-SNP (realign + recall)</td><td></td><td>160.2 h</td></tr></tbody></table><hr><h2 id="Results-2-Sample-GM12878"><a href="#Results-2-Sample-GM12878" class="headerlink" title="Results 2 [Sample: GM12878]"></a>Results 2 [Sample: GM12878]</h2><p><strong>WGS SNP</strong> from 1000 project (Ilmn150bp300x) （GATK）</p><h3 id="v0-3"><a href="#v0-3" class="headerlink" title="v0.3"></a>v0.3</h3><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td><strong>339259</strong></td><td><strong>221805</strong> (65.4%)</td></tr><tr><td>BSNPSv0.3</td><td>237500</td><td>217722 <strong>(91.7%)</strong></td></tr><tr><td>BiS-SNP</td><td>244473</td><td>205843 (84.2%)</td></tr><tr><td>WGS</td><td>336372</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/GM12878bsnpsv0.3.png" width="300" height="256" div="" align="center"></p><h3 id="v0-4"><a href="#v0-4" class="headerlink" title="v0.4"></a>v0.4</h3><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td><strong>339259</strong></td><td><strong>221805</strong> (65.4%)</td></tr><tr><td>BSNPSv0.3</td><td>241408</td><td>220526 <strong>(91.3%)</strong></td></tr><tr><td>BiS-SNP</td><td>244473</td><td>205843 (84.2%)</td></tr><tr><td>WGS</td><td>336372</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/GM12878bsnpsv0.4.png" width="300" height="256" div="" align="center"></p><h3 id="v0-5"><a href="#v0-5" class="headerlink" title="v0.5"></a>v0.5</h3><table><thead><tr><th>Tools</th><th>number of SNPs</th><th>overlap with WGS</th></tr></thead><tbody><tr><td>BS-SNPer</td><td><strong>339259</strong></td><td>221805 (65.4%)</td></tr><tr><td>BSNPSv0.5</td><td>249575</td><td><strong>227862 (91.3%)</strong></td></tr><tr><td>BiS-SNP</td><td>244473</td><td>205843 (84.2%)</td></tr><tr><td>WGS</td><td>336372</td></tr></tbody></table><p><img src="/2018/12/24/BSNPS/GM12878bsnpsv.5.png" width="300" height="256" div="" align="center"></p><h3 id="Used-time-1"><a href="#Used-time-1" class="headerlink" title="Used time"></a>Used time</h3><p>### </p><table><thead><tr><th>Tools</th><th>Thread x1 (hours)</th><th>Thread x4 (hours)</th></tr></thead><tbody><tr><td>BS-SNPer</td><td>7.2</td><td>N</td></tr><tr><td>BSNPSv0.5</td><td><strong>2.8</strong></td><td><strong>0.95</strong></td></tr><tr><td>BiS-SNP</td><td>not finished (only finished chr1)</td><td>not finished</td></tr></tbody></table><h2 id="Others-scripts-used-to-count-overlap"><a href="#Others-scripts-used-to-count-overlap" class="headerlink" title="Others: scripts used to count overlap"></a>Others: scripts used to count overlap</h2><h3 id="HUES64"><a href="#HUES64" class="headerlink" title="HUES64"></a>HUES64</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[14:40:39] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"'</span> wgs.snp.all.default.vcf |wc -l</span><br><span class="line">285348</span><br><span class="line">[12:09:25] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"'</span> SNP.out |wc -l</span><br><span class="line">331110</span><br><span class="line">[15:06:45] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> wgbs.replace.sort.snp.filtered.sort.vcf &gt; bisnp.chr1.txt</span><br><span class="line">[15:08:37] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ less Csnp.txt </span><br><span class="line">[15:13:56] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ less Cchr1.new.txt </span><br><span class="line">[15:15:24] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05 '</span> Cchr1.new.txt |wc -l</span><br><span class="line">130148</span><br><span class="line">[15:15:47] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ less SNP.log </span><br><span class="line">[15:17:17] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" '</span> Cchr1.new.txt |wc -l</span><br><span class="line">254706</span><br><span class="line">[15:18:05] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" '</span> Cchr1.txt |wc -l</span><br><span class="line">346875</span><br><span class="line">[15:18:18] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> Cchr1.new.txt &gt; newBsnpsV0.2.txt</span><br><span class="line">[15:20:35] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05 &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> Cchr1.new.txt &gt; newBsnpsV0.3.txt</span><br><span class="line">[15:20:54] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05 &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> chr1.new2chr1.txt &gt; newBsnpsV0.4.txt</span><br><span class="line">[15:22:40] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> Cchr1.new.txt wgs.snp.all.default.vcf |wc -l</span><br><span class="line">134720</span><br><span class="line"></span><br><span class="line">[14:45:13] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"'</span> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out |wc -l</span><br><span class="line">185617</span><br><span class="line">[14:48:04] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1" &#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out wgs.snp.all.default.vcf |wc -l </span><br><span class="line">118307</span><br><span class="line">[14:51:02] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1" &#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out wgbs.replace.sort.snp.filtered.sort.vcf  |wc -l</span><br><span class="line">92860</span><br><span class="line">[14:56:15] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ less wgbs.replace.sort.snp.filtered.sort.vcf </span><br><span class="line">[14:58:53] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out &gt; bissnp.chr1.txt</span><br><span class="line">^C</span><br><span class="line">[15:08:04] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> ~/../hhwang/HUES64_re/bssnper/HUES64.SNP.out &gt; bssnper.chr1.txt</span><br><span class="line">[15:08:42] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> wgs.snp.all.default.vcf &gt; wgs.chr1.txt</span><br><span class="line">[15:09:30] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> SNP.out &gt; newBsnpsV0.1.txt</span><br><span class="line">[15:13:36] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ wc -l newBsnpsV0.3.txt </span><br><span class="line">130148 newBsnpsV0.3.txt</span><br><span class="line">[15:21:49] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ wc -l newBsnpsV0.4.txt</span><br><span class="line">139347 newBsnpsV0.4.txt</span><br><span class="line">[15:24:17] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ wc -l newBsnpsV0.2.txt</span><br><span class="line">254706 newBsnpsV0.2.txt</span><br><span class="line">[14:06:06] qwzhou@comput54:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> chr1.spnew2.vcf &gt; newBsnpsV0.5.txt</span><br><span class="line"></span><br><span class="line">[21:59:16] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> wgbs.replace.sort.snp.filtered.sort.vcf wgs.snp.all.default.vcf |wc -l</span><br><span class="line">116521</span><br><span class="line">[21:59:46] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05&#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> Cchr1.txt wgs.snp.all.default.vcf |wc -l</span><br><span class="line">128561</span><br><span class="line">[22:00:00] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05&#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> Cchr1.new.txt wgs.snp.all.default.vcf |wc -l</span><br><span class="line">120189</span><br><span class="line">[22:01:23] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05&#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;print a[$1" "$2]&#125;&#125;'</span> Cchr1.new.txt ../WGS/wgs.snp.vcf |wc -l</span><br><span class="line">117139</span><br><span class="line">[22:01:50] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05&#123;a[$1" "$2]=$0&#125;ARGIND==2 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in a)&#123;b[$1" "$2]&#125;&#125;ARGIND==3 &amp;&amp; $1=="chr1" &amp;&amp; $7=="PASS"&#123;if($1" "$2 in b)&#123;print b[$1" "$2]&#125;&#125;'</span> Cchr1.new.txt ../WGS/wgs.snp.vcf wgbs.replace.sort.snp.filtered.sort.vcf |wc -l</span><br><span class="line">90111</span><br><span class="line">[22:03:54] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $4=="PASS" &amp;&amp; $5&lt;0.05 '</span> Cchr1.txt |wc -l</span><br><span class="line">164344</span><br><span class="line">[12:08:15] qwzhou@login:~/practice/HUES64/<span class="built_in">test</span> : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"'</span> wgbs.replace.sort.snp.filtered.sort.vcf |wc -l</span><br><span class="line">134547</span><br></pre></td></tr></table></figure><h3 id="GM12878"><a href="#GM12878" class="headerlink" title="GM12878"></a>GM12878</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'$1=="chr1" &amp;&amp; length($4)==1 &amp;&amp; (length($5)==1 || ($5~/,/ &amp;&amp; length($5)==3))&#123;print $1"_"$2&#125;'</span> ../../HG001_GRCh38_CHROM1-X_novoalign_Ilmn150bp300x_GATKHC.vcf &gt; wgs.chr1.txt</span><br><span class="line"></span><br><span class="line">[16:05:48] qwzhou@login:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'$7=="PASS"'</span> bissnp.chr1.snp.filtered.sort.vcf &gt; bissnp.chr1.txt</span><br><span class="line"></span><br><span class="line">[16:08:17] qwzhou@login:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1" &#123;print $1"_"$2&#125;'</span> bssnper.default.onlySNP.out &gt; bssnper.chr1.txt</span><br><span class="line">[16:08:42] qwzhou@login:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'$7=="PASS"&#123;print $1"_"$2&#125;'</span> bissnp.chr1.snp.filtered.sort.vcf &gt; bissnp.chr1.txt</span><br><span class="line"></span><br><span class="line">[06:16:50] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara :</span><br><span class="line">$ awk <span class="string">'$4=="PASS" &amp;&amp; $5&lt;0.05 &amp;&amp; $1=="chr1" &#123;print $1"_"$2&#125;'</span> Cnewsnp.log &gt; newbsnps.v0.3.txt</span><br><span class="line"></span><br><span class="line">[16:14:27] qwzhou@login:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'$4=="PASS" &amp;&amp; $5&lt;0.05 &amp;&amp; $1=="chr1"&#123;print $1"_"$2&#125;'</span> Cnew2snp.log &gt; newbsnp.v0.4.txt</span><br><span class="line">[17:39:36] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'$7=="PASS" &amp;&amp; $1=="chr1"'</span> Cmpnewsnp.txt |wc -l</span><br><span class="line">249575</span><br><span class="line">[17:40:47] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ less run.compare.sh </span><br><span class="line">[17:45:23] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ awk <span class="string">'ARGIND==1 &amp;&amp; $7=="PASS" &amp;&amp; $1=="chr1"&#123;a[$1" "$2]&#125;ARGIND==2 &amp;&amp; length($4)==1 &amp;&amp; (length($5)==1 || ($5~/,/ &amp;&amp; length($5)==3))&#123;if($1" "$2 in a)&#123;print $0&#125;&#125;'</span> Cmpnewsnp.txt ../../HG001_GRCh38_CHROM1-X_novoalign_Ilmn150bp300x_GATKHC.vcf |wc -l</span><br><span class="line">227862</span><br><span class="line">[17:46:22] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$ vi run.compare.sh </span><br><span class="line">[21:44:50] qwzhou@comput54:~/practice/GM12878/BS-Seq/SNPdefaultpara : </span><br><span class="line">$  awk <span class="string">'$7=="PASS" &amp;&amp; $1=="chr1" &#123;print $1"_"$2&#125;'</span> Cmpnewsnp.txt &gt; newbsnps.v0.5.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      newSNP results
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/worklog/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/tags/worklog/"/>
    
      <category term="newSNP" scheme="https://zhouqiangwei.github.io/tags/newSNP/"/>
    
  </entry>
  
  <entry>
    <title>day20181224</title>
    <link href="https://zhouqiangwei.github.io/2018/12/24/day20181224/"/>
    <id>https://zhouqiangwei.github.io/2018/12/24/day20181224/</id>
    <published>2018-12-24T02:14:14.000Z</published>
    <updated>2019-01-06T07:34:11.909Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="F123-WGBS"><a href="#F123-WGBS" class="headerlink" title="F123 WGBS"></a>F123 WGBS</h2><h3 id="alignment-results"><a href="#alignment-results" class="headerlink" title="alignment results"></a>alignment results</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Time Taken  - 185316 Seconds ..</span><br><span class="line"> [20:48:48] qwzhou@node62:~/practice/mus_hic_mth/wgbs :</span><br><span class="line">$ ~/software_devp/batmeth2/bin/penguin -g ~/practice/Genome/mouse/mm10/batmeth2/mouse_reference.fa -i read1.paired.fq.gz -i read2.paired.fq.gz -o F123.bt2bs.sam -p 8</span><br></pre></td></tr></table></figure><h3 id="sam2bam"><a href="#sam2bam" class="headerlink" title="sam2bam"></a>sam2bam</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10:18:17] qwzhou@node62:~/practice/mus_hic_mth/wgbs : </span><br><span class="line">$ samtools sort -m 1G -@ 6 -o F123.align.sort.bam F123.bt2bs.sam</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      worklog in day20181224
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/worklog/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/tags/worklog/"/>
    
  </entry>
  
  <entry>
    <title>day20181223</title>
    <link href="https://zhouqiangwei.github.io/2018/12/23/day20181223/"/>
    <id>https://zhouqiangwei.github.io/2018/12/23/day20181223/</id>
    <published>2018-12-23T06:35:48.000Z</published>
    <updated>2019-01-06T07:34:11.909Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="A549-HiC数据尤其是数目统计matrix目录下为准"><a href="#A549-HiC数据尤其是数目统计matrix目录下为准" class="headerlink" title="A549 HiC数据尤其是数目统计matrix目录下为准"></a>A549 HiC数据尤其是数目统计matrix目录下为准</h3><p>data下是SNPsplit结果，直接统计不能确认准确性。</p><h2 id="A549-Allele-RNAseq-with-ASM"><a href="#A549-Allele-RNAseq-with-ASM" class="headerlink" title="A549 Allele RNAseq with ASM"></a>A549 Allele RNAseq with ASM</h2><p>用SNPsplit将RNAseq bam文件按照SNP进行归类。</p><p>之后统计genome1 and genome2 gene表达情况，然后统计RNAseq，但是单倍型不完全是G1-G1-G1，所以直接统计不行。</p><p>思路：</p><ol><li>vcf overlap with gene</li><li>vcf from 1 overlap with G1 bam and G2 bam</li><li>count number of R2</li><li>R3 vcf overlap with ASM</li></ol><h3 id="vcf-overlap-with-gene"><a href="#vcf-overlap-with-gene" class="headerlink" title="vcf overlap with gene"></a>vcf overlap with gene</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[14:47:23] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ bedtools intersect -a ../HiC_normal/wgbs.encode.bissnp.reformat.vcf -b ~/practice/Genome/hg38/gene.id.bed -wo |less</span><br></pre></td></tr></table></figure><h3 id="vcf-from-1-overlap-with-G1-bam-and-G2-bam"><a href="#vcf-from-1-overlap-with-G1-bam-and-G2-bam" class="headerlink" title="vcf from 1 overlap with G1 bam and G2 bam"></a>vcf from 1 overlap with G1 bam and G2 bam</h3><h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[15:06:10] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ bedtools intersect -a ../HiC_normal/wgbs.encode.bissnp.reformat.vcf -b ~/practice/Genome/hg38/gene.id.bed -wo | awk <span class="string">'ARGIND==1 &amp;&amp; $1~/^#/&#123;print $0&#125;ARGIND==2&#123;print $0&#125;'</span> ../HiC_normal/wgbs.encode.bissnp.reformat.vcf - |bedtools intersect -a - -b A549.hg38-N.sort.genome1.bam -wo | awk <span class="string">'&#123;a[$1"\t"$2"\t"$2"\t"$16]++&#125;END&#123;for(i in a)&#123;print i"\t"a[i]&#125;&#125;'</span> &gt; snpwtithgenewithG1.bed</span><br></pre></td></tr></table></figure><h4 id="G2"><a href="#G2" class="headerlink" title="G2"></a>G2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[15:06:10] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ bedtools intersect -a ../HiC_normal/wgbs.encode.bissnp.reformat.vcf -b ~/practice/Genome/hg38/gene.id.bed -wo | awk <span class="string">'ARGIND==1 &amp;&amp; $1~/^#/&#123;print $0&#125;ARGIND==2&#123;print $0&#125;'</span> ../HiC_normal/wgbs.encode.bissnp.reformat.vcf - |bedtools intersect -a - -b A549.hg38-N.sort.genome2.bam -wo | awk <span class="string">'&#123;a[$1"\t"$2"\t"$2"\t"$16]++&#125;END&#123;for(i in a)&#123;print i"\t"a[i]&#125;&#125;'</span> &gt; snpwtithgenewithG2.bed</span><br></pre></td></tr></table></figure><h3 id="count-number-of-R2"><a href="#count-number-of-R2" class="headerlink" title="count number of R2"></a>count number of R2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[15:10:15] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed |less</span><br></pre></td></tr></table></figure><h3 id="R3-vcf-overlap-with-ASM"><a href="#R3-vcf-overlap-with-ASM" class="headerlink" title="R3 vcf overlap with ASM"></a>R3 vcf overlap with ASM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[15:36:47] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $6/($5+1)&gt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $12&#125;if($14&gt;$13)&#123;print $11&#125;&#125;'</span> | awk <span class="string">'$1~/U/ &amp;&amp; $1!~/M/'</span> |wc -l</span><br><span class="line">116</span><br><span class="line">[15:37:06] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $6/($5+1)&gt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $12&#125;if($14&gt;$13)&#123;print $11&#125;&#125;'</span> | awk <span class="string">'$1~/M/ &amp;&amp; $1!~/U/'</span> |wc -l</span><br><span class="line">166</span><br><span class="line"></span><br><span class="line">[15:13:22] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $5/($6+1)&gt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $11&#125;if($14&gt;$13)&#123;print $12&#125;&#125;'</span> | awk <span class="string">'$1~/M/ &amp;&amp; $1!~/U/'</span> |wc -l</span><br><span class="line">245</span><br><span class="line">[15:38:59] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $5/($6+1)&gt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $11&#125;if($14&gt;$13)&#123;print $12&#125;&#125;'</span> | awk <span class="string">'$1~/U/ &amp;&amp; $1!~/M/'</span> |wc -l</span><br><span class="line">96</span><br></pre></td></tr></table></figure><h4 id="Not-ASEG"><a href="#Not-ASEG" class="headerlink" title="Not ASEG"></a>Not ASEG</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[15:40:00] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $5/($6+1)&lt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $11&#125;if($14&gt;$13)&#123;print $12&#125;&#125;'</span> | awk <span class="string">'$1~/U/ &amp;&amp; $1!~/M/'</span> |wc -l</span><br><span class="line">397</span><br><span class="line">[15:44:00] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $5/($6+1)&lt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $11&#125;if($14&gt;$13)&#123;print $12&#125;&#125;'</span> | awk <span class="string">'$1~/M/ &amp;&amp; $1!~/U/'</span> |wc -l</span><br><span class="line">381</span><br><span class="line">[15:44:13] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $6/($5+1)&lt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $12&#125;if($14&gt;$13)&#123;print $11&#125;&#125;'</span> | awk <span class="string">'$1~/U/ &amp;&amp; $1!~/M/'</span> |wc -l</span><br><span class="line">514</span><br><span class="line">[16:03:51] qwzhou@comput54:~/practice/A549_BS/RNAseqEncode : </span><br><span class="line">$ awk <span class="string">'ARGIND==1&#123;a[$1"\t"$2"\t"$3"\t"$4]=$5&#125;ARGIND==2&#123;if($1"\t"$2"\t"$3"\t"$4 in a)&#123;b[$1"\t"$2"\t"$3"\t"$4]=a[$1"\t"$2"\t"$3"\t"$4]"\t"$5;delete a[$1"\t"$2"\t"$3"\t"$4]&#125;else&#123;b[$1"\t"$2"\t"$3"\t"$4]="0\t"$5&#125;&#125;END&#123;for(i in a)&#123;b[i]=a[i]"\t0"&#125;;for(i in b)&#123;print i"\t"b[i]&#125;&#125;'</span> snpwtithgenewithG1.bed snpwtithgenewithG2.bed | bedtools intersect -a - -b ../WGBS-HAIR/A549.hapcut.withsnv.bed -wo | awk <span class="string">'$5+$6&gt;20 &amp;&amp; $6/($5+1)&lt;2 &amp;&amp; length($11)-$13-$14&gt;2&#123;if($13&gt;$14)&#123;print $12&#125;if($14&gt;$13)&#123;print $11&#125;&#125;'</span> | awk <span class="string">'$1~/M/ &amp;&amp; $1!~/U/'</span> |wc -l</span><br><span class="line">325</span><br></pre></td></tr></table></figure><h2 id="HiC-ASM-CTCF"><a href="#HiC-ASM-CTCF" class="headerlink" title="HiC ASM CTCF"></a>HiC ASM CTCF</h2><h3 id="data-下的-SNPsplit的结果，觉得不是很好，可以用matrix下的结果再看一遍"><a href="#data-下的-SNPsplit的结果，觉得不是很好，可以用matrix下的结果再看一遍" class="headerlink" title="data 下的 SNPsplit的结果，觉得不是很好，可以用matrix下的结果再看一遍"></a>data 下的 SNPsplit的结果，觉得不是很好，可以用matrix下的结果再看一遍</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[15:10:59] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">9</span><br><span class="line">[15:11:14] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">10</span><br><span class="line">[15:11:24] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">1</span><br><span class="line">[15:13:27] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">2</span><br><span class="line">[15:13:37] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G2high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">4</span><br><span class="line">[15:14:40] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G2high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">5</span><br><span class="line">[15:14:47] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G2high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">0</span><br><span class="line">[15:15:26] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/data/SRR5129660 : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660_G1vsG2.2000.bed | bedtools intersect -a - -b ../../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G2high.Peaks -wo | bedtools intersect -a - -b A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="matrix下的hicpro结果，还是一样"><a href="#matrix下的hicpro结果，还是一样" class="headerlink" title="matrix下的hicpro结果，还是一样"></a>matrix下的hicpro结果，还是一样</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[16:26:16] qwzhou@login:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/matrix : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660/raw/2000/SRR5129660_G1vsG2.ir.bed | bedtools intersect -a - -b ../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b ../data/SRR5129660/A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">7</span><br><span class="line">[16:26:33] qwzhou@login:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/matrix : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($4/($5+1)&gt;=2 ) '</span> SRR5129660/raw/2000/SRR5129660_G1vsG2.ir.bed | bedtools intersect -a - -b ../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b ../data/SRR5129660/A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">7</span><br><span class="line">[16:26:53] qwzhou@login:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/matrix : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660/raw/2000/SRR5129660_G1vsG2.ir.bed | bedtools intersect -a - -b ../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b ../data/SRR5129660/A549.hapcut.G1U.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">1</span><br><span class="line">[16:27:10] qwzhou@login:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/hic_results_allele_withencodesnp/matrix : </span><br><span class="line">$ awk <span class="string">'$4+$5&gt;=10 &amp;&amp; ($5/($4+1)&gt;=2 ) '</span> SRR5129660/raw/2000/SRR5129660_G1vsG2.ir.bed | bedtools intersect -a - -b ../matrix/SRR5129660/raw/2000/CTCF_UT-A.Allele.G1high.Peaks -wo | bedtools intersect -a - -b ../data/SRR5129660/A549.hapcut.G1M.bed -wo | awk <span class="string">'&#123;b[$1"\t"$2"\t"$3]&#125;END&#123;print length(b)&#125;'</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      worklog in 20181223 (sunday)
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/worklog/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="ASMG with ASM" scheme="https://zhouqiangwei.github.io/tags/ASMG-with-ASM/"/>
    
  </entry>
  
  <entry>
    <title>mm9tomm10vcf</title>
    <link href="https://zhouqiangwei.github.io/2018/12/21/mm9tomm10vcf/"/>
    <id>https://zhouqiangwei.github.io/2018/12/21/mm9tomm10vcf/</id>
    <published>2018-12-21T08:51:49.000Z</published>
    <updated>2019-01-06T07:34:11.913Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## mm9 vcf 转为 mm10 vcf</span></span><br><span class="line">​```bash</span><br><span class="line">[15:51:49] qwzhou@node62:~/practice/Genome/mouse/mm10 : </span><br><span class="line">$ java -jar ~/software/picard-tools-1.119/CreateSequenceDictionary.jar REFERENCE=mouse_reference.fa OUTPUT=mouse_reference.dict</span><br><span class="line"></span><br><span class="line">java -jar picard.jar LiftoverVcf I=input.vcf O=lifted_over.vcf CHAIN=b37tohg38.chain REJECT=rejected_variants.vcf R=reference_sequence.fasta</span><br><span class="line">​</span><br></pre></td></tr></table></figure><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p><code>Caused by: htsjdk.tribble.TribbleException$InvalidHeader: Your input file has a malformed header: We never saw the required CHROM header line (starting with one #) for the input VCF file</code></p><h3 id="write-header"><a href="#write-header" class="headerlink" title="write header"></a>write header</h3><p>​<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[16:00:21] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ cat vcfheader.txt GSE48592_castx129_variants.vcf.mm9.txt &gt;GSE48592_castx129_variants.mm9.vcf</span><br><span class="line">​</span><br></pre></td></tr></table></figure></p><h2 id="CHAIN-practice-Genome-mouse-mm9ToMm10-over-chain-download-from-UCSC"><a href="#CHAIN-practice-Genome-mouse-mm9ToMm10-over-chain-download-from-UCSC" class="headerlink" title="CHAIN=~/practice/Genome/mouse/mm9ToMm10.over.chain download from UCSC"></a>CHAIN=~/practice/Genome/mouse/mm9ToMm10.over.chain download from UCSC</h2><h3 id="rerun-vcflift"><a href="#rerun-vcflift" class="headerlink" title="rerun vcflift"></a>rerun vcflift</h3><p>​<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[16:01:01] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ java -jar ~/software/picard.jar LiftoverVcf I=GSE48592_castx129_variants.mm9.vcf O=GSE48592_castx129_variants.mm10.vcf CHAIN=~/practice/Genome/mouse/mm9ToMm10.over.chain REJECT=rejected_variants.vcf R=~/practice/Genome/mouse/mm10/mouse_reference.fa</span><br><span class="line">​</span><br></pre></td></tr></table></figure></p><h3 id="仍旧报错，尝试去掉第八列，并筛选snp"><a href="#仍旧报错，尝试去掉第八列，并筛选snp" class="headerlink" title="仍旧报错，尝试去掉第八列，并筛选snp"></a>仍旧报错，尝试去掉第八列，并筛选snp</h3><p>​<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[16:24:03] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ awk -v OFS=<span class="string">"\t"</span> <span class="string">'&#123;if($1~/^#/)&#123;print $0&#125;else&#123;if($8~/SNP/)&#123;print $1,$2,$3,$4,$5,$6,$7,".",$9,$10&#125;&#125;&#125;'</span> GSE48592_castx129_variants.mm9.vcf &gt; GSE48592_castx129_variants.mm9.snp.vcf</span><br><span class="line">​</span><br></pre></td></tr></table></figure></p><h3 id="可以正常运行"><a href="#可以正常运行" class="headerlink" title="可以正常运行"></a>可以正常运行</h3><p>​<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[16:25:18] qwzhou@node62:~/practice/mus_hic_mth/methyHic : </span><br><span class="line">$ java -jar ~/software/picard.jar LiftoverVcf I=GSE48592_castx129_variants.mm9.snp.vcf O=GSE48592_castx129_variants.mm10.vcf CHAIN=~/practice/Genome/mouse/mm9ToMm10.over.chain REJECT=rejected_variants.vcf R=~/practice/Genome/mouse/mm10/mouse_reference.fa</span><br><span class="line">​</span><br></pre></td></tr></table></figure></p><p><code>`</code></p>]]></content>
    
    <summary type="html">
    
      vcf loci transfer from old genome to latest genome
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="SNP" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/SNP/"/>
    
    
      <category term="bioinformactis" scheme="https://zhouqiangwei.github.io/tags/bioinformactis/"/>
    
      <category term="vcf from mm9 to mm10" scheme="https://zhouqiangwei.github.io/tags/vcf-from-mm9-to-mm10/"/>
    
  </entry>
  
  <entry>
    <title>20181219</title>
    <link href="https://zhouqiangwei.github.io/2018/12/19/20181219/"/>
    <id>https://zhouqiangwei.github.io/2018/12/19/20181219/</id>
    <published>2018-12-19T06:18:17.000Z</published>
    <updated>2019-01-06T07:34:11.871Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="F123-HiC-Pro-报错"><a href="#F123-HiC-Pro-报错" class="headerlink" title="F123 HiC-Pro 报错"></a>F123 HiC-Pro 报错</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Tue Dec 18 23:28:59 CST 2018</span><br><span class="line">Assign alignments to restriction fragments ...</span><br><span class="line">Logs: logs/sep1/mapped_2hic_fragments.log</span><br><span class="line">Logs: logs/sep2/mapped_2hic_fragments.log</span><br><span class="line">make: *** [mapped_2hic_fragments] Error 1</span><br><span class="line">[00:13:53] qwzhou@node62:~/practice/mus_hic_mth/F123HiC :</span><br></pre></td></tr></table></figure><h2 id="F123-运行mergebam"><a href="#F123-运行mergebam" class="headerlink" title="F123 运行mergebam"></a>F123 运行mergebam</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[14:19:43] qwzhou@node62:~/practice/mus_hic_mth/F123HiC :</span><br><span class="line">$ samtools merge -@ 6 F123.allmerge.bam hicsnp_latest_allele/bowtie_results/bwt2/sep*/*_mm10.masked.fa.bwt2pairs.bam</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      worklog in 20181219
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/worklog/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/tags/worklog/"/>
    
  </entry>
  
  <entry>
    <title>20181218</title>
    <link href="https://zhouqiangwei.github.io/2018/12/18/20181218/"/>
    <id>https://zhouqiangwei.github.io/2018/12/18/20181218/</id>
    <published>2018-12-18T06:31:29.000Z</published>
    <updated>2019-01-06T07:34:11.870Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="A549-hapcut2"><a href="#A549-hapcut2" class="headerlink" title="A549 hapcut2"></a>A549 hapcut2</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10:53:25] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/bowtie_results/bwt2 :</span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam A549.allmerge.sort.bam --VCF ../../../wgbs.encode.bissnp.reformat.vcf --out A549.hic.fragment</span><br></pre></td></tr></table></figure><h3 id="但是所有染色体速度太慢了，只取chr1运行"><a href="#但是所有染色体速度太慢了，只取chr1运行" class="headerlink" title="但是所有染色体速度太慢了，只取chr1运行"></a>但是所有染色体速度太慢了，只取chr1运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[10:54:18] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/bowtie_results/bwt2 :</span><br><span class="line">$ samtools index A549.allmerge.sort.bam &amp;&amp; samtools view -bh A549.allmerge.sort.bam chr1 &gt; A549.all.chr1.bam</span><br><span class="line">[14:16:41] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/bowtie_results/bwt2 :</span><br><span class="line">$ awk <span class="string">'$1~/^#/ || $1=="chr1"'</span> ../../../wgbs.encode.bissnp.reformat.vcf &gt; wgbs.chr1.vcf</span><br><span class="line"></span><br><span class="line">[14:35:39] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/bowtie_results/bwt2 : </span><br><span class="line">$ ~/software/HapCUT2/build/extractHAIRS --hic 1 --bam A549.all.chr1.bam --VCF wgbs.chr1.vcf --out A549.hic.chr1.fragment</span><br><span class="line">[14:57:14] qwzhou@comput54:~/practice/A549_BS/HiC_normal/hicsnp_latest_allele_withencodesnp/bowtie_results/bwt2 :</span><br><span class="line">$ ~/software/HapCUT2/build/HAPCUT2 --hic 1 --fragments A549.hic.chr1.fragment --vcf wgbs.chr1.vcf --output A549.hic.chr1.haplotype</span><br></pre></td></tr></table></figure><h3 id="由于hic-bam是单端比对后bam合并的，insert-size都为0。-因此hapcut运行会过滤掉这些序列。修改hapcut2源代码"><a href="#由于hic-bam是单端比对后bam合并的，insert-size都为0。-因此hapcut运行会过滤掉这些序列。修改hapcut2源代码" class="headerlink" title="由于hic bam是单端比对后bam合并的，insert size都为0。 因此hapcut运行会过滤掉这些序列。修改hapcut2源代码"></a>由于hic bam是单端比对后bam合并的，insert size都为0。 因此hapcut运行会过滤掉这些序列。修改hapcut2源代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172</span>         <span class="keyword">if</span> (read-&gt;tid == read-&gt;mtid &amp;&amp; read-&gt;IS==<span class="number">0</span>) <span class="comment">// use mateposition to calculate insert size, march 12 2013, wrong since we need to consider the readlength/cigar</span></span><br><span class="line"><span class="number">173</span>         &#123;</span><br><span class="line"><span class="number">174</span>             read-&gt;IS = read-&gt;mateposition - read-&gt;position;</span><br><span class="line"><span class="number">175</span>         &#125;</span><br></pre></td></tr></table></figure><p>and then type <code>make</code></p><p><img src="/2018/12/18/20181218/hapcut2hic.png" alt="hapcuthic"></p>]]></content>
    
    <summary type="html">
    
      worklog in 20181218
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="worklog" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/worklog/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="hapcut2" scheme="https://zhouqiangwei.github.io/tags/hapcut2/"/>
    
  </entry>
  
  <entry>
    <title>workingon</title>
    <link href="https://zhouqiangwei.github.io/2018/12/16/workingon/"/>
    <id>https://zhouqiangwei.github.io/2018/12/16/workingon/</id>
    <published>2018-12-16T07:26:25.000Z</published>
    <updated>2019-01-06T07:34:11.916Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="A549"><a href="#A549" class="headerlink" title="A549"></a>A549</h2><p>WGBS |  SNP+METH  –&gt; done<br>WGS | SNP –&gt; Hapcut2 –&gt; done<br>HiC | SNP –&gt; merge bam –&gt; Hapcut … –&gt; Hapcut2<br>WGBS+HiC | … coding –&gt; run WGBS and HiC hap</p><h2 id="A549-RNAseq-SNPsplit"><a href="#A549-RNAseq-SNPsplit" class="headerlink" title="A549 RNAseq SNPsplit"></a>A549 RNAseq SNPsplit</h2><p>Known relationship bwttwen ASM and ASEQ –&gt; …</p><h2 id="GM12878-ChIP-Seq-asm-heatmap"><a href="#GM12878-ChIP-Seq-asm-heatmap" class="headerlink" title="GM12878 ChIP-Seq asm heatmap"></a>GM12878 ChIP-Seq asm heatmap</h2><p>divide Number –&gt; done!</p><h2 id="F123"><a href="#F123" class="headerlink" title="F123"></a>F123</h2><p>WGBS | SNP+METH –&gt; fqc –&gt; trim –&gt; merge fq and gzip –&gt; alignment … –&gt; mrsam2bam – merge SNP and meth – splitbam –&gt; hapcut2<br>HiC | SNP –&gt; masked genome index –&gt; run Hic-pro … –&gt; mergebam –&gt; hapcut2 –&gt; done<br>MethyHiC –&gt; done<br>WGBS+HiC –&gt; … coding –&gt; run WGBS and HiC hap</p><h2 id="aradopisis"><a href="#aradopisis" class="headerlink" title="aradopisis"></a>aradopisis</h2><p>F1 | WGBS –&gt; alignment –&gt; pipleline … -&gt; mrsam2bam –&gt; SNP calling – splitbam –&gt; merge SNP and meth –&gt; hapcut2</p>]]></content>
    
    <summary type="html">
    
      working on about bioinformatics
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="workingon" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/workingon/"/>
    
    
      <category term="workingon" scheme="https://zhouqiangwei.github.io/tags/workingon/"/>
    
  </entry>
  
  <entry>
    <title>HiC-Pro</title>
    <link href="https://zhouqiangwei.github.io/2018/12/16/HiC-Pro/"/>
    <id>https://zhouqiangwei.github.io/2018/12/16/HiC-Pro/</id>
    <published>2018-12-16T06:05:55.000Z</published>
    <updated>2019-01-06T07:34:11.904Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="修改vcf格式"><a href="#修改vcf格式" class="headerlink" title="修改vcf格式"></a>修改vcf格式</h2><p>  不使用HiC-Pro的extract_SNP，因为只是提取的纯和SNP；<br>  我们想要的是杂合SNP；<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v OFS=<span class="string">"\t"</span> <span class="string">'&#123;if($1~/^#/)&#123;if($1=="#CHROM")&#123;print $1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9" REF-F123-F1"&#125;else&#123;print $0&#125;&#125;else&#123;if($NF~/0\/1/)&#123;print $1,$2,$3,$4,$5,$6,$7,$8,"GT\t0/1"&#125;&#125;&#125;'</span> ../methyHic/GSE48592_castx129_variants.mm10.vcf &gt; F123.hetero.reformat.vcf</span><br></pre></td></tr></table></figure></p><h2 id="build-masked-genome"><a href="#build-masked-genome" class="headerlink" title="build masked genome"></a>build masked genome</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bedtools maskfasta -<span class="keyword">fi</span> ~/practice/Genome/mouse/mm10/mouse_reference.fa -fo mm10.masked.fa -bed ../F123.hetero.reformat.vcf</span><br></pre></td></tr></table></figure><h2 id="build-index-of-the-masked-genome"><a href="#build-index-of-the-masked-genome" class="headerlink" title="build index of the masked genome"></a>build index of the masked genome</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bowtie2-build mm10.masked.fa mm10.masked.fa</span><br></pre></td></tr></table></figure><h2 id="Edit-config-hicAllele-txt"><a href="#Edit-config-hicAllele-txt" class="headerlink" title="Edit config-hicAllele.txt"></a>Edit config-hicAllele.txt</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please change the variable settings below if necessary</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"><span class="comment">## Paths and Settings  - Do not edit !</span></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"></span><br><span class="line">TMP_DIR = tmp</span><br><span class="line">LOGS_DIR = logs</span><br><span class="line">BOWTIE2_OUTPUT_DIR = bowtie_results</span><br><span class="line">MAPC_OUTPUT = hic_results_allele</span><br><span class="line">RAW_DIR = rawdata</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## SYSTEM AND SCHEDULER - Start Editing Here !!</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">N_CPU = 8</span><br><span class="line">LOGFILE = hicpro.log</span><br><span class="line"></span><br><span class="line">JOB_NAME = F123_hic</span><br><span class="line">JOB_MEM = 100gb</span><br><span class="line">JOB_WALLTIME = 1200:00</span><br><span class="line">JOB_QUEUE = batch</span><br><span class="line">JOB_MAIL = 1010170266@qq.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"><span class="comment">## Data</span></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"></span><br><span class="line">PAIR1_EXT = _1</span><br><span class="line">PAIR2_EXT = _2</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Alignment options</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">FORMAT = phred33</span><br><span class="line">MIN_MAPQ = 15</span><br><span class="line"></span><br><span class="line">BOWTIE2_IDX_PATH = /public/home/qwzhou/practice/mus_hic_mth/F123HiC/bowtie2_Allele</span><br><span class="line">BOWTIE2_GLOBAL_OPTIONS = --very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder</span><br><span class="line">BOWTIE2_LOCAL_OPTIONS =  --very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Annotation files</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">REFERENCE_GENOME = mm10.masked.fa</span><br><span class="line">GENOME_SIZE = chrom_mm10.sizes</span><br><span class="line">CAPTURE_TARGET =</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Allele specific analysis</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">ALLELE_SPECIFIC_SNP = /public/home/qwzhou/practice/mus_hic_mth/F123HiC/F123.hetero.reformat.vcf</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Digestion Hi-C</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">GENOME_FRAGMENT = mm10_dpnii_res.txt</span><br><span class="line">LIGATION_SITE = GATCGATC</span><br><span class="line">MIN_FRAG_SIZE = 100</span><br><span class="line">MAX_FRAG_SIZE = </span><br><span class="line">MIN_INSERT_SIZE = 100</span><br><span class="line">MAX_INSERT_SIZE = </span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Hi-C processing</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">MIN_CIS_DIST = </span><br><span class="line">GET_ALL_INTERACTION_CLASSES = 1</span><br><span class="line">GET_PROCESS_SAM = 1</span><br><span class="line">RM_SINGLETON = 1</span><br><span class="line">RM_MULTI = 1</span><br><span class="line">RM_DUP = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Contact Maps</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line">BIN_SIZE = 5000 10000 20000 40000 150000 500000</span><br><span class="line">MATRIX_FORMAT = upper</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Normalization</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">MAX_ITER = 100</span><br><span class="line">FILTER_LOW_COUNT_PERC = 0.02</span><br><span class="line">FILTER_HIGH_COUNT_PERC = 0</span><br><span class="line">EPS = 0.1</span><br></pre></td></tr></table></figure><h2 id="run-HiC-Pro"><a href="#run-HiC-Pro" class="headerlink" title="run HiC-Pro"></a>run HiC-Pro</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/software/HiC-Pro_2.11.0-beta/bin/HiC-Pro -c config-hicAllele.txt -i rawdata/ -o hicsnp_latest_allele</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      HiC data ananlysis using HiC-Pro
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="HiC" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/HiC/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="HiC" scheme="https://zhouqiangwei.github.io/tags/HiC/"/>
    
  </entry>
  
  <entry>
    <title>methLevelPlot</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/methLevelPlot/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/methLevelPlot/</id>
    <published>2018-12-15T07:00:56.000Z</published>
    <updated>2019-01-06T07:34:11.912Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Fri 10:29:50 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: qwzhou</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">=======================================</span></span><br><span class="line"><span class="string">plot line and dash</span></span><br><span class="line"><span class="string">=======================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> matplotlib.backends.backend_pdf <span class="keyword">import</span> PdfPages</span><br><span class="line"><span class="comment">#x = np.linspace(0, 10, 500)</span></span><br><span class="line"></span><br><span class="line">y = []</span><br><span class="line">z = []</span><br><span class="line">k = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readfile</span><span class="params">(filename, y, z, k)</span>:</span></span><br><span class="line">    nline=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> fig:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fig:</span><br><span class="line">            data = line.split()</span><br><span class="line">            <span class="keyword">if</span> nline == <span class="number">0</span>:</span><br><span class="line">                y.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">1</span>:</span><br><span class="line">                z.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">2</span>:</span><br><span class="line">                k.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            nline=nline+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("IMR90.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## read file2</span></span><br><span class="line"><span class="comment">#readfile("imr90.asmg.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">#readfile("H1_bs.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">readfile(<span class="string">"./IMR90/h3k4me3_peaks.Methy.1.txt"</span>, y, z, k)</span><br><span class="line">readfile(<span class="string">"./IMR90/h3k27ac_peaks.Methy.1.txt"</span>, y, z, k)</span><br><span class="line">readfile(<span class="string">"./IMR90/PolII_peaks.Methy.1.txt"</span>, y, z, k)</span><br><span class="line"><span class="comment">#readfile("./A549/IMR90.gene.fcbneg2.p0.001.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/IMR90.gene.fcbneg4.p0.001.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/IMR90.gene.fcsneg4.p0.001.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/peaks.mr.Methylevel.7.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/peaks.mr.Methylevel.8.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("IMR90.asmanno.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#     </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("ENCFF304DGQ.Methylevel.1.txt", y, z, k)</span></span><br><span class="line">x = np.linspace(<span class="number">1</span>, len(y[<span class="number">0</span>]), len(y[<span class="number">0</span>]))</span><br><span class="line">label = [<span class="string">'H3K4me3'</span>, <span class="string">'H3K27ac'</span> , <span class="string">'PollII'</span>]</span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_martrix_max_value</span><span class="params">(data_matrix)</span>:</span>  </span><br><span class="line">    new_data=[]  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data_matrix)):  </span><br><span class="line">        new_data.append(max(data_matrix[i]))</span><br><span class="line">    <span class="keyword">return</span> max(new_data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plotline</span><span class="params">(x, y, title, label, nsample, legend, filename)</span>:</span></span><br><span class="line">    prosamp = <span class="number">0</span></span><br><span class="line">    fig, ax = plt.subplots()</span><br><span class="line">    <span class="keyword">while</span> prosamp &lt; nsample:</span><br><span class="line">        y[prosamp] = [i*<span class="number">100</span> <span class="keyword">for</span> i <span class="keyword">in</span> y[prosamp]]</span><br><span class="line">        ax.plot(x, y[prosamp], label=label[prosamp])</span><br><span class="line">        prosamp = prosamp +<span class="number">1</span></span><br><span class="line">    <span class="comment">#dashes = [10, 5, 100, 5]</span></span><br><span class="line">    <span class="comment">#line1.set_dashes(dashes)   #   dash line</span></span><br><span class="line">    <span class="comment"># Remove the plot frame lines. They are unnecessary here.</span></span><br><span class="line">    ax.spines[<span class="string">'top'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    ax.spines[<span class="string">'bottom'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    ax.spines[<span class="string">'right'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    <span class="comment">#ax.spines['left'].set_visible(False)</span></span><br><span class="line">    ax.xaxis.set_major_formatter(plt.FuncFormatter(<span class="string">'&#123;:.0f&#125;'</span>.format))</span><br><span class="line">    ax.yaxis.set_major_formatter(plt.FuncFormatter(<span class="string">'&#123;:.1f&#125;%'</span>.format))</span><br><span class="line">    <span class="comment">#plt.grid(True, 'major', 'y', ls='--', lw=.5, c='k', alpha=.3)</span></span><br><span class="line">    plt.tick_params(axis=<span class="string">'both'</span>, which=<span class="string">'both'</span>, bottom=<span class="keyword">False</span>, top=<span class="keyword">False</span>,</span><br><span class="line">                labelbottom=<span class="keyword">True</span>, left=<span class="keyword">False</span>, right=<span class="keyword">False</span>, labelleft=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment">#ax.axes.get_xaxis().set_visible(False)</span></span><br><span class="line">    <span class="keyword">if</span> legend == <span class="number">1</span>:</span><br><span class="line">        plt.legend(loc=<span class="string">'best'</span>, prop=&#123;<span class="string">'size'</span>: <span class="number">12</span>&#125;)   <span class="comment">#   legend , loc is the legend location</span></span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.05</span>, xmax=<span class="number">0.35</span>, linewidth=<span class="number">8</span>, color=<span class="string">'gray'</span>)</span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.65</span>, xmax=<span class="number">0.35</span>, linewidth=<span class="number">8</span>, color=<span class="string">'k'</span> )</span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.65</span>, xmax=<span class="number">0.95</span>, linewidth=<span class="number">8</span>, color=<span class="string">'gray'</span>) </span><br><span class="line">    scale_ls = [<span class="number">1</span>,<span class="number">39</span>,<span class="number">76</span>,<span class="number">117</span>]</span><br><span class="line">    index_ls = [<span class="string">'upstream'</span>,<span class="string">'Start'</span>,<span class="string">'End'</span>, <span class="string">"downstream"</span>]</span><br><span class="line">    plt.xticks(scale_ls,index_ls,color=<span class="string">'k'</span>, size=<span class="number">15</span>)</span><br><span class="line">    ax.set_title(title,size=<span class="number">15</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'ASM C count'</span>,size=<span class="number">15</span>)</span><br><span class="line">    <span class="comment">#ax.set_ylabel('Methylation Level',size=15)</span></span><br><span class="line">    maxy = <span class="number">100</span></span><br><span class="line">    maxy = find_martrix_max_value(y) * <span class="number">1.1</span></span><br><span class="line">    </span><br><span class="line">    ax.set_ylim(<span class="number">0.0</span>, maxy)</span><br><span class="line">    <span class="comment">#plt.show()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#filename2=filename + ".png"</span></span><br><span class="line">    <span class="comment">#plt.savefig(filename2, bbox_inches='tight')</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#label = ['IMR90', 'A549', 'H1', 'GM12878', 'encodeA549']</span></span><br><span class="line"></span><br><span class="line">filename=<span class="string">"methylation"</span></span><br><span class="line">filename2=filename + <span class="string">".pdf"</span></span><br><span class="line">pdf = PdfPages(filename2)</span><br><span class="line"></span><br><span class="line">nsample=<span class="number">3</span></span><br><span class="line">legend=<span class="number">1</span></span><br><span class="line">plotline(x, y, <span class="string">"CG methylation distribution"</span>, label, nsample, legend, filename+<span class="string">".CG"</span>)</span><br><span class="line">legend=<span class="number">0</span></span><br><span class="line">plotline(x, z, <span class="string">"CHG methylation distribution"</span>, label, nsample, legend, filename+<span class="string">".CHG"</span>)</span><br><span class="line">plotline(x, k, <span class="string">"CHH methylation distribution"</span>, label, nsample, legend, filename+<span class="string">".CHH"</span>)</span><br><span class="line"> </span><br><span class="line">pdf.savefig()</span><br><span class="line">pdf.close()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">    fig, ax = plt.subplots()</span></span><br><span class="line"><span class="string">    line1, = ax.plot(x, k1, label='IMR90')</span></span><br><span class="line"><span class="string">    #dashes = [10, 5, 100, 5]</span></span><br><span class="line"><span class="string">    #line1.set_dashes(dashes)   #   dash line</span></span><br><span class="line"><span class="string">    line2, = ax.plot(x, k2, label='A549')</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #  several dash line example</span></span><br><span class="line"><span class="string">    #line3, = ax.plot(x, y3, ':', label='..style')</span></span><br><span class="line"><span class="string">    #line4, = ax.plot(x,-np.sin(x)/2, '-.', label='-.style')</span></span><br><span class="line"><span class="string">    #line5, = ax.plot(x,np.sin(x)/4, '--', label='--style')</span></span><br><span class="line"><span class="string">    #line6, = ax.plot(x,-np.sin(x)/4, '^', label='--style')</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #plt.axis('off')</span></span><br><span class="line"><span class="string">    #plt.xticks([])</span></span><br><span class="line"><span class="string">    #plt.yticks([])</span></span><br><span class="line"><span class="string">    #ax.axes.get_yaxis().set_visible(False)</span></span><br><span class="line"><span class="string">    # Remove the plot frame lines. They are unnecessary here.</span></span><br><span class="line"><span class="string">    ax.spines['top'].set_visible(False)</span></span><br><span class="line"><span class="string">    ax.spines['bottom'].set_visible(False)</span></span><br><span class="line"><span class="string">    ax.spines['right'].set_visible(False)</span></span><br><span class="line"><span class="string">    #ax.spines['left'].set_visible(False)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #ax.axes.get_xaxis().set_visible(False)</span></span><br><span class="line"><span class="string">    plt.legend(loc='center right')   #   legend , loc is the legend location</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.05, xmax=0.35, linewidth=8, color='gray')</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.65, xmax=0.35, linewidth=8, color='k' )</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.65, xmax=0.95, linewidth=8, color='gray') </span></span><br><span class="line"><span class="string">    scale_ls = [1,39,76,117]</span></span><br><span class="line"><span class="string">    index_ls = ['upstream','Start','End', "downstream"]</span></span><br><span class="line"><span class="string">    plt.xticks(scale_ls,index_ls,color='k', size=15)</span></span><br><span class="line"><span class="string">    #ax.set_title('Box plot')</span></span><br><span class="line"><span class="string">    ax.set_ylabel('Methylation Level',size=15)</span></span><br><span class="line"><span class="string">    maxy=max(k1)</span></span><br><span class="line"><span class="string">    if max(k2) &gt; maxy:</span></span><br><span class="line"><span class="string">        maxy = max(k2)*1.1</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        maxy = maxy*1.1</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ax.set_ylim(0.0, maxy)</span></span><br><span class="line"><span class="string">    #plt.savefig("test.png")</span></span><br><span class="line"><span class="string">    plt.show()</span></span><br><span class="line"><span class="string"> '''</span></span><br></pre></td></tr></table></figure><h2 id="results"><a href="#results" class="headerlink" title="results"></a>results</h2><p><img src="/2018/12/15/methLevelPlot/methylevel.png" alt="methylevel"></p>]]></content>
    
    <summary type="html">
    
      visualization, python, methylevel
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="python" scheme="https://zhouqiangwei.github.io/categories/visualization/python/"/>
    
    
      <category term="visualization, python, methylevel" scheme="https://zhouqiangwei.github.io/tags/visualization-python-methylevel/"/>
    
  </entry>
  
  <entry>
    <title>methpoint</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/methpoint/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/methpoint/</id>
    <published>2018-12-15T06:56:50.000Z</published>
    <updated>2019-01-06T07:34:11.912Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Fri May 18 15:50:17 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: qwzhou</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.lines <span class="keyword">import</span> Line2D</span><br><span class="line"><span class="keyword">import</span> pysam</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usage</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"\nPROGRAM input.sort.bam chr:start-end"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"\nPlease define the chrom region!\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">    usage()</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line"><span class="comment">##read meth file</span></span><br><span class="line">path_in = sys.argv[<span class="number">1</span>] <span class="comment">##bam file</span></span><br><span class="line">samfile = pysam.AlignmentFile(path_in, <span class="string">"rb"</span>)</span><br><span class="line"><span class="comment">#for line in samfile:</span></span><br><span class="line"><span class="comment">#    print(line)</span></span><br><span class="line"><span class="comment">#    break</span></span><br><span class="line">lines = []</span><br><span class="line">postion = []</span><br><span class="line">neglines = []</span><br><span class="line">negpostion = []</span><br><span class="line">pchr = sys.argv[<span class="number">2</span>].split(<span class="string">":"</span>)[<span class="number">0</span>]</span><br><span class="line">pstart = int(sys.argv[<span class="number">2</span>].split(<span class="string">":"</span>)[<span class="number">1</span>].split(<span class="string">"-"</span>)[<span class="number">0</span>])</span><br><span class="line">pend = int(sys.argv[<span class="number">2</span>].split(<span class="string">":"</span>)[<span class="number">1</span>].split(<span class="string">"-"</span>)[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">print</span> pchr, pstart, pend</span><br><span class="line">strand = <span class="string">'.'</span></span><br><span class="line"><span class="keyword">for</span> read <span class="keyword">in</span> samfile.fetch(pchr, pstart, pend):</span><br><span class="line">    <span class="comment">#tags = read.rstrip().split("\t")</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">not</span> (read.flag &amp; <span class="number">0x2</span>) <span class="keyword">and</span> <span class="keyword">not</span> (read.flag &amp; <span class="number">0x10</span>) <span class="keyword">or</span> ( (read.flag &amp; <span class="number">0x2</span>) <span class="keyword">and</span> ( ((read.flag &amp; <span class="number">0x40</span>) <span class="keyword">and</span> (read.flag &amp; <span class="number">0x20</span>)) <span class="keyword">or</span> ((read.flag &amp; <span class="number">0x80</span>) <span class="keyword">and</span> (read.flag &amp; <span class="number">0x10</span> ))) ) ):</span><br><span class="line">        lines.append(read.get_tag(<span class="string">"MD"</span>))</span><br><span class="line">        postion.append(read.pos)</span><br><span class="line">    <span class="keyword">elif</span> ( <span class="keyword">not</span> (read.flag &amp; <span class="number">0x2</span>) <span class="keyword">and</span> (read.flag &amp; <span class="number">0x10</span>) <span class="keyword">or</span> ( (read.flag &amp; <span class="number">0x2</span>) <span class="keyword">and</span> ( ((read.flag &amp; <span class="number">0x40</span>) <span class="keyword">and</span> (read.flag &amp; <span class="number">0x10</span>)) <span class="keyword">or</span> ((read.flag &amp; <span class="number">0x80</span>) <span class="keyword">and</span> (read.flag &amp; <span class="number">0x20</span> ))) ) ):</span><br><span class="line">        neglines.append(read.get_tag(<span class="string">"MD"</span>))</span><br><span class="line">        negpostion.append(read.pos)</span><br><span class="line"></span><br><span class="line">samfile.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#points = ['1','1','1','3','2']  # Draw 3 points for each line</span></span><br><span class="line">text_style = dict(horizontalalignment=<span class="string">'right'</span>, verticalalignment=<span class="string">'center'</span>,</span><br><span class="line">                  fontsize=<span class="number">12</span>, fontdict=&#123;<span class="string">'family'</span>: <span class="string">'monospace'</span>&#125;)</span><br><span class="line">marker_style = dict(color=<span class="string">'cornflowerblue'</span>, linestyle=<span class="string">':'</span>, marker=<span class="string">'o'</span>,</span><br><span class="line">                    markersize=<span class="number">10</span>, markerfacecoloralt=<span class="string">'gray'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fillstyles</span><span class="params">(case)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> case.isupper():</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'full'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'none'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">markerstyle</span><span class="params">(case)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> marker_style</span><br><span class="line">    markersize = <span class="number">4.5</span></span><br><span class="line">    <span class="keyword">if</span> case.upper() == <span class="string">'Z'</span>:</span><br><span class="line">        marker_style = dict(color=<span class="string">'cornflowerblue'</span>, linestyle=<span class="string">':'</span>, marker=<span class="string">'o'</span>, markersize=markersize, markerfacecoloralt=<span class="string">'gray'</span>)</span><br><span class="line">    <span class="keyword">elif</span> case.upper() == <span class="string">'H'</span>:</span><br><span class="line">        marker_style = dict(color=<span class="string">'red'</span>, linestyle=<span class="string">':'</span>, marker=<span class="string">'o'</span>, markersize=markersize, markerfacecoloralt=<span class="string">'gray'</span>)</span><br><span class="line">    <span class="keyword">elif</span> case.upper() == <span class="string">'X'</span>:</span><br><span class="line">        marker_style = dict(color=<span class="string">'green'</span>, linestyle=<span class="string">':'</span>, marker=<span class="string">'o'</span>, markersize=markersize, markerfacecoloralt=<span class="string">'gray'</span>)</span><br><span class="line">    <span class="keyword">elif</span> case == <span class="string">'='</span>:</span><br><span class="line">    marker_style = dict(color=<span class="string">'gray'</span>, linestyle=<span class="string">':'</span>, marker=<span class="string">'o'</span>, markersize=<span class="number">0.6</span>)</span><br><span class="line">    <span class="keyword">elif</span> case == <span class="string">'A'</span>:</span><br><span class="line">    marker_style = dict(color=<span class="string">'black'</span>, linestyle=<span class="string">'-'</span>, marker=<span class="string">'1'</span>, markersize=markersize)</span><br><span class="line">    <span class="keyword">elif</span> case == <span class="string">'C'</span>:</span><br><span class="line">    marker_style = dict(color=<span class="string">'black'</span>, linestyle=<span class="string">'-'</span>, marker=<span class="string">'2'</span>, markersize=markersize)</span><br><span class="line">    <span class="keyword">elif</span> case == <span class="string">'G'</span>:</span><br><span class="line">    marker_style = dict(color=<span class="string">'black'</span>, linestyle=<span class="string">'-'</span>, marker=<span class="string">'3'</span>, markersize=markersize)</span><br><span class="line">    <span class="keyword">elif</span> case == <span class="string">'T'</span>:</span><br><span class="line">    marker_style = dict(color=<span class="string">'black'</span>, linestyle=<span class="string">'-'</span>, marker=<span class="string">'4'</span>, markersize=markersize)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        marker_style = dict(color=<span class="string">'black'</span>, linestyle=<span class="string">'-'</span>, marker=<span class="string">'|'</span>, markersize=markersize)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_axes</span><span class="params">(ax)</span>:</span></span><br><span class="line">    ax.margins(<span class="number">0.2</span>)</span><br><span class="line">    ax.set_axis_off()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nice_repr</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> repr(text).lstrip(<span class="string">'u'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">meth = []</span><br><span class="line">unmeth = []</span><br><span class="line">xpostion = []</span><br><span class="line">mratio = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initarray</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,pend-pstart):</span><br><span class="line">        meth.append(<span class="number">0</span>)</span><br><span class="line">        unmeth.append(<span class="number">0</span>)</span><br><span class="line">        mratio.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(pstart, pend):</span><br><span class="line">        xpostion.append(i)</span><br><span class="line"></span><br><span class="line">initarray()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calmeth</span><span class="params">(case, xpos)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> case.upper() != <span class="string">'Z'</span> <span class="keyword">and</span> case.upper() != <span class="string">'H'</span> <span class="keyword">and</span> case.upper() != <span class="string">'X'</span> :</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> case.isupper():</span><br><span class="line">        meth[xpos] = meth[xpos]+<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        unmeth[xpos] = unmeth[xpos]+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">nline=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y,line <span class="keyword">in</span> enumerate(lines):</span><br><span class="line">    nline=nline+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> nline&gt;<span class="number">1000</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="comment">#    if postion[y] &gt; pstart:</span></span><br><span class="line"><span class="comment">#        continue</span></span><br><span class="line">    <span class="keyword">if</span> postion[y] &gt; pend:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> x, ch <span class="keyword">in</span> enumerate(line):</span><br><span class="line">        <span class="keyword">if</span> x+postion[y] &lt; pstart:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> x+postion[y] &gt; pend:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        calmeth(ch, x+postion[y]-pstart)</span><br><span class="line">        markerstyle(ch)</span><br><span class="line">        ax.plot( x+postion[y], -round((y+y*<span class="number">0.1</span>),<span class="number">2</span>), fillstyle=fillstyles(ch), **marker_style)</span><br><span class="line">        format_axes(ax)</span><br><span class="line"></span><br><span class="line">ax.plot([pstart,pend],[-round((y+y*<span class="number">0.1</span>+<span class="number">1</span>),<span class="number">2</span>),-round((y+y*<span class="number">0.1</span>+<span class="number">1</span>),<span class="number">2</span>)], color=<span class="string">'black'</span>);</span><br><span class="line">ax.text(pstart, -round((y+y*<span class="number">0.1</span>+<span class="number">3</span>),<span class="number">2</span>), sys.argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> meth</span><br><span class="line"><span class="keyword">print</span> unmeth</span><br><span class="line"><span class="keyword">print</span> xpostion</span><br><span class="line"></span><br><span class="line"><span class="comment">#[a[i]/b[i] if b[i] !=0 else 0 for i in range(3)]</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(meth)):</span><br><span class="line">    <span class="keyword">if</span> meth[i]+unmeth[i]&gt;<span class="number">0</span>:</span><br><span class="line">        mratio[i] = <span class="number">-1.0</span>*meth[i]/(unmeth[i]+meth[i])  - round((y+y*<span class="number">0.1</span>+<span class="number">4</span>),<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mratio[i] = <span class="number">0</span>  -round((y+y*<span class="number">0.1</span>+<span class="number">4</span>),<span class="number">2</span>)</span><br><span class="line">ax.plot(xpostion, mratio)</span><br><span class="line"><span class="comment"># Plot all fill styles.</span></span><br><span class="line"><span class="comment">#for y, fill_style in enumerate(Line2D.fillStyles):</span></span><br><span class="line"><span class="comment">#    ax.text(-0.5, y, nice_repr(fill_style), **text_style)</span></span><br><span class="line"><span class="comment">#    ax.plot(y * points, fillstyle=fill_style, **marker_style)</span></span><br><span class="line"><span class="comment">#    format_axes(ax)</span></span><br><span class="line"><span class="comment">#    ax.set_title('fill style')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename= <span class="string">"test.png"</span></span><br><span class="line">plt.savefig(filename, bbox_inches=<span class="string">'tight'</span>, dpi=<span class="number">128</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p><img src="/2018/12/15/methpoint/6.jpg" alt="methpoint"></p>]]></content>
    
    <summary type="html">
    
      visualization, python, methpoint
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="python" scheme="https://zhouqiangwei.github.io/categories/visualization/python/"/>
    
    
      <category term="visualization, python, methpoint" scheme="https://zhouqiangwei.github.io/tags/visualization-python-methpoint/"/>
    
  </entry>
  
  <entry>
    <title>plotProfile</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/plotProfile/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/plotProfile/</id>
    <published>2018-12-15T06:52:18.000Z</published>
    <updated>2019-04-03T07:40:08.326Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Fri Sep 21 10:29:50 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: qwzhou</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">=======================================</span></span><br><span class="line"><span class="string">plot line and dash</span></span><br><span class="line"><span class="string">=======================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> matplotlib.backends.backend_pdf <span class="keyword">import</span> PdfPages</span><br><span class="line"><span class="comment">#x = np.linspace(0, 10, 500)</span></span><br><span class="line"></span><br><span class="line">y = []</span><br><span class="line">z = []</span><br><span class="line">k = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readfile</span><span class="params">(filename, y, z, k)</span>:</span></span><br><span class="line">    nline=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> fig:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fig:</span><br><span class="line">            data = line.split()</span><br><span class="line">            <span class="keyword">if</span> nline == <span class="number">0</span>:</span><br><span class="line">                y.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">1</span>:</span><br><span class="line">                z.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">2</span>:</span><br><span class="line">                k.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            nline=nline+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("IMR90.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## read file2</span></span><br><span class="line"><span class="comment">#readfile("imr90.asmg.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">#readfile("H1_bs.Methylevel.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#.narrowPeak  .broadPeak  .narrowPeak  .broadPeak</span></span><br><span class="line"><span class="comment">#.broadPeak   .broadPeak   .narrowPeak</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27ac_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K36me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me3_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me1_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9ac_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27ac_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K36me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me1_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/CTCF_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/PolII_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line">readfile(<span class="string">"./IMR90/gene.TSS.Methy.1.txt"</span>, y, z, k)</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A_peaks.newasm.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A.Allele.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line">            </span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.LINE.Methy.1.txt.Aver", y, z, k) </span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.SINE.Methy.1.txt.Aver", y, z, k) </span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.LTR.Methy.1.txt.Aver", y, z, k)       </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./A549/h3k27ac_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k4me3_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k4me1_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k36me3_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k27me3_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k9me3_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K27me3_none_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K9me3_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K4me1_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K27ac_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K4me3_UW_peaks.newasm.Methy.1.txt", y, z, k)        </span></span><br><span class="line"><span class="comment">#              </span></span><br><span class="line"><span class="comment">#     </span></span><br><span class="line"><span class="comment">#     </span></span><br><span class="line">     </span><br><span class="line">  </span><br><span class="line"><span class="comment">#readfile("ENCFF304DGQ.Methylevel.1.txt", y, z, k)</span></span><br><span class="line">x = np.linspace(<span class="number">1</span>, len(y[<span class="number">0</span>]), len(y[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#label=['h3k4me1']</span></span><br><span class="line"><span class="comment">#label=[ 'h3k4me3', 'h3k27ac','h3k4me1', 'h3k36me3', 'h3k27me3',  'h3k9me3']</span></span><br><span class="line"><span class="comment">#label=[ 'h3k27ac', 'h3k36me3','h3k4me3', 'h3k9me3', 'h3k27me3',  'h34me1', 'h3k9ac']</span></span><br><span class="line"><span class="comment">#label=[ 'h3k27ac', 'h3k4me3','h34me1', 'h3k36me3', 'h3k27me3',  'h3k9me3']</span></span><br><span class="line"><span class="comment">#label=[ 'h3k27ac', 'h3k36me3','h3k4me3', 'h3k9me3', 'h3k27me3',  'h3k4me1', 'CTCF', 'PolII']</span></span><br><span class="line">label=[<span class="string">'gene'</span>]</span><br><span class="line"><span class="comment">#label=['Repeat', 'LINE', 'SINE', 'LTR']</span></span><br><span class="line"><span class="comment">#label=['CTCF_ALL', 'CTCF_Allele']</span></span><br><span class="line"><span class="comment">#label=[ 'CTCF_UT-A', 'H3K27me3_none','H3K9me3_stanford', 'CTCF_stanford', 'H3K4me1_stanford',  'H3K27ac_stanford', 'H3K4me3_UW_peaks']</span></span><br><span class="line">filename=<span class="string">"./IMR90/ASM.distri.TSS.Sites"</span></span><br><span class="line">filename2=filename + <span class="string">".pdf"</span></span><br><span class="line">nsample=<span class="number">1</span></span><br><span class="line">legend=<span class="number">1</span></span><br><span class="line">percentage=<span class="number">1</span></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_martrix_max_value</span><span class="params">(data_matrix)</span>:</span>  </span><br><span class="line">    new_data=[]  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data_matrix)):  </span><br><span class="line">        new_data.append(max(data_matrix[i]))</span><br><span class="line">    <span class="keyword">return</span> max(new_data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plotline</span><span class="params">(x, y, title, label, nsample, legend, filename)</span>:</span></span><br><span class="line">    prosamp = <span class="number">0</span></span><br><span class="line">    fig, ax = plt.subplots()</span><br><span class="line">    <span class="keyword">while</span> prosamp &lt; nsample:</span><br><span class="line">        y[prosamp] = [i*percentage <span class="keyword">for</span> i <span class="keyword">in</span> y[prosamp]]</span><br><span class="line">        ax.plot(x, y[prosamp], label=label[prosamp])</span><br><span class="line">        prosamp = prosamp +<span class="number">1</span></span><br><span class="line">    <span class="comment">#dashes = [10, 5, 100, 5]</span></span><br><span class="line">    <span class="comment">#line1.set_dashes(dashes)   #   dash line</span></span><br><span class="line">    <span class="comment"># Remove the plot frame lines. They are unnecessary here.</span></span><br><span class="line">    ax.spines[<span class="string">'top'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    ax.spines[<span class="string">'bottom'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    ax.spines[<span class="string">'right'</span>].set_visible(<span class="keyword">False</span>)</span><br><span class="line">    <span class="comment">#ax.spines['left'].set_visible(False)</span></span><br><span class="line">    ax.xaxis.set_major_formatter(plt.FuncFormatter(<span class="string">'&#123;:.0f&#125;'</span>.format))</span><br><span class="line">    <span class="comment">#ax.yaxis.set_major_formatter(plt.FuncFormatter('&#123;:.1f&#125;%'.format))</span></span><br><span class="line">    <span class="comment">#plt.grid(True, 'major', 'y', ls='--', lw=.5, c='k', alpha=.3)</span></span><br><span class="line">    plt.tick_params(axis=<span class="string">'both'</span>, which=<span class="string">'both'</span>, bottom=<span class="keyword">False</span>, top=<span class="keyword">False</span>,</span><br><span class="line">                labelbottom=<span class="keyword">True</span>, left=<span class="keyword">False</span>, right=<span class="keyword">False</span>, labelleft=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment">#ax.axes.get_xaxis().set_visible(False)</span></span><br><span class="line">    <span class="keyword">if</span> legend == <span class="number">1</span>:</span><br><span class="line">        plt.legend(loc=<span class="string">'best'</span>, prop=&#123;<span class="string">'size'</span>: <span class="number">12</span>&#125;)   <span class="comment">#   legend , loc is the legend location</span></span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.05</span>, xmax=<span class="number">0.35</span>, linewidth=<span class="number">8</span>, color=<span class="string">'gray'</span>)</span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.65</span>, xmax=<span class="number">0.35</span>, linewidth=<span class="number">8</span>, color=<span class="string">'k'</span> )</span><br><span class="line">    plt.axhline(y=<span class="number">0</span>, xmin=<span class="number">0.65</span>, xmax=<span class="number">0.95</span>, linewidth=<span class="number">8</span>, color=<span class="string">'gray'</span>) </span><br><span class="line">    scale_ls = [<span class="number">1</span>,<span class="number">39</span>,<span class="number">76</span>,<span class="number">117</span>]</span><br><span class="line">    index_ls = [<span class="string">'upstream'</span>,<span class="string">'Start'</span>,<span class="string">'End'</span>, <span class="string">"downstream"</span>]</span><br><span class="line">    plt.xticks(scale_ls,index_ls,color=<span class="string">'k'</span>, size=<span class="number">15</span>)</span><br><span class="line">    ax.set_title(title,size=<span class="number">15</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'ASM percentage (%)'</span>,size=<span class="number">15</span>)</span><br><span class="line">    <span class="comment">#ax.set_ylabel('Methylation Level',size=15)</span></span><br><span class="line">    maxy = <span class="number">100</span></span><br><span class="line">    maxy = find_martrix_max_value(y) * <span class="number">1.1</span></span><br><span class="line">    </span><br><span class="line">    ax.set_ylim(<span class="number">0.0</span>, maxy)</span><br><span class="line">    <span class="comment">#plt.show()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#filename2=filename + ".png"</span></span><br><span class="line">    <span class="comment">#plt.savefig(filename2, bbox_inches='tight')</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#label = ['IMR90', 'A549', 'H1', 'GM12878', 'encodeA549']</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pdf = PdfPages(filename2)</span><br><span class="line"></span><br><span class="line">plotline(x, y, <span class="string">"ASM distribution"</span>, label, nsample, legend, filename+<span class="string">".CG"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#plotline(x, y, "CG methylation distribution", label, nsample, legend, filename+".CG")</span></span><br><span class="line">legend=<span class="number">0</span></span><br><span class="line"><span class="comment">#plotline(x, z, "CHG methylation distribution", label, nsample, legend, filename+".CHG")</span></span><br><span class="line"><span class="comment">#plotline(x, k, "CHH methylation distribution", label, nsample, legend, filename+".CHH")</span></span><br><span class="line"> </span><br><span class="line">pdf.savefig()</span><br><span class="line">pdf.close()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">    fig, ax = plt.subplots()</span></span><br><span class="line"><span class="string">    line1, = ax.plot(x, k1, label='IMR90')</span></span><br><span class="line"><span class="string">    #dashes = [10, 5, 100, 5]</span></span><br><span class="line"><span class="string">    #line1.set_dashes(dashes)   #   dash line</span></span><br><span class="line"><span class="string">    line2, = ax.plot(x, k2, label='A549')</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #  several dash line example</span></span><br><span class="line"><span class="string">    #line3, = ax.plot(x, y3, ':', label='..style')</span></span><br><span class="line"><span class="string">    #line4, = ax.plot(x,-np.sin(x)/2, '-.', label='-.style')</span></span><br><span class="line"><span class="string">    #line5, = ax.plot(x,np.sin(x)/4, '--', label='--style')</span></span><br><span class="line"><span class="string">    #line6, = ax.plot(x,-np.sin(x)/4, '^', label='--style')</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #plt.axis('off')</span></span><br><span class="line"><span class="string">    #plt.xticks([])</span></span><br><span class="line"><span class="string">    #plt.yticks([])</span></span><br><span class="line"><span class="string">    #ax.axes.get_yaxis().set_visible(False)</span></span><br><span class="line"><span class="string">    # Remove the plot frame lines. They are unnecessary here.</span></span><br><span class="line"><span class="string">    ax.spines['top'].set_visible(False)</span></span><br><span class="line"><span class="string">    ax.spines['bottom'].set_visible(False)</span></span><br><span class="line"><span class="string">    ax.spines['right'].set_visible(False)</span></span><br><span class="line"><span class="string">    #ax.spines['left'].set_visible(False)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    #ax.axes.get_xaxis().set_visible(False)</span></span><br><span class="line"><span class="string">    plt.legend(loc='center right')   #   legend , loc is the legend location</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.05, xmax=0.35, linewidth=8, color='gray')</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.65, xmax=0.35, linewidth=8, color='k' )</span></span><br><span class="line"><span class="string">    plt.axhline(y=0, xmin=0.65, xmax=0.95, linewidth=8, color='gray') </span></span><br><span class="line"><span class="string">    scale_ls = [1,39,76,117]</span></span><br><span class="line"><span class="string">    index_ls = ['upstream','Start','End', "downstream"]</span></span><br><span class="line"><span class="string">    plt.xticks(scale_ls,index_ls,color='k', size=15)</span></span><br><span class="line"><span class="string">    #ax.set_title('Box plot')</span></span><br><span class="line"><span class="string">    ax.set_ylabel('Methylation Level',size=15)</span></span><br><span class="line"><span class="string">    maxy=max(k1)</span></span><br><span class="line"><span class="string">    if max(k2) &gt; maxy:</span></span><br><span class="line"><span class="string">        maxy = max(k2)*1.1</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        maxy = maxy*1.1</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ax.set_ylim(0.0, maxy)</span></span><br><span class="line"><span class="string">    #plt.savefig("test.png")</span></span><br><span class="line"><span class="string">    plt.show()</span></span><br><span class="line"><span class="string"> '''</span></span><br></pre></td></tr></table></figure><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p><img src="/2018/12/15/plotProfile/profile.png" alt="profile"></p>]]></content>
    
    <summary type="html">
    
      visualization, python, profile
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="python" scheme="https://zhouqiangwei.github.io/categories/visualization/python/"/>
    
    
      <category term="visualization, python, profile" scheme="https://zhouqiangwei.github.io/tags/visualization-python-profile/"/>
    
  </entry>
  
  <entry>
    <title>plotHeatmap</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/plotHeatmap/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/plotHeatmap/</id>
    <published>2018-12-15T06:49:34.000Z</published>
    <updated>2019-01-06T07:34:11.913Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Fri Sep 21 15:37:26 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: qwzhou</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.backends.backend_pdf <span class="keyword">import</span> PdfPages</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cm </span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> axes</span><br><span class="line"></span><br><span class="line">y = []</span><br><span class="line">z = []</span><br><span class="line">k = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readfile</span><span class="params">(filename, y, z, k)</span>:</span></span><br><span class="line">    nline=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> fig:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fig:</span><br><span class="line">            data = line.split()</span><br><span class="line">            <span class="keyword">if</span> nline == <span class="number">0</span>:</span><br><span class="line">                y.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">1</span>:</span><br><span class="line">                z.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            <span class="keyword">elif</span> nline == <span class="number">2</span>:</span><br><span class="line">                k.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            nline=nline+<span class="number">1</span></span><br><span class="line">            </span><br><span class="line"><span class="comment">#readfile("./A549/PolII_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/CTCF_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./A549/h3k4me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k27ac_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k4me1_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./A549/h3k36me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k27me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549/h3k9me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./k562/H3K27ac_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/H3K4me3_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/H3K9ac_narrow_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/H3K4me1_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./k562/H3K36me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/H3K9me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/H3K27me3_broad_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27ac_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/PolII_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me1_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K36me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27me3_peaks.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K27me3_none_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K9me3_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K4me1_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K27ac_stanford_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/H3K4me3_UW_peaks.newasm.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A_peaks.newasm.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./A549_2/CTCF_UT-A.Allele.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.LINE.Methy.1.txt.Aver", y, z, k) </span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.SINE.Methy.1.txt.Aver", y, z, k) </span></span><br><span class="line"><span class="comment">#readfile("./k562/hg38.fa.out.repeat.LTR.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27ac_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K36me3_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me3_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9me3_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27me3_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me1_peaks.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27ac_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/PolII_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K4me1_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K9me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K27me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./IMR90/H3K36me3_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/CTCF_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line">            </span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K27ac_narrow_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K4me3_narrow_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K9ac_narrow_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K4me1_broad_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K27me3_broad_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K9me3_broad_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"><span class="comment">#readfile("./gm12878/H3K36me3_broad_peaks.sites.Methy.1.txt", y, z, k)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#readfile("./IMR90/hg38.fa.out.repeat.start.sites.Methy.1.txt.Aver", y, z, k)</span></span><br><span class="line">readfile(<span class="string">"./IMR90/hg38.fa.out.repeat.LINE.sites.Methy.1.txt.Aver"</span>, y, z, k) </span><br><span class="line">readfile(<span class="string">"./IMR90/hg38.fa.out.repeat.SINE.sites.Methy.1.txt.Aver"</span>, y, z, k) </span><br><span class="line">readfile(<span class="string">"./IMR90/hg38.fa.out.repeat.LTR.sites.Methy.1.txt.Aver"</span>, y, z, k)</span><br><span class="line">readfile(<span class="string">"./IMR90/hg38.fa.out.repeat.Others.sites.Methy.1.txt.Aver"</span>, y, z, k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename=<span class="string">"./IMR90/ASM.distri.TE.Sites.heatmap"</span></span><br><span class="line">filename2=filename + <span class="string">".pdf"</span></span><br><span class="line">pdf = PdfPages(filename2)</span><br><span class="line">xlabels=[]</span><br><span class="line"><span class="comment">#ylabels=['PolII', 'h3k4me3', 'h3k27ac', 'h3k27me3', 'h3k36me3', 'h3k4me1', 'h3k9me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k4me3', 'h3k27ac','h3k4me1', 'h3k36me3', 'h3k27me3',  'h3k9me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k27ac', 'h3k4me3', 'h3k9ac' ,  'h34me1' , 'h3k36me3', 'h3k9me3', 'h3k27me3' ]</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k27ac', 'PolII', 'h3k4me3',  'h3k4me1' , 'h3k36me3', 'h3k9me3', 'h3k27me3' ]</span></span><br><span class="line"><span class="comment">#ylabels=[ 'CTCF_UT-A', 'H3K27me3_none','H3K9me3_stanford', 'CTCF_stanford', 'H3K4me1_stanford',  'H3K27ac_stanford', 'H3K4me3_UW_peaks']</span></span><br><span class="line">ylabels=[ <span class="string">'LINE'</span>, <span class="string">'SINE'</span>, <span class="string">'LTR'</span>, <span class="string">'Others'</span>]</span><br><span class="line"><span class="comment">#ylabels=['H3K4me3' , 'H3K27ac', 'PolII', 'H3K4me1', 'H3K9me3' , 'H3K36me3', 'H3K27me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'H3K4me3' ,'H3K27ac', 'H3K9ac', 'H3K4me1', 'H3K27me3', 'H3K9me3', 'H3K36me3']</span></span><br><span class="line">title=<span class="string">"ASM distribution"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_heatmap</span><span class="params">(data,title, xlabels,ylabels)</span>:</span></span><br><span class="line">    <span class="comment">#cmap=cm.Blues    </span></span><br><span class="line">    cmap=cm.get_cmap(<span class="string">'RdYlBu_r'</span>)</span><br><span class="line">    figure=plt.figure(facecolor=<span class="string">'w'</span>)</span><br><span class="line">    ax=figure.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,position=[<span class="number">0.1</span>,<span class="number">0.15</span>,<span class="number">0.8</span>,<span class="number">0.8</span>])</span><br><span class="line">    ax.set_yticks(range(len(ylabels)))</span><br><span class="line">    ax.set_yticklabels(ylabels)</span><br><span class="line">    ax.set_xticks(range(len(xlabels)))</span><br><span class="line">    ax.set_xticklabels(xlabels)</span><br><span class="line">    vmax=data[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    vmin=data[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">            <span class="keyword">if</span> j&gt;vmax:</span><br><span class="line">                vmax=j</span><br><span class="line">            <span class="keyword">if</span> j&lt;vmin:</span><br><span class="line">                vmin=j</span><br><span class="line">    map=ax.imshow(data,interpolation=<span class="string">'nearest'</span>,cmap=cmap,aspect=<span class="string">'auto'</span>,vmin=vmin,vmax=vmax)</span><br><span class="line">    cb=plt.colorbar(mappable=map,cax=<span class="keyword">None</span>,ax=<span class="keyword">None</span>,shrink=<span class="number">0.5</span>)</span><br><span class="line">    ax.set_title(title,size=<span class="number">15</span>)</span><br><span class="line">    <span class="comment">#plt.show()</span></span><br><span class="line">    <span class="comment">#plt.savefig(filename3, bbox_inches='tight')</span></span><br><span class="line">    pdf.savefig()</span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line"><span class="comment">#a=np.random.rand(10,10)</span></span><br><span class="line"></span><br><span class="line">draw_heatmap(y,title, xlabels,ylabels) </span><br><span class="line">pdf.close()</span><br></pre></td></tr></table></figure><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p><img src="/2018/12/15/plotHeatmap/PlotHeatmap/heatmap.png" alt="Heatmap"></p>]]></content>
    
    <summary type="html">
    
      visualization, python, heatmap
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="python" scheme="https://zhouqiangwei.github.io/categories/visualization/python/"/>
    
    
      <category term="visualization, python, heatmap" scheme="https://zhouqiangwei.github.io/tags/visualization-python-heatmap/"/>
    
  </entry>
  
  <entry>
    <title>plotHeatmapFromMatrix</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/plotHeatmapFromMatrix/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/plotHeatmapFromMatrix/</id>
    <published>2018-12-15T06:44:46.000Z</published>
    <updated>2019-01-06T07:34:11.914Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on Thu Dec 06 22:07:56 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: qwzhou</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.backends.backend_pdf <span class="keyword">import</span> PdfPages</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cm </span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> axes</span><br><span class="line"></span><br><span class="line">y = []</span><br><span class="line">z = []</span><br><span class="line">k = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readfile</span><span class="params">(filename, y)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> fig:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fig:</span><br><span class="line">            data = line.split()</span><br><span class="line">            y.append(map(float,data[<span class="number">1</span>:]))</span><br><span class="line">            </span><br><span class="line">readfile(<span class="string">"./asmSite.combine.bins500.sort.txt"</span>, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename=<span class="string">"./ASMsite.distri.allSample500bp.heatmap"</span></span><br><span class="line">filename2=filename + <span class="string">".pdf"</span></span><br><span class="line">pdf = PdfPages(filename2)</span><br><span class="line">xlabels=[<span class="string">'GM12878'</span>, <span class="string">'IMR90'</span>, <span class="string">'A549'</span>, <span class="string">'K562'</span>, <span class="string">'HUES64'</span>, <span class="string">'HepG2'</span>]</span><br><span class="line"><span class="comment">#ylabels=['PolII', 'h3k4me3', 'h3k27ac', 'h3k27me3', 'h3k36me3', 'h3k4me1', 'h3k9me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k4me3', 'h3k27ac','h3k4me1', 'h3k36me3', 'h3k27me3',  'h3k9me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k27ac', 'h3k4me3', 'h3k9ac' ,  'h34me1' , 'h3k36me3', 'h3k9me3', 'h3k27me3' ]</span></span><br><span class="line"><span class="comment">#ylabels=[ 'h3k27ac', 'PolII', 'h3k4me3',  'h3k4me1' , 'h3k36me3', 'h3k9me3', 'h3k27me3' ]</span></span><br><span class="line"><span class="comment">#ylabels=[ 'CTCF_UT-A', 'H3K27me3_none','H3K9me3_stanford', 'CTCF_stanford', 'H3K4me1_stanford',  'H3K27ac_stanford', 'H3K4me3_UW_peaks']</span></span><br><span class="line">ylabels=[]</span><br><span class="line"><span class="comment">#ylabels=['H3K4me3' , 'H3K27ac', 'PolII', 'H3K4me1', 'H3K9me3' , 'H3K36me3', 'H3K27me3']</span></span><br><span class="line"><span class="comment">#ylabels=[ 'H3K4me3' ,'H3K27ac', 'H3K9ac', 'H3K4me1', 'H3K27me3', 'H3K9me3', 'H3K36me3']</span></span><br><span class="line">title=<span class="string">"ASM overlap between samples"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_heatmap</span><span class="params">(data,title, xlabels,ylabels)</span>:</span></span><br><span class="line">    cmap=cm.Reds    </span><br><span class="line">    <span class="comment">#cmap=cm.get_cmap('RdYlBu_r')</span></span><br><span class="line">    figure=plt.figure(facecolor=<span class="string">'w'</span>)</span><br><span class="line">    ax=figure.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,position=[<span class="number">0.1</span>,<span class="number">0.15</span>,<span class="number">0.8</span>,<span class="number">0.8</span>])</span><br><span class="line">    ax.set_yticks(range(len(ylabels)))</span><br><span class="line">    ax.set_yticklabels(ylabels)</span><br><span class="line">    ax.set_xticks(range(len(xlabels)))</span><br><span class="line">    ax.set_xticklabels(xlabels)</span><br><span class="line">    vmax=data[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    vmin=data[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">            <span class="keyword">if</span> j&gt;vmax:</span><br><span class="line">                vmax=j</span><br><span class="line">            <span class="keyword">if</span> j&lt;vmin:</span><br><span class="line">                vmin=j</span><br><span class="line">    map=ax.imshow(data,interpolation=<span class="string">'nearest'</span>,cmap=cmap,aspect=<span class="string">'auto'</span>,vmin=vmin,vmax=vmax<span class="number">-110</span>)</span><br><span class="line">    cb=plt.colorbar(mappable=map,cax=<span class="keyword">None</span>,ax=<span class="keyword">None</span>,shrink=<span class="number">0.5</span>)</span><br><span class="line">    ax.set_title(title,size=<span class="number">15</span>)</span><br><span class="line">    <span class="comment">#plt.show()</span></span><br><span class="line">    <span class="comment">#plt.savefig(filename3, bbox_inches='tight')</span></span><br><span class="line">    pdf.savefig()</span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line"><span class="comment">#a=np.random.rand(10,10)</span></span><br><span class="line"></span><br><span class="line">draw_heatmap(y,title, xlabels,ylabels) </span><br><span class="line">pdf.close()</span><br></pre></td></tr></table></figure><h3 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h3><p><img src="/2018/12/15/plotHeatmapFromMatrix/heatmap.png" alt="Heatmap"></p>]]></content>
    
    <summary type="html">
    
      visualization, python, heatmap
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="python" scheme="https://zhouqiangwei.github.io/categories/visualization/python/"/>
    
    
      <category term="visualization, python, heatmap" scheme="https://zhouqiangwei.github.io/tags/visualization-python-heatmap/"/>
    
  </entry>
  
  <entry>
    <title>check_install_Rpkg</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/check-install-Rpkg/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/check-install-Rpkg/</id>
    <published>2018-12-15T06:42:34.000Z</published>
    <updated>2019-01-06T07:34:11.909Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check if necessary libraries are installed </span></span><br><span class="line">check_pkg &lt;- <span class="keyword">function</span>(pkg) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">    print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is loaded correctly"</span>, sep = <span class="string">" "</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    print(paste(<span class="string">"Trying to install package"</span>, pkg, sep = <span class="string">" "</span>))</span><br><span class="line">    install.packages(pkg, repos=<span class="string">"http://cran.us.r-project.org"</span>, dep = <span class="literal">TRUE</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">      print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is installed and loaded correctly"</span>, sep = <span class="string">""</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      install.packages(pkg, repos=<span class="string">"http://cran.rstudio.com/"</span>, dep = <span class="literal">TRUE</span>)</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">        print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is installed and loaded correctly"</span>, sep = <span class="string">""</span>))</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">stop</span>(paste(<span class="string">"Couldn't install package"</span>, pkg, sep = <span class="string">" "</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">check_pkg(<span class="string">"xtable"</span>)</span><br><span class="line"><span class="comment">#check_pkg("RCircos")</span></span><br><span class="line"><span class="comment">#check_pkg("grid")</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      check if necessary libraries are installed
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/R/"/>
    
    
      <category term="bioinformatics, R, install package" scheme="https://zhouqiangwei.github.io/tags/bioinformatics-R-install-package/"/>
    
  </entry>
  
  <entry>
    <title>bionorm_R</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/bionorm-R/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/bionorm-R/</id>
    <published>2018-12-15T06:39:47.000Z</published>
    <updated>2019-01-06T07:34:11.908Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##bion</span></span><br><span class="line">norm.test&lt;- <span class="keyword">function</span>(input.data,alpha=<span class="number">0.05</span>,pic=<span class="literal">TRUE</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(pic==<span class="literal">TRUE</span>)&#123;<span class="comment">#画图形</span></span><br><span class="line">    dev.new()</span><br><span class="line">    par(mfrow=c(<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line">    qqnorm(input.data,main=<span class="string">"qq图"</span>)</span><br><span class="line">    qqline(input.data)</span><br><span class="line">    hist(input.data,frep=<span class="literal">F</span>,main=<span class="string">"直方图和密度估计曲线"</span>)</span><br><span class="line">    lines(density(input.data),col=<span class="string">"blue"</span>) <span class="comment">#密度估计曲线</span></span><br><span class="line">    x&lt;- c(round(min(input.data)):round(max(input.data)))</span><br><span class="line">    lines(x,dnorm(x,mean(input.data),sd(input.data)),col=<span class="string">"red"</span>) <span class="comment">#正态分布曲线</span></span><br><span class="line">  &#125;</span><br><span class="line">  sol&lt;- shapiro.test(input.data)</span><br><span class="line">  <span class="keyword">if</span>(sol$p.value&gt;alpha)&#123;</span><br><span class="line">    print(paste(<span class="string">"success:服从正态分布,p.value="</span>,sol$p.value,<span class="string">"&gt;"</span>,alpha))    </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    print(paste(<span class="string">"error:不服从正态分布,p.value="</span>,sol$p.value,<span class="string">"&lt;="</span>,alpha))</span><br><span class="line">  &#125;</span><br><span class="line">  sol</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      bionorm funcition in R
    
    </summary>
    
      <category term="bioinfromatics" scheme="https://zhouqiangwei.github.io/categories/bioinfromatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/bioinfromatics/R/"/>
    
    
      <category term="R" scheme="https://zhouqiangwei.github.io/tags/R/"/>
    
      <category term="bioinfromatics" scheme="https://zhouqiangwei.github.io/tags/bioinfromatics/"/>
    
      <category term="bionorm funcition" scheme="https://zhouqiangwei.github.io/tags/bionorm-funcition/"/>
    
  </entry>
  
  <entry>
    <title>EdgeR</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/EdgeR/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/EdgeR/</id>
    <published>2018-12-15T06:37:14.000Z</published>
    <updated>2019-01-06T07:34:11.904Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(edgeR)</span><br><span class="line"></span><br><span class="line">a&lt;-read.table(<span class="string">"C:/Users/qwzhou/Desktop/code/A549/A549.Allgenecount"</span>,</span><br><span class="line">              sep=<span class="string">"\t"</span>, col.names = c(<span class="string">"gene_id"</span>,<span class="string">"control"</span>))</span><br><span class="line">b&lt;-read.table(<span class="string">"C:/Users/qwzhou/Desktop/code/IMR90/Imr90.Allgenecount"</span>,</span><br><span class="line">              sep=<span class="string">"\t"</span>, col.names = c(<span class="string">"gene_id"</span>,<span class="string">"control"</span>))</span><br><span class="line"></span><br><span class="line">raw_count &lt;- merge(a, b, by=<span class="string">"gene_id"</span>)</span><br><span class="line"><span class="comment">#remove the last five line</span></span><br><span class="line"><span class="comment">#raw_count_filt &lt;- raw_count[-1:-5,]</span></span><br><span class="line">raw_count_filt&lt;- raw_count[,<span class="number">2</span>:<span class="number">3</span>]</span><br><span class="line">rownames(raw_count_filt) &lt;-raw_count$gene_id </span><br><span class="line"><span class="comment">## remove other sig</span></span><br><span class="line"><span class="comment">#ENSEMBL &lt;- gsub("(.*?)\\.\\d*?_\\d", "\\1", raw_count_filt$gene_id)</span></span><br><span class="line"><span class="comment">#row.names(raw_count_filt) &lt;- ENSEMBL</span></span><br><span class="line"></span><br><span class="line">group &lt;- factor(c(<span class="string">"A549"</span>,<span class="string">"IMR90"</span>))</span><br><span class="line">genelist &lt;- DGEList(counts=raw_count_filt[,<span class="number">1</span>:<span class="number">2</span>], group = group)</span><br><span class="line"></span><br><span class="line">bcv = <span class="number">0.1</span></span><br><span class="line">et &lt;- exactTest(genelist, dispersion=bcv^<span class="number">2</span>)</span><br><span class="line">results = et$table</span><br><span class="line">write.table(results, file=<span class="string">"C:/Users/qwzhou/Desktop/code/A549andIMR90.DEG.txt"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;figure class=&quot;highlight r&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
      
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/R/"/>
    
    
      <category term="bioinformatics, edgeR" scheme="https://zhouqiangwei.github.io/tags/bioinformatics-edgeR/"/>
    
  </entry>
  
  <entry>
    <title>BisRNA</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/BisRNA/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/BisRNA/</id>
    <published>2018-12-15T06:34:28.000Z</published>
    <updated>2019-01-06T07:34:11.903Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line">biocLite(<span class="string">"BisRNA"</span>)</span><br><span class="line"><span class="keyword">library</span>(BisRNA)</span><br><span class="line"></span><br><span class="line">data(Bisdata,package=<span class="string">"BisRNA"</span>)</span><br><span class="line">lambda1 &lt;- RNAmeth.poisson.par(Bisdata1)$estimate</span><br><span class="line">BisXP1 &lt;- RNAmeth.poisson.test(Bisdata1,lambda1,method=<span class="string">"BH"</span>)</span><br><span class="line"></span><br><span class="line">a&lt;-read.table(<span class="string">"C:\\Users\\qwzhou\\Desktop\\zhouchao\\m6A.bed"</span>)</span><br><span class="line"></span><br><span class="line">names(a)=c(<span class="string">"RNA"</span>, <span class="string">"Cpos"</span>, <span class="string">"coverage"</span>, <span class="string">"ncratio"</span>)</span><br><span class="line"></span><br><span class="line">lambda1 &lt;- RNAmeth.poisson.par(a)$estimate</span><br><span class="line"></span><br><span class="line">BisXP1 &lt;- RNAmeth.poisson.test(a,lambda1,method=<span class="string">"BH"</span>)</span><br><span class="line"></span><br><span class="line">BisXP1.df &lt;- data.frame(BisXP1$nonconv.ratio, BisXP1$pv.adj, row.names=BisXP1$RNA.pos)</span><br><span class="line"></span><br><span class="line">write.table(BisXP1.df,file=<span class="string">"C:\\Users\\qwzhou\\Desktop\\zhouchao\\m6A.bed.txt"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data&lt;-read.table(<span class="string">"C:\\Users\\qwzhou\\Desktop\\bt2new\\Methyl450withallaligner.txt"</span>, sep=<span class="string">"\t"</span>, header=<span class="literal">T</span>)</span><br><span class="line">mydata &lt;- data[, c(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>)]</span><br><span class="line"><span class="keyword">library</span>(PerformanceAnalytics)</span><br><span class="line">chart.Correlation(mydata, histogram=<span class="literal">TRUE</span>, type=<span class="string">"l"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      BisRNA package
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="DNA methylation" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/DNA-methylation/"/>
    
    
      <category term="bioinformatics, bisulfite" scheme="https://zhouqiangwei.github.io/tags/bioinformatics-bisulfite/"/>
    
  </entry>
  
  <entry>
    <title>ggplot_basic_plot</title>
    <link href="https://zhouqiangwei.github.io/2018/12/15/ggplot-basic-plot/"/>
    <id>https://zhouqiangwei.github.io/2018/12/15/ggplot-basic-plot/</id>
    <published>2018-12-15T06:27:37.000Z</published>
    <updated>2019-01-06T07:34:11.909Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">a&lt;-read.table(<span class="string">"C:/Users/qwzhou/Desktop/code/A549/A549.haplen.statis.txt"</span>,</span><br><span class="line">              sep=<span class="string">"\t"</span>, col.names = c(<span class="string">"group"</span>,<span class="string">"len"</span>,<span class="string">"number"</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a&lt;-read.table(<span class="string">"C:/Users/qwzhou/Desktop/code/IMR90/repeat.length"</span>,</span><br><span class="line">              sep=<span class="string">" "</span>, col.names = c(<span class="string">"len"</span>,<span class="string">"group"</span>))</span><br><span class="line"></span><br><span class="line">p &lt;- ggplot(a, aes(x=group, y=len,color=group,group=group)) +geom_boxplot() +ylim(<span class="number">0</span>,<span class="number">2000</span>)</span><br><span class="line">p +labs(title=<span class="string">""</span>,x=<span class="string">""</span>, y = <span class="string">"Length"</span>)+</span><br><span class="line">  theme_bw() + <span class="comment">## 背景</span></span><br><span class="line">  theme(panel.grid =element_blank()) + <span class="comment">## 删去网格线</span></span><br><span class="line">  theme(plot.title = element_text(hjust = <span class="number">0.5</span>, size = <span class="number">18</span>, colour = <span class="string">"black"</span>, face = <span class="string">"bold"</span>) ,axis.title.y = </span><br><span class="line">          element_text(size=<span class="number">16</span>,colour = <span class="string">"black"</span>,face = <span class="string">"bold"</span>), </span><br><span class="line">        axis.text.y = element_text(size=<span class="number">10</span>, colour = <span class="string">"black"</span>), </span><br><span class="line">        axis.text.x = element_text(size=<span class="number">16</span>, colour = <span class="string">"black"</span>), legend.position = c(<span class="number">0.85</span>,<span class="number">0.75</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## line plot</span></span><br><span class="line">profile_text &lt;- read.table(<span class="string">"C:/Users/qwzhou/Desktop/code/phaseddensity.chr1.txt"</span>, header=<span class="literal">T</span>, row.names=<span class="number">1</span>, quote=<span class="string">""</span>)</span><br><span class="line"><span class="comment">#head(profile_text)</span></span><br><span class="line"><span class="comment">#Meth.SNP SNP Meth.SNP.SNP. </span></span><br><span class="line"><span class="comment">#10000       10             3   3</span></span><br><span class="line"><span class="comment">#10001       34            28  30</span></span><br><span class="line"><span class="comment">#10002       36            21  19</span></span><br><span class="line"><span class="comment">#10003       22            20  17</span></span><br><span class="line"><span class="comment">#10004       52            36  40</span></span><br><span class="line"><span class="comment">#10005       27            18   1</span></span><br><span class="line"><span class="keyword">library</span>(reshape2)</span><br><span class="line">profile_text$xvariable = rownames(profile_text)</span><br><span class="line">data_m &lt;- melt(profile_text, id.vars=c(<span class="string">"xvariable"</span>))</span><br><span class="line">data_m$xvariable &lt;- as.numeric(data_m$xvariable)</span><br><span class="line"></span><br><span class="line">p &lt;- ggplot(data_m, aes(x=xvariable, y=value,color=variable,group=variable)) +geom_point() +ylim(<span class="number">0</span>,<span class="number">100</span>)<span class="comment">#+ stat_smooth(method="auto", se=FALSE) + theme(legend.position=c(0.85,0.2))</span></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line">data_m$value &lt;- pmin(data_m$value,<span class="number">100</span>)</span><br><span class="line">p &lt;- ggplot(data_m, aes(x=variable, y=value,color=variable,group=variable)) +geom_boxplot()</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line">p &lt;- ggplot(data_m, aes(x=xvariable, y=value,color=variable,group=variable)) + stat_smooth(method=<span class="string">"auto"</span>, se=<span class="literal">FALSE</span>)</span><br><span class="line">p +labs(title=<span class="string">""</span>,x=<span class="string">""</span>, y = <span class="string">"Phased number"</span>)+</span><br><span class="line">  theme_bw() + <span class="comment">## 背景</span></span><br><span class="line">  theme(panel.grid =element_blank()) + <span class="comment">## 删去网格线</span></span><br><span class="line">  theme(plot.title = element_text(hjust = <span class="number">0.5</span>, size = <span class="number">18</span>, colour = <span class="string">"black"</span>, face = <span class="string">"bold"</span>) ,axis.title.y = </span><br><span class="line">          element_text(size=<span class="number">16</span>,colour = <span class="string">"black"</span>,face = <span class="string">"bold"</span>), </span><br><span class="line">        axis.text.y = element_text(size=<span class="number">10</span>, colour = <span class="string">"black"</span>), </span><br><span class="line">        axis.text.x = element_text(size=<span class="number">16</span>, colour = <span class="string">"black"</span>), legend.position = c(<span class="number">0.85</span>,<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### bar plot</span></span><br><span class="line">b&lt;-a[a$len!=<span class="string">"L0"</span>,]</span><br><span class="line">b$len&lt;-factor(b$len,levels=c(<span class="string">"L500"</span>, <span class="string">"L1000"</span>, <span class="string">"L2000"</span>)) </span><br><span class="line"></span><br><span class="line">g &lt;- ggplot(data=b, aes(x=len, y=number, fill=group)) </span><br><span class="line">g + geom_bar(stat=<span class="string">"identity"</span>, position=position_dodge()) +</span><br><span class="line">  scale_fill_manual(values=c(<span class="string">"#999999"</span>, <span class="string">"#009E73"</span>, <span class="string">"#D55E00"</span>))+</span><br><span class="line">  labs(title=<span class="string">"Haplotype length"</span>,x=<span class="string">""</span>, y = <span class="string">"Number"</span>)+</span><br><span class="line">  theme_bw() + <span class="comment">## 背景</span></span><br><span class="line">  theme(panel.grid =element_blank()) + <span class="comment">## 删去网格线</span></span><br><span class="line">  theme(plot.title = element_text(hjust = <span class="number">0.5</span>, size = <span class="number">18</span>, colour = <span class="string">"black"</span>, face = <span class="string">"bold"</span>) ,axis.title.y = </span><br><span class="line">          element_text(size=<span class="number">16</span>,colour = <span class="string">"black"</span>,face = <span class="string">"bold"</span>), </span><br><span class="line">        axis.text.y = element_text(size=<span class="number">10</span>, colour = <span class="string">"black"</span>), </span><br><span class="line">        axis.text.x = element_text(size=<span class="number">16</span>, colour = <span class="string">"black"</span>), legend.position = c(<span class="number">0.8</span>,<span class="number">0.8</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### densityplot</span></span><br><span class="line">ggplot(a,aes(x=pmin(a$len,<span class="number">1000</span>),group=factor(group),colour=factor(group)))+</span><br><span class="line">  geom_density()</span><br><span class="line"></span><br><span class="line"><span class="comment">###boxplot</span></span><br><span class="line">p&lt;-ggplot(a, aes(x=group, y=len, color=group)) + geom_boxplot() + ylim(<span class="number">0</span>,<span class="number">1000</span>) + </span><br><span class="line">  scale_color_manual(values=c(<span class="string">"#999999"</span>, <span class="string">"#E69F00"</span>, <span class="string">"#56B4E9"</span>)) </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">p+ labs(title=<span class="string">"Haplotype length"</span>,x=<span class="string">""</span>, y = <span class="string">"Length"</span>) +</span><br><span class="line">  theme_bw() + <span class="comment">## 背景</span></span><br><span class="line">  theme(panel.grid =element_blank()) + <span class="comment">## 删去网格线</span></span><br><span class="line">  theme(panel.border = element_blank()) +   <span class="comment">## 删去外层边框</span></span><br><span class="line">  theme(axis.line = element_line(size=<span class="number">0.5</span>, colour = <span class="string">"black"</span>)) + <span class="comment">## 再加上坐标轴（无刻度、无标签）</span></span><br><span class="line">  theme(plot.title = element_text(hjust = <span class="number">0.5</span>, size = <span class="number">18</span>, colour = <span class="string">"black"</span>, face = <span class="string">"bold"</span>) ,axis.title.y = </span><br><span class="line">           element_text(size=<span class="number">16</span>,colour = <span class="string">"black"</span>,face = <span class="string">"bold"</span>), </span><br><span class="line">         axis.text.y = element_text(size=<span class="number">10</span>, colour = <span class="string">"black"</span>), </span><br><span class="line">          axis.text.x = element_text(size=<span class="number">16</span>, colour = <span class="string">"black"</span>), legend.position=<span class="string">'none'</span>) </span><br><span class="line"> <span class="comment">## face取值：plain普通，bold加粗，italic斜体，bold.italic斜体加粗</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#theme(axis.text = element_blank()) +   ## 删去刻度标签</span></span><br><span class="line"><span class="comment">#theme(axis.ticks = element_blank()) +   ## 删去刻度线</span></span><br><span class="line">  <span class="comment">#geom_dotplot(binaxis='y', stackdir='center', stackratio=0.1, dotsize=0.1)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      R ggplot basic plot, such as barplot line density boxplot
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/visualization/R/"/>
    
    
      <category term="R, ggplot, visualization" scheme="https://zhouqiangwei.github.io/tags/R-ggplot-visualization/"/>
    
  </entry>
  
  <entry>
    <title>mac_usage</title>
    <link href="https://zhouqiangwei.github.io/2018/10/06/mac-usage/"/>
    <id>https://zhouqiangwei.github.io/2018/10/06/mac-usage/</id>
    <published>2018-10-06T10:26:28.000Z</published>
    <updated>2019-01-06T07:34:11.912Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h1><h2 id="【Mac】invalid-active-developer-path-Library-Developer-CommandLineTools-missing-xcrun-at-Library"><a href="#【Mac】invalid-active-developer-path-Library-Developer-CommandLineTools-missing-xcrun-at-Library" class="headerlink" title="【Mac】invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library"></a>【Mac】invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library</h2><p>解决办法： xcode-select –install</p>]]></content>
    
    <summary type="html">
    
      macbook usage and error
    
    </summary>
    
      <category term="macbook" scheme="https://zhouqiangwei.github.io/categories/macbook/"/>
    
    
      <category term="macbook" scheme="https://zhouqiangwei.github.io/tags/macbook/"/>
    
  </entry>
  
  <entry>
    <title>CppUseEffective</title>
    <link href="https://zhouqiangwei.github.io/2018/08/06/CppUseEffective/"/>
    <id>https://zhouqiangwei.github.io/2018/08/06/CppUseEffective/</id>
    <published>2018-08-06T07:14:42.000Z</published>
    <updated>2019-01-06T07:34:11.903Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1-C-遇到的问题"><a href="#1-C-遇到的问题" class="headerlink" title="1. C++ 遇到的问题"></a>1. C++ 遇到的问题</h2><h3 id="1-1-字符串频繁变动内容不要用-string"><a href="#1-1-字符串频繁变动内容不要用-string" class="headerlink" title="1.1 字符串频繁变动内容不要用 string"></a>1.1 字符串频繁变动内容不要用 string</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">std::string map_seq=<span class="string">""</span>; //too slow <span class="keyword">for</span> map_seq = map_seq + <span class="string">'N'</span></span><br><span class="line">       bool valid=<span class="literal">false</span>;int index=0;</span><br><span class="line">       <span class="keyword">while</span> (m&lt;cLen)&#123;</span><br><span class="line">               <span class="keyword">if</span>(reds_loci.size()&gt;1)&#123;</span><br><span class="line">                       <span class="keyword">if</span> (m &gt;= rstart &amp;&amp;  m &lt; rend-redlen)&#123;</span><br><span class="line">                               <span class="keyword">if</span>(distance&gt;=low_bound &amp;&amp; distance &lt;= up_bound)&#123;</span><br><span class="line">                                       map_seq = map_seq + seq[m];</span><br><span class="line">                                       index++;</span><br><span class="line">                                       valid=<span class="literal">true</span>;</span><br><span class="line">                               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                       map_seq = map_seq +<span class="string">'N'</span>; //<span class="string">'-'</span></span><br><span class="line">                                       index++;</span><br><span class="line">                                       valid=<span class="literal">false</span>;</span><br><span class="line">                               &#125;</span><br><span class="line">                               ....</span><br><span class="line">                         .....</span><br><span class="line">                 .....</span><br><span class="line">                 m++;</span><br><span class="line">       &#125;</span><br><span class="line">       map_seq[cLen]=<span class="string">'\0'</span>;</span><br></pre></td></tr></table></figure><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>程序中循环cLen（大约几千万到几个亿），每个位置需要在字符串map_string后面添加一个字符，导致string频繁变动内容以及长度，运行非常之慢。</p><h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><p>将string修改为char*，按照cLen长度进行初始化字符串长度，因此每个位置赋值，并不会引起变化。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* map_seq = <span class="keyword">new</span> <span class="keyword">char</span>[cLen+<span class="number">1</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(map_seq, <span class="string">"None"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\nProcess the genome with restriction enzyme digestion sites number: %d, genomeLen: %d"</span>, reds_loci.size(), cLen);</span><br><span class="line"><span class="keyword">unsigned</span> m=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> rstart=<span class="number">0</span>;<span class="keyword">int</span> rend=<span class="number">0</span>;<span class="keyword">int</span> distance=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(reds_loci.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">        rstart=reds_loci[<span class="number">0</span>];</span><br><span class="line">        rend=reds_loci[<span class="number">1</span>]+redlen;</span><br><span class="line">        distance=rend-rstart;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> valid=<span class="literal">false</span>;<span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (m&lt;cLen)&#123;</span><br><span class="line">        <span class="keyword">if</span>(reds_loci.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (m &gt;= rstart &amp;&amp;  m &lt; rend-redlen)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(distance&gt;=low_bound &amp;&amp; distance &lt;= up_bound)&#123;</span><br><span class="line">                                map_seq[index] = seq[m];</span><br><span class="line">                                index++;</span><br><span class="line">                                valid=<span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                map_seq[index] = <span class="string">'N'</span>; <span class="comment">//'-'</span></span><br><span class="line">                                index++;</span><br><span class="line">                                valid=<span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(m&lt;rstart)&#123;</span><br><span class="line">                                m++;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(m &lt; rend &amp;&amp; valid)&#123;</span><br><span class="line">                                map_seq[index] = seq[m];</span><br><span class="line">                                index++;</span><br><span class="line">                                m++; <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> m--;</span><br><span class="line">                        reds_loci.pop_front();</span><br><span class="line">                        <span class="keyword">if</span>(reds_loci.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                                rstart=reds_loci[<span class="number">0</span>];</span><br><span class="line">                                rend=reds_loci[<span class="number">1</span>]+redlen;</span><br><span class="line">                                distance=rend-rstart;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        m++;</span><br><span class="line">&#125;</span><br><span class="line">map_seq[cLen]=<span class="string">'\0'</span>;</span><br></pre></td></tr></table></figure><h3 id="1-2-what-std-bad-alloc"><a href="#1-2-what-std-bad-alloc" class="headerlink" title="1.2 what():  std::bad_alloc"></a>1.2 what():  std::bad_alloc</h3><h4 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h4><p>terminate called after throwing an instance of ‘std::bad_alloc’</p><p>what():  std::bad_alloc</p><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><p>可能原因：</p><ol><li>malloc 申请内存，但系统内存不足。</li><li>vector需要申请的内存，必须要连续的内存地址，例如我们需要申请200M大小的vector，但是没有连续200M的空间，尽管我们还是有较大的非连续的空间，也是不行的。</li><li>检查是否有频繁的申请内存但是没有释放，或者释放错误。</li><li>……</li></ol><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>如果是因为你必须申请一块较大的内存，例如我需要申请10G左右的内存来存储vector，当然我也不知道当时为什么没有用数组存储，总之这种情况不是因为频繁调用以及异常申请释放等问题，而且自己目前也不想去修改代码（懒…），那只能确保服务器内存足够的情况下提交程序。<br>总之，针对这个问题需要根据自己的代码以及程序要做的问题来解决，一般比较容易解决。</p><p>BWT：检查过自己的程序，不是vector确实是new申请的数组需要较大内存。我对内存一直处于晕乎状态，如果有什么不对的，非常希望指正。</p><p>在论坛看到一个答复如下：</p><p>容量大小从小到大：栈≤全局数据≤堆≤文件≤硬盘≤磁盘阵列≤云存储 当程序需要使用比如2GB～1TB左右的存储时，最简单的办法恐怕得是用文件读写模拟内存读写了吧。windows参考_fseeki64函数，linux参考fseeko64函数。 </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FILE *fA;fA=fopen(<span class="string">"A"</span>,<span class="string">"rb+"</span>);_fseeki64(fA,<span class="number">10000000000</span>i64*<span class="keyword">sizeof</span>(<span class="keyword">int</span>),SEEK_SET);fputc(fA,<span class="number">0</span>);<span class="comment">//int A[10000000000];</span></span><br><span class="line"><span class="keyword">int</span> B;</span><br><span class="line">_fseeki64(fA,<span class="number">9999999999</span>i64*<span class="keyword">sizeof</span>(<span class="keyword">int</span>),SEEK_SET);fread(&amp;B,<span class="number">1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>),fA);<span class="comment">//B=A[9999999999];</span></span><br><span class="line">_fseeki64(fA,<span class="number">9999999999</span>i64*<span class="keyword">sizeof</span>(<span class="keyword">int</span>),SEEK_SET);fwrite(&amp;B,<span class="number">1</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>),fA);<span class="comment">//A[9999999999]=B;</span></span><br><span class="line">fclose(fA);</span><br></pre></td></tr></table></figure><p>没测试过可行性以及运行效率，大家有时间可以测试一下，欢迎回复测试结果，或提供其他办法。</p><p><a href="https://bbs.csdn.net/topics/392179626" target="_blank" rel="noopener">参考</a></p><h2 id="2-C-信息"><a href="#2-C-信息" class="headerlink" title="2. C++ 信息"></a>2. C++ 信息</h2><h3 id="2-1-a-o-so"><a href="#2-1-a-o-so" class="headerlink" title="2.1 .a .o .so"></a>2.1 .a .o .so</h3><p>在Linux上创建静态库.a和动态库.so</p><p>我们通常把一些公用函数制作成函数库,供其它程序使用.<br>函数库分为静态库和共享库两种:<br>1.静态函数库<br>这类库的名字一般是libxxx.a.<br>利用静态函数库编译成的文件比较大,因为整个函数库的所有数据都会被整合进目标代码中.<br>优点就显而易见了,即编译后的执行程序不需要外部的函数库支持,因为所有使用的函数都已经被编译进去了.<br>当然这也会成为缺点,如果静态函数库改变了,那么你的程序必须重新编译.<br>比如PHP的configure参数–enable-mbstring=static(默认),<br>生成的mbstring.a被静态链接到二进制程序php,php-fpm,php-cgi,libphp.so中.<br>2.共享函数库<br>这类库的名字一般是libxxx.so.<br>相对于静态函数库,共享函数库在编译的时候 并没有被编译进目标代码中.<br>当程序执行到相关函数时才调用共享函数库里相应的函数,因此共享函数库所产生的可执行文件比较小.<br>由于共享函数库没有被整合进你的程序,而是在程序运行时动态地申请并调用,所以程序的运行环境中必须提供相应的库.<br>共享函数库的改变并不影响你的程序,所以共享函数库的升级比较方便.<br>比如PHP的configure参数–enable-mbstring=shared,生成的mbstring.so就是共享库.<br>另外用phpize生成PECL扩展库的configure文件,然后make编译,生成的也是共享库.</p><p>–enable-static 生成静态库a文件<br>–enable-shared 生成共享库so文件</p><p>用ar打包.o文件(obj对象文件,目标文件)生成.a共享库:<br>ar -r libname.a name.o<br>ar -t libname.a 可见 name.o</p><p><a href="https://segmentfault.com/q/1010000005269977" target="_blank" rel="noopener">参考链接</a></p>]]></content>
    
    <summary type="html">
    
      使用c++过程中碰到的问题和解决办法以及资源和程序
    
    </summary>
    
      <category term="language" scheme="https://zhouqiangwei.github.io/categories/language/"/>
    
      <category term="c++" scheme="https://zhouqiangwei.github.io/categories/language/c/"/>
    
    
      <category term="c++" scheme="https://zhouqiangwei.github.io/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>CorrelationR</title>
    <link href="https://zhouqiangwei.github.io/2018/08/01/CorrelationR/"/>
    <id>https://zhouqiangwei.github.io/2018/08/01/CorrelationR/</id>
    <published>2018-08-01T12:10:15.000Z</published>
    <updated>2019-01-06T07:34:11.903Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data&lt;-read.table(<span class="string">"C:\\data.txt"</span>)</span><br><span class="line"><span class="comment">##data&lt;-read.table("C:\\Users\\qwzhou\\Desktop\\bt2new\\Methyl450withallaligner.txt", sep="\t", header=T)</span></span><br><span class="line"><span class="comment">##提取数据列</span></span><br><span class="line">mydata &lt;- data[, c(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>)]</span><br></pre></td></tr></table></figure><h3 id="计算相关系数"><a href="#计算相关系数" class="headerlink" title="计算相关系数"></a>计算相关系数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res &lt;- cor(mydata,use=<span class="string">"complete.obs"</span>)</span><br></pre></td></tr></table></figure><h3 id="相关系数以及pvalue"><a href="#相关系数以及pvalue" class="headerlink" title="相关系数以及pvalue"></a>相关系数以及pvalue</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## cor只能计算相关系数，加载library(Hmisc)包，计算相关系数以及pvalue</span></span><br><span class="line"><span class="comment">## source("http://bioconductor.org/biocLite.R")</span></span><br><span class="line"><span class="comment">## biocLite("Hmisc")</span></span><br><span class="line"><span class="comment">## biocLite("backports")</span></span><br><span class="line"><span class="keyword">library</span>(Hmisc)</span><br><span class="line">res2&lt;-rcorr(as.matrix(mydata))</span><br></pre></td></tr></table></figure><h3 id="可视化scatter-plots-（数据大时会特别慢，因为需要作图点多）"><a href="#可视化scatter-plots-（数据大时会特别慢，因为需要作图点多）" class="headerlink" title="可视化scatter plots （数据大时会特别慢，因为需要作图点多）"></a>可视化scatter plots （数据大时会特别慢，因为需要作图点多）</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## biocLite("PerformanceAnalytics")</span></span><br><span class="line"><span class="keyword">library</span>(PerformanceAnalytics)</span><br><span class="line">chart.Correlation(mydata, histogram=<span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h3 id="可视化2-数据量大时show-points-FALSE"><a href="#可视化2-数据量大时show-points-FALSE" class="headerlink" title="可视化2, 数据量大时show.points=FALSE"></a>可视化2, 数据量大时show.points=FALSE</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">biocLite(<span class="string">"psych"</span>)</span><br><span class="line"><span class="keyword">library</span>(psych)</span><br><span class="line">pairs.panels(t, digits = <span class="number">3</span>, scale=<span class="literal">TRUE</span>, show.points=<span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://jamesmarquezportfolio.com/correlation_matrices_in_r.html" target="_blank" rel="noopener">Seven Easy Graphs to Visualize Correlation Matrices in R</a></p>]]></content>
    
    <summary type="html">
    
      计算不同数据列相关系数以及可视化
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/R/"/>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/visualization/R/"/>
    
    
      <category term="相关系数，R，visualization" scheme="https://zhouqiangwei.github.io/tags/%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%EF%BC%8CR%EF%BC%8Cvisualization/"/>
    
  </entry>
  
  <entry>
    <title>韦恩图</title>
    <link href="https://zhouqiangwei.github.io/2018/07/25/%E9%9F%A6%E6%81%A9%E5%9B%BE/"/>
    <id>https://zhouqiangwei.github.io/2018/07/25/韦恩图/</id>
    <published>2018-07-25T07:45:35.000Z</published>
    <updated>2019-01-06T07:34:11.920Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="在线工具："><a href="#在线工具：" class="headerlink" title="在线工具："></a>在线工具：</h2><ol><li><a href="http://bioinformatics.psb.ugent.be/webtools/Venn/" target="_blank" rel="noopener">Calculate and draw custom Venn diagrams</a></li><li><a href="http://bioinfogp.cnb.csic.es/tools/venny/index.html" target="_blank" rel="noopener">Venny 2.1</a></li></ol><h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><ol><li>limma</li><li>gplots</li><li>venneuler</li><li>VennDiagram</li></ol><p><strong>参考资料</strong><br><a href="https://mp.weixin.qq.com/s/wNiBOVPdoFBjQRrfnpoQ6g?" target="_blank" rel="noopener">1</a><br><a href="https://blog.csdn.net/woodcorpse/article/details/77707591" target="_blank" rel="noopener">2</a></p><p>以上方法最多完成五个元素的韦恩图，当超过6个元素时怎么办？<br>这里推荐使用R包：</p><h2 id="UpSetR"><a href="#UpSetR" class="headerlink" title="UpSetR"></a>UpSetR</h2><p><img src="/2018/07/25/韦恩图/upsetr.png" alt="example"></p><p><strong>参考资料</strong><br><a href="http://bigdata.51cto.com/art/201710/554293.htm" target="_blank" rel="noopener">1</a><br><a href="https://www.jianshu.com/p/324aae3d5ea4" target="_blank" rel="noopener">2</a><br><a href="http://www.sohu.com/a/227691490_99971433" target="_blank" rel="noopener">3</a></p><p><strong>注意</strong><br>测试过程中发现五个元素完全没问题，当超过五个元素直接使用upset(data)做图时只显示五个元素。<br>添加参数sets后，可以显示全部元素。或者添加nsets = 6,  因为默认5个可能。</p><p>在fromlist时，我的每个读入文件是一列chr_pos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">biocLite(<span class="string">"UpSetR"</span>)</span><br><span class="line">library(UpSetR)</span><br><span class="line"></span><br><span class="line">a1&lt;-read.table(<span class="string">"A1.txt"</span>)</span><br><span class="line">a2&lt;-read.table(<span class="string">"A2.txt"</span>)</span><br><span class="line">a3&lt;-read.table(<span class="string">"A3.txt"</span>)</span><br><span class="line">......</span><br><span class="line">a6&lt;-read.table(<span class="string">"A6.txt"</span>)</span><br><span class="line"><span class="comment">##每个文件一列数据，可以合并到一起整合为csv，</span></span><br><span class="line"><span class="comment">##data&lt;-read.csv(system.file("extdata", "merge.csv", package="UpSetR"), header=T, sep=",")</span></span><br><span class="line"><span class="comment">##upset(data, ...)</span></span><br><span class="line">listInput &lt;- list(A1 = a1, A2 = a2, A3 = a3, A4 = a4, A5 = a5, A6 = a6) </span><br><span class="line">upset(fromList(listInput), sets =c(<span class="string">"A1"</span>, <span class="string">"A2"</span>, <span class="string">"A3"</span>, <span class="string">"A4"</span>, <span class="string">"A5"</span>, <span class="string">"A6"</span>), order.by =<span class="string">"freq"</span>, empty.intersections =<span class="string">"on"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      绘制韦恩图，尤其是多于五组情况以上时。
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/visualization/R/"/>
    
    
      <category term="韦恩图, R, visualization" scheme="https://zhouqiangwei.github.io/tags/%E9%9F%A6%E6%81%A9%E5%9B%BE-R-visualization/"/>
    
  </entry>
  
  <entry>
    <title>一台电脑配置多个github账户</title>
    <link href="https://zhouqiangwei.github.io/2018/07/20/%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAgithub%E8%B4%A6%E6%88%B7/"/>
    <id>https://zhouqiangwei.github.io/2018/07/20/一台电脑配置多个github账户/</id>
    <published>2018-07-20T08:57:48.000Z</published>
    <updated>2019-01-06T07:34:11.918Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="解决过程："><a href="#解决过程：" class="headerlink" title="解决过程："></a>解决过程：</h3><ol><li><p>生成SSH KEY</p><p>ssh-keygen -t rsa -C “github-qw”</p><p>注意因为在~/.ssh/目录下已经存在id_rsa,因此需要你选择路径时，不能简单的确认，需要输入新的路径名称：我的是：</p><p>~/.ssh/id_rsa_qw</p><p>完成后可以看到自己~/.ssh/目录下的文件：</p><p><img src="/2018/07/20/一台电脑配置多个github账户/image-20180720171329138.png" alt="image-20180720171329138"></p></li><li><p>查看密钥~/.ssh/id_rsa_qw.pub并添加到自己的github SSH-Key</p></li><li><p>打开~/.ssh/config，添加内容，如果为空不影响。</p><p><img src="/2018/07/20/一台电脑配置多个github账户/image-20180720171720674.png" alt="image-20180720171720674"></p></li></ol><ol start="4"><li><p>如果未建立仓库</p><p>此时检查是否成功：</p><p>ssh -T github-qw</p><p>github-qw为ssh-keygen时指定的名称。</p><p><img src="/2018/07/20/一台电脑配置多个github账户/image-20180720172125454.png" alt="image-20180720172125454"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"first commit"</span></span><br><span class="line">git remote add origin git@github-qw:ZhouQiangwei/BT2.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></li><li><p>如果已经存在仓库以及文件，修改替换地址</p><ul><li>查看： git remote -v</li><li>修改： git remote set-url github github-qw</li><li>修改后查看是否连接成功：ssh -T github-qw</li><li>然后可以进行push等操作</li></ul></li><li><p>github账户如果还是显示之前id_rsa密钥账户的话请把你的密钥加入sshAgent代理中</p><p>因为没碰到这部分问题，不做记录，需要可以查看原文章。</p></li></ol><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.jianshu.com/p/12badb7e6c10" target="_blank" rel="noopener">Git 最著名报错 “ERROR: Permission to XXX.git denied to user”终极解决方案</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h3 id=&quot;解决过程：&quot;&gt;&lt;a href=&quot;#解决过程：&quot; class=&quot;headerlink&quot; title=&quot;解决过程：&quot;&gt;&lt;/a&gt;解决过程：&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p
      
    
    </summary>
    
      <category term="GitHub" scheme="https://zhouqiangwei.github.io/categories/GitHub/"/>
    
    
      <category term="GitHub" scheme="https://zhouqiangwei.github.io/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>bs环境</title>
    <link href="https://zhouqiangwei.github.io/2018/07/15/bs%E7%8E%AF%E5%A2%83/"/>
    <id>https://zhouqiangwei.github.io/2018/07/15/bs环境/</id>
    <published>2018-07-15T05:55:54.000Z</published>
    <updated>2019-01-06T07:34:11.909Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>比对：<br>Batmeth2 (git clone <a href="https://github.com/GuoliangLi-HZAU/BatMeth2.git" target="_blank" rel="noopener">https://github.com/GuoliangLi-HZAU/BatMeth2.git</a>)<br>bismark2（<a href="https://www.bioinformatics.babraham.ac.uk/projects/bismark/）" target="_blank" rel="noopener">https://www.bioinformatics.babraham.ac.uk/projects/bismark/）</a>, 依赖 bowtie2<br>bsmap （<a href="https://code.google.com/archive/p/bsmap/）" target="_blank" rel="noopener">https://code.google.com/archive/p/bsmap/）</a><br>bwa-meth （git clone <a href="https://github.com/brentp/bwa-meth.git）" target="_blank" rel="noopener">https://github.com/brentp/bwa-meth.git）</a>, 依赖bwa<br>R (ggplot2/grid/gridExtra/xtable/pheatmap)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;比对：&lt;br&gt;Batmeth2 (git clone &lt;a href=&quot;https://github.com/GuoliangLi-HZAU/BatMeth2.git&quot; ta
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>bayses-possion-mm-etc</title>
    <link href="https://zhouqiangwei.github.io/2018/07/13/bayses-possion-mm-etc/"/>
    <id>https://zhouqiangwei.github.io/2018/07/13/bayses-possion-mm-etc/</id>
    <published>2018-07-13T03:14:48.000Z</published>
    <updated>2019-01-06T07:34:11.907Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="Bayes分布：简单理解为在某条件A下事件B发生的概率。"><a href="#Bayes分布：简单理解为在某条件A下事件B发生的概率。" class="headerlink" title="Bayes分布：简单理解为在某条件A下事件B发生的概率。"></a>Bayes分布：简单理解为在某条件A下事件B发生的概率。</h2><h2 id="贝叶斯网络：每点只与上一点相关，即间接作用不计。贝叶斯网络可以看做是马尔科夫链（Markov）的非线性扩展。"><a href="#贝叶斯网络：每点只与上一点相关，即间接作用不计。贝叶斯网络可以看做是马尔科夫链（Markov）的非线性扩展。" class="headerlink" title="贝叶斯网络：每点只与上一点相关，即间接作用不计。贝叶斯网络可以看做是马尔科夫链（Markov）的非线性扩展。"></a>贝叶斯网络：每点只与上一点相关，即间接作用不计。贝叶斯网络可以看做是马尔科夫链（Markov）的非线性扩展。</h2><p><a href="http://blog.csdn.net/u014593570/article/details/77663897" target="_blank" rel="noopener">http://blog.csdn.net/u014593570/article/details/77663897</a><br><a href="https://www.zhihu.com/question/28006799" target="_blank" rel="noopener">https://www.zhihu.com/question/28006799</a><br><a href="https://zhuanlan.zhihu.com/p/22470375" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22470375</a><br><a href="https://zhuanlan.zhihu.com/p/22455079" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22455079</a><br><a href="http://blog.csdn.net/kl1411/article/details/74079885" target="_blank" rel="noopener">http://blog.csdn.net/kl1411/article/details/74079885</a></p><h2 id="马尔科夫链：每点只与上一点相关，即间接作用不计。"><a href="#马尔科夫链：每点只与上一点相关，即间接作用不计。" class="headerlink" title="马尔科夫链：每点只与上一点相关，即间接作用不计。"></a>马尔科夫链：每点只与上一点相关，即间接作用不计。</h2><p><a href="https://zhuanlan.zhihu.com/p/21570899?refer=c_29122335" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21570899?refer=c_29122335</a><br><a href="http://blog.csdn.net/junli_chen/article/details/50489393" target="_blank" rel="noopener">http://blog.csdn.net/junli_chen/article/details/50489393</a></p><h2 id="泊松分布：泊松分布是二项分布n很大而p很小时的一种极限形式"><a href="#泊松分布：泊松分布是二项分布n很大而p很小时的一种极限形式" class="headerlink" title="泊松分布：泊松分布是二项分布n很大而p很小时的一种极限形式"></a>泊松分布：泊松分布是二项分布n很大而p很小时的一种极限形式</h2><p><a href="https://www.zhihu.com/question/26441147" target="_blank" rel="noopener">https://www.zhihu.com/question/26441147</a></p><h2 id="高斯分布：平均值与方差"><a href="#高斯分布：平均值与方差" class="headerlink" title="高斯分布：平均值与方差"></a>高斯分布：平均值与方差</h2><p><a href="https://zhuanlan.zhihu.com/p/22541620" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22541620</a></p><h2 id="冥律分布：长尾分布，幂律分布最显著的特征是它的长尾，表示那些在高斯分布下的微小概率事件并非那样罕见。例如本分之20-的人掌握世界大部分财富典型的例子。"><a href="#冥律分布：长尾分布，幂律分布最显著的特征是它的长尾，表示那些在高斯分布下的微小概率事件并非那样罕见。例如本分之20-的人掌握世界大部分财富典型的例子。" class="headerlink" title="冥律分布：长尾分布，幂律分布最显著的特征是它的长尾，表示那些在高斯分布下的微小概率事件并非那样罕见。例如本分之20%的人掌握世界大部分财富典型的例子。"></a>冥律分布：长尾分布，幂律分布最显著的特征是它的长尾，表示那些在高斯分布下的微小概率事件并非那样罕见。例如本分之20%的人掌握世界大部分财富典型的例子。</h2><p><a href="https://zhuanlan.zhihu.com/p/22541620" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22541620</a></p><h2 id="二项分布，几何分布，超几合分布："><a href="#二项分布，几何分布，超几合分布：" class="headerlink" title="二项分布，几何分布，超几合分布："></a>二项分布，几何分布，超几合分布：</h2><p><a href="https://www.zhihu.com/question/26441147" target="_blank" rel="noopener">https://www.zhihu.com/question/26441147</a><br><a href="https://www.zhihu.com/question/38191693" target="_blank" rel="noopener">https://www.zhihu.com/question/38191693</a></p><h2 id="beta分布："><a href="#beta分布：" class="headerlink" title="beta分布："></a>beta分布：</h2><p><a href="https://www.zhihu.com/question/30269898" target="_blank" rel="noopener">https://www.zhihu.com/question/30269898</a></p>]]></content>
    
    <summary type="html">
    
      常见统计分布资料整理，包含Bayes, Markov, Possion 分布, Gaussian 分布, Pow-law (冥律分布), 二项分布, beta 分布, 几何分布, 以及Hypergeometric (超几合分布)
    
    </summary>
    
      <category term="MathStatics" scheme="https://zhouqiangwei.github.io/categories/MathStatics/"/>
    
    
      <category term="Bayes" scheme="https://zhouqiangwei.github.io/tags/Bayes/"/>
    
      <category term="Markov" scheme="https://zhouqiangwei.github.io/tags/Markov/"/>
    
      <category term="Possion" scheme="https://zhouqiangwei.github.io/tags/Possion/"/>
    
      <category term="Gaussian" scheme="https://zhouqiangwei.github.io/tags/Gaussian/"/>
    
      <category term="Pow-law (冥律分布)" scheme="https://zhouqiangwei.github.io/tags/Pow-law-%E5%86%A5%E5%BE%8B%E5%88%86%E5%B8%83/"/>
    
      <category term="beta" scheme="https://zhouqiangwei.github.io/tags/beta/"/>
    
      <category term="Hypergeometric (超几合)" scheme="https://zhouqiangwei.github.io/tags/Hypergeometric-%E8%B6%85%E5%87%A0%E5%90%88/"/>
    
  </entry>
  
  <entry>
    <title>shortmem</title>
    <link href="https://zhouqiangwei.github.io/2018/07/10/shortmem/"/>
    <id>https://zhouqiangwei.github.io/2018/07/10/shortmem/</id>
    <published>2018-07-10T09:13:49.000Z</published>
    <updated>2019-01-06T07:34:11.915Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1-更改私钥密码"><a href="#1-更改私钥密码" class="headerlink" title="1. 更改私钥密码"></a>1. 更改私钥密码</h2><p>ssh-keygen -f /Users/qiangweizhou/.ssh/id_rsa -p</p><h2 id="2-warning-LF-will-be-replaced-by-CRLF-in-tags-Others-index-html"><a href="#2-warning-LF-will-be-replaced-by-CRLF-in-tags-Others-index-html" class="headerlink" title="2. warning: LF will be replaced by CRLF in tags/Others/index.html."></a>2. warning: LF will be replaced by CRLF in tags/Others/index.html.</h2><p>git config core.autocrlf false</p><h2 id="3-error-The-following-untracked-working-tree-files-would-be-overwritten-by-me"><a href="#3-error-The-following-untracked-working-tree-files-would-be-overwritten-by-me" class="headerlink" title="3. error: The following untracked working tree files would be overwritten by me"></a>3. error: The following untracked working tree files would be overwritten by me</h2><ol><li>本地覆盖服务器<br>git stash<br>git pull<br>git stash pop<br>然后可以使用git diff -w +文件名 来确认代码自动合并的情况.</li><li>服务器覆盖本地<br>2.1 本地电脑修改<br>  git reset –hard<br>  git pull<br>2.2 变动内容为其他客户端修改<br>  git reset –hard HEAD<br>  git clean -f -d<br>  git pull </li></ol><h2 id="4-win-unix-mac文件格式转换"><a href="#4-win-unix-mac文件格式转换" class="headerlink" title="4. win, unix, mac文件格式转换"></a>4. win, unix, mac文件格式转换</h2><ul><li>win: 0D0A</li><li>unix: 0A</li><li>mac: 0D<br>vi 修改： set ff=unix or doc</li></ul><h2 id="5-PPT-word高亮code"><a href="#5-PPT-word高亮code" class="headerlink" title="5. PPT/word高亮code"></a>5. PPT/word高亮code</h2><p>MAC:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install highlight</span><br><span class="line">highlight -l -O rtf test.sh | pbcopy</span><br></pre></td></tr></table></figure></p><p>test.sh是输入文件，pbcopy是复制到剪切板<br>然后按格式复制到PPT</p><h2 id="6-win自动拨号上网"><a href="#6-win自动拨号上网" class="headerlink" title="6. win自动拨号上网"></a>6. win自动拨号上网</h2><ol><li>通过添加命令行Rasdial ADSL 你的帐号 你的密码，或者建立快捷方式到启动文件夹。但是这种方式是开始启动，断号后却不会尝试拨号，不是我想要的。所以选择饭软件：</li><li>拨号软件：<br><code>http://soft.hao123.com/soft/appid/7993.html</code><br>优势是可以断网后重新尝试拨号。</li></ol><h2 id="7-R-levels-变量-gt-null"><a href="#7-R-levels-变量-gt-null" class="headerlink" title="7. R levels(变量) &gt; null"></a>7. R levels(变量) &gt; null</h2><p>可能变量内容为数值。修改如下：<br><code>levels(as.factor(变量))</code></p><h2 id="8-error-src-refspec-master-does-not-match-any"><a href="#8-error-src-refspec-master-does-not-match-any" class="headerlink" title="8. error: src refspec master does not match any."></a>8. error: src refspec master does not match any.</h2><h2 id="error-failed-to-push-some-refs-to-39-git-github-com-hahaha-user-git’"><a href="#error-failed-to-push-some-refs-to-39-git-github-com-hahaha-user-git’" class="headerlink" title="error: failed to push some refs to &#39;git@github.com:hahaha/user.git’"></a>error: failed to push some refs to <a href="mailto:&#39;git@github.com" target="_blank" rel="noopener">&#39;git@github.com</a>:hahaha/user.git’</h2><p>本地仓库为空<br>需要运行git add .</p><h2 id="9-sublime-text-缩进-注释"><a href="#9-sublime-text-缩进-注释" class="headerlink" title="9. sublime text 缩进 注释"></a>9. sublime text 缩进 注释</h2><p>多行选中后：<br>注释以及去掉注释： command+/<br>删除左端tab： command+[<br>添加tab： command+]</p><h2 id="10-c-pthread-lpthread"><a href="#10-c-pthread-lpthread" class="headerlink" title="10. c++ pthread lpthread"></a>10. c++ pthread lpthread</h2><p>POSIX线程（POSIX threads），简称Pthreads，是线程的POSIX标准。该标准定义了创建和操纵线程的一整套API。在类Unix操作系统（Unix、Linux、Mac OS X等）中，都使用Pthreads作为操作系统的线程。 </p><p><code>pthread</code>是<code>linux</code>下的线程库，用了多线程就要链接这个库，这时候要在编译选项上增加<code>-pthread</code>或者<code>-lpthread</code></p><p><code>-pthread</code>选项对 预处理器和链接器起作用<br>而老式的<code>-lpthread</code>只对链接器起作用<br>推荐使用<code>-pthread</code></p><h2 id="11-github-delete-file"><a href="#11-github-delete-file" class="headerlink" title="11. github delete file"></a>11. github delete file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add -A</span><br></pre></td></tr></table></figure><p>它能stages所有文件，而之前用的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure><p>只能stages新文件和被修改文件，没有被删除文件</p><h2 id="12-github-删除本地-git"><a href="#12-github-删除本地-git" class="headerlink" title="12. github 删除本地.git"></a>12. github 删除本地.git</h2><p><code>git remote -v</code> to get your github-uri.</p><p>Step 1: remove all history</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf .git</span><br></pre></td></tr></table></figure><p>Step 2: reconstruct the Git repo with only the current content</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br></pre></td></tr></table></figure><p>Step 3: push to GitHub.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;github-uri&gt;</span><br><span class="line">git push -u --force origin master</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/wlchn/article/details/52470670" target="_blank" rel="noopener">链接</a></p><h2 id="13-一篇文章多个categories"><a href="#13-一篇文章多个categories" class="headerlink" title="13. 一篇文章多个categories"></a>13. 一篇文章多个categories</h2><h3 id="子分类"><a href="#子分类" class="headerlink" title="子分类"></a>子分类</h3><p>如果想将分章放到 <code>A/B</code>这个分类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line">  - A</span><br><span class="line">  - B</span><br></pre></td></tr></table></figure><p>也可以这样实现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">categories: [A, B]</span><br></pre></td></tr></table></figure><h3 id="多个分类"><a href="#多个分类" class="headerlink" title="多个分类"></a>多个分类</h3><p>如果想要A、B两类平行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line">  - [A]</span><br><span class="line">  - [B]</span><br></pre></td></tr></table></figure><p>或者想放在A/a以及B类下：<code>A/a</code> 和 <code>B</code> ：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line">  - [A, a]</span><br><span class="line">  - [B]</span><br></pre></td></tr></table></figure><h2 id="14-kill-screen"><a href="#14-kill-screen" class="headerlink" title="14. kill screen"></a>14. kill screen</h2><p>1、使用screen名字，kill掉。</p><p>​      screen -S session_name -X quit</p><p>2、激活screen：</p><p>​     screen -r session_name</p><p>​    输入exit退出并kiil掉session。</p><h2 id="15-git-error"><a href="#15-git-error" class="headerlink" title="15. git error"></a>15. git error</h2><h3 id="fatal-remote-origin-already-exists"><a href="#fatal-remote-origin-already-exists" class="headerlink" title="fatal: remote origin already exists."></a>fatal: remote origin already exists.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[11:24:23] qwzhou@login:~/software/BSsnpscan : </span><br><span class="line">$ git remote add origin git@github-qw:ZhouQiangwei/BSNPS.git</span><br><span class="line">fatal: remote origin already exists.</span><br><span class="line">[11:25:33] qwzhou@login:~/software/BSsnpscan : </span><br><span class="line">$ git remote rm origin</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      一些比较short的信息，不足以开一篇文章，但是足以需要记录下来的信息
    
    </summary>
    
      <category term="Others" scheme="https://zhouqiangwei.github.io/categories/Others/"/>
    
    
      <category term="Others" scheme="https://zhouqiangwei.github.io/tags/Others/"/>
    
  </entry>
  
  <entry>
    <title>ROC plot</title>
    <link href="https://zhouqiangwei.github.io/2018/07/10/ROCplot/"/>
    <id>https://zhouqiangwei.github.io/2018/07/10/ROCplot/</id>
    <published>2018-07-10T07:36:49.000Z</published>
    <updated>2019-01-06T07:34:11.905Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="roc-curve"><a href="#roc-curve" class="headerlink" title="roc curve"></a>roc curve</h2><h3 id="file-format"><a href="#file-format" class="headerlink" title="file format:"></a>file format:</h3><blockquote><p>xvalue yvalue categories<br>…    …    …</p></blockquote><h3 id="R-code"><a href="#R-code" class="headerlink" title="R code"></a>R code</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">a&lt;-read.table(<span class="string">"C:\\Users\\qwzhou\\Desktop\\bt2\\text.txt"</span>)</span><br><span class="line">ggplot(a,aes(a$V2, a$V1)) + geom_line(aes(color=a$V3)) + scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>)) + geom_point(aes(shape=a$V3,color=a$V3)) + xlim(<span class="number">0</span>,<span class="number">20000</span>) + xlab(<span class="string">"Discordant"</span>) + ylab(<span class="string">"Concordant"</span>) + ggtitle(<span class="string">"plot title"</span>) + theme_bw() + theme(legend.position=<span class="string">'none'</span>) + theme(panel.grid =element_blank())</span><br><span class="line"><span class="comment">##散点 fileformat: case xvalue yvalue</span></span><br><span class="line">ggplot(a,aes(a$V3, a$V2)) + scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>)) + geom_point(aes(shape=a$V1,color=a$V4)) + xlim(<span class="number">0</span>,<span class="number">7000</span>) + xlab(<span class="string">"Discordant"</span>) + ylab(<span class="string">"Concordant"</span>) + ggtitle(<span class="string">"75bp simulate Illumina (1 Million)"</span>) + theme_bw() + theme(legend.position=<span class="string">'none'</span>)</span><br><span class="line"><span class="comment">##shape color</span></span><br><span class="line">ggplot(a,aes(a$V3, a$V2)) + scale_shape_manual(values=c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)) + geom_point(aes(shape=a$V4,color=a$V1)) + xlim(<span class="number">0</span>,<span class="number">7000</span>) + xlab(<span class="string">"Discordant"</span>) + ylab(<span class="string">"Concordant"</span>) + ggtitle(<span class="string">"75bp simulate Illumina (1 Million)"</span>) + theme_bw() + theme(legend.position=<span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><h3 id="results"><a href="#results" class="headerlink" title="results:"></a>results:</h3><p><img src="/2018/07/10/ROCplot/roc.png" alt="roc curve"></p><h3 id="point-results"><a href="#point-results" class="headerlink" title="point results"></a>point results</h3><p><img src="/2018/07/10/ROCplot/roc2.png" alt="roc curve2"></p><p>#未完…</p>]]></content>
    
    <summary type="html">
    
      R画图代码整合
    
    </summary>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/categories/visualization/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/visualization/R/"/>
    
    
      <category term="R" scheme="https://zhouqiangwei.github.io/tags/R/"/>
    
      <category term="ggplot2" scheme="https://zhouqiangwei.github.io/tags/ggplot2/"/>
    
      <category term="visualization" scheme="https://zhouqiangwei.github.io/tags/visualization/"/>
    
  </entry>
  
  <entry>
    <title>text2html and check R package and install</title>
    <link href="https://zhouqiangwei.github.io/2018/07/10/text2html/"/>
    <id>https://zhouqiangwei.github.io/2018/07/10/text2html/</id>
    <published>2018-07-10T07:10:04.000Z</published>
    <updated>2019-01-06T07:34:11.916Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="R代码"><a href="#R代码" class="headerlink" title="R代码"></a>R代码</h2><blockquote><ul><li style="list-style: none"><input type="checkbox" checked> args[1]: workdir</li><li style="list-style: none"><input type="checkbox" checked> args[2]: input_prefix</li><li style="list-style: none"><input type="checkbox" checked> args[3]: textfile</li></ul></blockquote><figure class="highlight r"><figcaption><span>text2html.r</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">options(warn = -<span class="number">1</span>)</span><br><span class="line">args &lt;- commandArgs(trailingOnly = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#program_dir &lt;- args[1]</span></span><br><span class="line">setwd(args[<span class="number">1</span>])</span><br><span class="line">input_prefix &lt;- args[<span class="number">2</span>]</span><br><span class="line">convertfile &lt;- args[<span class="number">3</span>]</span><br><span class="line">output_dir &lt;- paste(args[<span class="number">1</span>], <span class="string">"/bt2_report_"</span>, input_prefix,<span class="string">"/images/"</span>, sep = <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##Check if necessary libraries are installed </span></span><br><span class="line">check_pkg &lt;- <span class="keyword">function</span>(pkg) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">    print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is loaded correctly"</span>, sep = <span class="string">" "</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    print(paste(<span class="string">"Trying to install package"</span>, pkg, sep = <span class="string">" "</span>))</span><br><span class="line">    install.packages(pkg, repos=<span class="string">"http://cran.us.r-project.org"</span>, dep = <span class="literal">TRUE</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">      print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is installed and loaded correctly"</span>, sep = <span class="string">""</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      install.packages(pkg, repos=<span class="string">"http://cran.rstudio.com/"</span>, dep = <span class="literal">TRUE</span>)</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">require</span>(pkg, character.only = <span class="literal">TRUE</span>))&#123;</span><br><span class="line">        print(paste(<span class="string">"Package"</span>, pkg, <span class="string">"is installed and loaded correctly"</span>, sep = <span class="string">""</span>))</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">stop</span>(paste(<span class="string">"Couldn't install package"</span>, pkg, sep = <span class="string">" "</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">check_pkg(<span class="string">"xtable"</span>)</span><br><span class="line"><span class="comment">#check_pkg("RCircos")</span></span><br><span class="line"><span class="comment">#check_pkg("grid")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install.packages("xtable", repos = "http://cran.us.r-project.org", dep = TRUE)</span></span><br><span class="line"><span class="keyword">library</span>(xtable)</span><br><span class="line">filename&lt;- convertfile</span><br><span class="line">a&lt;-read.table(paste(output_dir, filename, sep=<span class="string">""</span>), header=<span class="literal">T</span>, sep=<span class="string">"\t"</span>)</span><br><span class="line"><span class="comment">##</span></span><br><span class="line">c &lt;- xtable(a, align = c(<span class="string">"c"</span>, <span class="string">"c"</span>, <span class="string">"c"</span>))</span><br><span class="line">header&lt;-<span class="string">"&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=\"en-US\"&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=\"UTF-8\"&gt;</span></span><br><span class="line"><span class="string">&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"../style.css\" media=\"all\" /&gt;"</span></span><br><span class="line">write(header, file=paste(output_dir, gsub(<span class="string">"txt"</span>,<span class="string">""</span>,filename), <span class="string">"html"</span>, sep = <span class="string">""</span>))</span><br><span class="line">print(c, type=<span class="string">'html'</span>, file=paste(output_dir, gsub(<span class="string">"txt"</span>,<span class="string">""</span>,filename), <span class="string">"html"</span>, sep = <span class="string">""</span>), include.rownames = <span class="literal">F</span>, append = <span class="literal">T</span>, html.table.attributes = <span class="string">"class = 'mytable'"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      1, 将文本文件中列表转换为html table。2, 检查是否已经安装R包，若没安装则install。
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/R/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="R" scheme="https://zhouqiangwei.github.io/tags/R/"/>
    
      <category term="check package" scheme="https://zhouqiangwei.github.io/tags/check-package/"/>
    
      <category term="text2html" scheme="https://zhouqiangwei.github.io/tags/text2html/"/>
    
  </entry>
  
  <entry>
    <title>Sublime Text3配置Markdown编辑以及预览</title>
    <link href="https://zhouqiangwei.github.io/2018/07/06/sublime-Text%E9%85%8D%E7%BD%AEMarkdown%E7%BC%96%E8%BE%91/"/>
    <id>https://zhouqiangwei.github.io/2018/07/06/sublime-Text配置Markdown编辑/</id>
    <published>2018-07-06T11:52:00.000Z</published>
    <updated>2019-01-06T07:34:11.916Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="安装Package-Control"><a href="#安装Package-Control" class="headerlink" title="安装Package Control"></a>安装Package Control</h2><ul><li>快捷键 control (Mac下command) + shift + p， 当然也可以通过菜单栏 Preferences -&gt; Package Control</li><li>选择 Package Control:Install Package安装完重启sublime Text</li></ul><h2 id="配置Markdown"><a href="#配置Markdown" class="headerlink" title="配置Markdown"></a>配置Markdown</h2><ul><li>control (Mac下command) + shift + p 调出package管理平台，选择 Package Control:Install Package 后输入Markdown Editing 后确认，安装过程左下角会有提示。</li><li>Markdown预览： control (Mac下command) + shift + p后选择 Package Control:Install Package 后输入 Markdown Preview:Preview in Browser</li></ul><h2 id="通过md文件实现自动更新"><a href="#通过md文件实现自动更新" class="headerlink" title="通过md文件实现自动更新"></a>通过md文件实现自动更新</h2><ul><li>据说可以通过Auto-save实现自动更新，但是没有实际应用过，感兴趣的可以自己尝试。</li><li><p>我平时用的方法是在编辑的文件最后加上：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"5"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>5是每5s时间浏览器刷新，时间可以根据个人目前修改频率调整。文档编辑成功之后建议删掉该命令，否则打开网页会一直在刷新。</p></li></ul>]]></content>
    
    <summary type="html">
    
      Sublime Text3配置Markdown编辑以及预览 (Mac, win通用)
    
    </summary>
    
      <category term="编辑工具" scheme="https://zhouqiangwei.github.io/categories/%E7%BC%96%E8%BE%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Sublime Text" scheme="https://zhouqiangwei.github.io/tags/Sublime-Text/"/>
    
      <category term="Markdown" scheme="https://zhouqiangwei.github.io/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>第一篇个人博客</title>
    <link href="https://zhouqiangwei.github.io/2018/07/05/whyBuildThisBlogWeb/"/>
    <id>https://zhouqiangwei.github.io/2018/07/05/whyBuildThisBlogWeb/</id>
    <published>2018-07-05T12:27:00.000Z</published>
    <updated>2019-01-06T07:34:11.916Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="为什么建立这个博客"><a href="#为什么建立这个博客" class="headerlink" title="为什么建立这个博客"></a>为什么建立这个博客</h2><ul><li>建立这个博客的初衷呢自己也说不清楚，无法避免的重要原因必然是理工觉得很酷啊、炫。</li><li>个人方面，主要想让自己养成一个习惯。平时接触到好的网站好的书好的信息资源非常多，经常随手收藏或者记在脑子里（当时真的记下了）这里有个很好的知识点/资源，以后有时间回来看。N天后甚至N月后遇到一个问题，既得肯定遇到过这个问题的解决方案或者类似的原理，哇塞 怎么去找呢，我记得保存到收藏夹里了，嗯 😄找出手机来发现，😅前几天手机内存不足格式化了（发一下牢骚，手机不能买16g的，存储空间完全不够用去掉系统软件后只有1～2g，还是经常清理的结果)。或者既得好像是哪本书？类似的问题。。。，总之，希望自己能坚持整理文档的习惯。</li><li>除了没有保存的内容外，存下来的内容也没有规律的收录在一起，找起来非常麻烦，自己去找都犯愁的地步，有时候想着把自己放到我收录的所有信息文件中，必须找到某一个知识点才能出来，第一感觉是头疼。😄</li><li>总之，希望自己多学习</li></ul><h2 id="博客的内容"><a href="#博客的内容" class="headerlink" title="博客的内容"></a>博客的内容</h2><ol><li>自己遇到问题的解决思路方法。</li><li>学到的非常有意义新的内容。</li><li>转载的好的文章或者教程</li><li>个人生活</li></ol>]]></content>
    
    <summary type="html">
    
      why have this blog
    
    </summary>
    
      <category term="个人" scheme="https://zhouqiangwei.github.io/categories/%E4%B8%AA%E4%BA%BA/"/>
    
    
      <category term="博客" scheme="https://zhouqiangwei.github.io/tags/%E5%8D%9A%E5%AE%A2/"/>
    
      <category term="个人" scheme="https://zhouqiangwei.github.io/tags/%E4%B8%AA%E4%BA%BA/"/>
    
  </entry>
  
  <entry>
    <title>GitHub pages与hexo建立个人博客</title>
    <link href="https://zhouqiangwei.github.io/2018/07/05/github%20pages%E5%92%8Chexo%E5%BB%BA%E7%AB%8B%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    <id>https://zhouqiangwei.github.io/2018/07/05/github pages和hexo建立个人博客/</id>
    <published>2018-07-05T12:27:00.000Z</published>
    <updated>2019-01-06T07:34:11.910Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="具体搭建博客过程网上非常多的教程，不再复述了，以下为挑选的几个教程，可以参照："><a href="#具体搭建博客过程网上非常多的教程，不再复述了，以下为挑选的几个教程，可以参照：" class="headerlink" title="具体搭建博客过程网上非常多的教程，不再复述了，以下为挑选的几个教程，可以参照："></a>具体搭建博客过程网上非常多的教程，不再复述了，以下为挑选的几个教程，可以参照：</h2><ul><li><a href="https://blog.csdn.net/yanzi1225627/article/details/54566792" target="_blank" rel="noopener">Mac平台打造github上hexo博客全过程</a></li><li><a href="https://www.jianshu.com/p/13e64c9e2295" target="_blank" rel="noopener">Mac上搭建基于GitHub的Hexo博客</a></li><li><a href="https://www.jianshu.com/p/4ef35521fee9" target="_blank" rel="noopener">Hexo-Next-主题优化</a></li><li><a href="https://blog.csdn.net/com_ma/article/details/76039859" target="_blank" rel="noopener">hexo博客的背景设置</a></li><li><a href="https://www.jianshu.com/p/76ce3729746d" target="_blank" rel="noopener">hexo高阶教程：next主题优化之加入网易云音乐、网易云跟帖、炫酷动态背景、自定义样式，打造属于你自己的定制化博客</a></li><li><a href="https://blog.csdn.net/sugar_rainbow/article/details/57415705" target="_blank" rel="noopener">hexo生成博文插入图片</a></li><li><a href="https://blog.csdn.net/jyt11112/article/details/72770090" target="_blank" rel="noopener">浏览器是如何使你的http网址变成https的</a></li><li><a href="https://fontawesome.com/icons?from=io" target="_blank" rel="noopener">Font Awesome Icons</a></li><li><a href="https://blog.csdn.net/qq_33699981/article/details/72716951" target="_blank" rel="noopener">hexo的next主题个性化教程：打造炫酷网站</a></li><li><a href="https://www.2cto.com/kf/201711/696383.html" target="_blank" rel="noopener">next的自动更新背景图片实现方法及效果图展示</a></li><li><a href="https://source.unsplash.com/" target="_blank" rel="noopener">随机图片-可以做背景</a></li><li><a href="https://www.jianshu.com/p/191d1e21f7ed" target="_blank" rel="noopener">markdown基本语法</a></li><li><a href="https://blog.csdn.net/sunshine940326/article/details/69933696" target="_blank" rel="noopener">hexo+next主题优化之加入网易云音乐、网易云跟帖、炫酷动态背景</a></li><li><a href="https://blog.csdn.net/wangxw725/article/details/71602256?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="noopener">Hexo添加字数统计、阅读时长、友情链接</a></li><li><a href="https://blog.csdn.net/willxue123/article/details/50994852" target="_blank" rel="noopener">Hexo系列教程之三：next主题的配置和优化</a></li><li><a href="https://blog.csdn.net/u010937230/article/details/77925643" target="_blank" rel="noopener">Hexo next主题搭建静态博客埋坑记录</a></li></ul><p>以上内容涉及方面非常全面了。</p><h2 id="修改的内容"><a href="#修改的内容" class="headerlink" title="修改的内容"></a>修改的内容</h2><p>自己做的修改地方, 不是很喜欢sliderbar上的纯黑色背景，修改为背景图。<br>修改前：</p><p><center><br><img src="/2018/07/05/github pages和hexo建立个人博客/nobackgroud.png" width="256" height="300"><br>黑色背景</center></p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>修改后：<br><img src="/2018/07/05/github pages和hexo建立个人博客/headerbackgroud.png" width="256" height="300"><br>添加背景后</p><p>修改内容：<br>打开<code>themes/next/source/css/_custom/custom.styl</code>， 添加一下内容：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.site-meta</span> &#123;</span><br><span class="line">    background:url(/images/headerbackground.jpg); //#3090e4</span><br><span class="line">    <span class="selector-tag">background-repeat</span>: <span class="selector-tag">no-repeat</span>;</span><br><span class="line">    <span class="selector-tag">background-size</span>: <span class="selector-tag">cover</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.brand</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#3090e4</span></span><br><span class="line">    ::selection &#123;</span><br><span class="line">        color: <span class="built_in">rgb</span>(199, 131, 255) //<span class="number">#ff00a3ba</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.brand</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#3090e4</span></span><br><span class="line">    ::selection &#123;</span><br><span class="line">        color: <span class="built_in">rgb</span>(199, 131, 255) //<span class="number">#ff00a3ba</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.brand</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ff00a3ba</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-subtitle</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#f573b1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-subtitle</span><span class="selector-pseudo">::selection</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#7b9cde</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      GitHub pages与hexo建立个人博客的过程以及碰到的问题 （Mac系统）
    
    </summary>
    
      <category term="博客" scheme="https://zhouqiangwei.github.io/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
      <category term="博客" scheme="https://zhouqiangwei.github.io/tags/%E5%8D%9A%E5%AE%A2/"/>
    
      <category term="GitHub" scheme="https://zhouqiangwei.github.io/tags/GitHub/"/>
    
      <category term="hexo" scheme="https://zhouqiangwei.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>BisSNP分析BS-seq数据检测SNP</title>
    <link href="https://zhouqiangwei.github.io/2018/07/05/BisSNP/"/>
    <id>https://zhouqiangwei.github.io/2018/07/05/BisSNP/</id>
    <published>2018-07-05T12:27:00.000Z</published>
    <updated>2019-01-06T07:34:11.903Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="运行BisSNP检测SNP"><a href="#运行BisSNP检测SNP" class="headerlink" title="运行BisSNP检测SNP"></a>运行BisSNP检测SNP</h2><p>使用BisSNP检测SNP相对BS-SNPer来说，需要运行多步操作，过程类似GATK，当然实际上该软件确实使用了GATK。<br>但是福利来了，在提供jar文件的同时，提供了BisSNP_Utils/，其中包含一键式文件bissnp_easy_usage.pl<br><img src="/2018/07/05/BisSNP/utils.png" alt="BisSNP_Utils"></p><p>但是运行该文件需要dbSNP数据<br><img src="/2018/07/05/BisSNP/bissnp_easy_usage.png" alt="bissnp_easy_usage"></p><h3 id="因此首先下载vcf数据。"><a href="#因此首先下载vcf数据。" class="headerlink" title="因此首先下载vcf数据。"></a>因此首先下载vcf数据。</h3><p>来源GATK： <a href="https://software.broadinstitute.org/gatk/download/bundle" target="_blank" rel="noopener">https://software.broadinstitute.org/gatk/download/bundle</a><br>基因组：hg38<br>SNP version：146</p><p>下载链接：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz.tbi</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/dbsnp_146.hg38.vcf.gz</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/dbsnp_146.hg38.vcf.gz.tbi</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/hapmap_3.3.hg38.vcf.gz</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/hapmap_3.3.hg38.vcf.gz.tbi</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/hapmap_3.3_grch38_pop_stratified_af.vcf.gz</span><br><span class="line">ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/wgs_calling_regions.hg38.interval_list</span><br></pre></td></tr></table></figure></p><p>下载后需要保证vcf的染色体排序与参考基因组一致，否则报错。</p><h3 id="按照基因组顺序排序vcf文件"><a href="#按照基因组顺序排序vcf文件" class="headerlink" title="按照基因组顺序排序vcf文件"></a>按照基因组顺序排序vcf文件</h3><figure class="highlight bash"><figcaption><span>run.sortsnv.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">input=<span class="variable">$1</span></span><br><span class="line">out=<span class="variable">$2</span></span><br><span class="line">chr_order=<span class="string">"chrM\nchr1\nchr2\nchr3\nchr4\nchr5\nchr6\nchr7\nchr8\nchr9\nchr10\nchr11\nchr12\nchr13\nchr14\nchr15\nchr16\nchr17\nchr18\nchr19\nchr20\nchr21\nchr22\nchrY\nchrX"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#echo -e $chr_order | while read line</span></span><br><span class="line"><span class="comment">#do</span></span><br><span class="line"><span class="comment">#    echo $line</span></span><br><span class="line"><span class="comment">#done</span></span><br><span class="line"></span><br><span class="line">cat <span class="variable">$input</span> | grep <span class="string">"^#"</span> &gt; .header.vcf</span><br><span class="line">cat <span class="variable">$input</span> | grep -v <span class="string">"^#"</span> | sort -k1,1 -k2,2n &gt; .pre.sorted.vcf</span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$chr_order</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cat .pre.sorted.vcf | grep <span class="string">"^<span class="variable">$line</span>"</span>$<span class="string">'\t'</span> &gt;&gt; .header.vcf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">mv .header.vcf  <span class="variable">$&#123;out&#125;</span> &amp;&amp; rm .pre.sorted.vcf</span><br></pre></td></tr></table></figure><p>运行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh run.sort.sh dbsnp_146.hg38.vcf dbsnp_146.hg38.sort.vcf</span><br></pre></td></tr></table></figure></p><h3 id="运行bissnp-easy-usage-pl检测snp"><a href="#运行bissnp-easy-usage-pl检测snp" class="headerlink" title="运行bissnp_easy_usage.pl检测snp"></a>运行bissnp_easy_usage.pl检测snp</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl ~/software/BisSNP_Utils/bissnp_easy_usage.pl --mmq 20 ~/software/BisSNP-1.0.0.jar wgbs.md.sort.bam ~/practice/Genome/hg38/hg38.chr.fa ~/practice/Genome/hg38/dbsnp_146.hg38.sort.vcf</span><br></pre></td></tr></table></figure><p>可以安心等待结果，若程序中间报错，会返回更新。<br>–mmq 20是可用reads的比对分值，20足够了认为。</p><h2 id="程序报错："><a href="#程序报错：" class="headerlink" title="程序报错："></a>程序报错：</h2><h3 id="ERROR：Invalid-command-line-Failed-to-load-reference-dictionary"><a href="#ERROR：Invalid-command-line-Failed-to-load-reference-dictionary" class="headerlink" title="ERROR：Invalid command line: Failed to load reference dictionary"></a>ERROR：Invalid command line: Failed to load reference dictionary</h3><p>因此建立genome index<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ~/software/picard-tools-1.119/CreateSequenceDictionary.jar REFERENCE=hg38.chr.fa OUTPUT=hg38.chr.dict</span><br></pre></td></tr></table></figure></p><p><strong>注意生成的文件是hg38.chr.dict，而不是hg38.chr.fa.dict </strong></p><h3 id="注意如果bam文件与参考基因组文件染色体数目不一致，需要运行ReorderSam校正："><a href="#注意如果bam文件与参考基因组文件染色体数目不一致，需要运行ReorderSam校正：" class="headerlink" title="注意如果bam文件与参考基因组文件染色体数目不一致，需要运行ReorderSam校正："></a>注意如果bam文件与参考基因组文件染色体数目不一致，需要运行ReorderSam校正：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ~/software/picard-tools-1.119/ReorderSam.jar I=wgbs.rm.bam O=wgbs.fixRef.bam R=~/practice/Genome/hg38/hg38.chr.fa ALLOW_INCOMPLETE_DICT_CONCORDANCE=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="重新运行后依旧报错：ReplaceReadGroups-to-fix-this-problem"><a href="#重新运行后依旧报错：ReplaceReadGroups-to-fix-this-problem" class="headerlink" title="重新运行后依旧报错：ReplaceReadGroups to fix this problem"></a>重新运行后依旧报错：ReplaceReadGroups to fix this problem</h3><p>因此运行程序：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ~/software/picard-tools-1.119/AddOrReplaceReadGroups.jar I=wgbs.md.sort.bam O=wgbs.md.replace.bam SORT_ORDER=coordinate RGPL=Illumina CREATE_INDEX=True RGLB=LaneX RGPU=NONE RGSM=SAMPLENAME</span><br></pre></td></tr></table></figure></p><h2 id="重新运行BisSNP"><a href="#重新运行BisSNP" class="headerlink" title="重新运行BisSNP"></a>重新运行BisSNP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl ~/software/BisSNP_Utils/bissnp_easy_usage.pl --mmq 20 ~/software/BisSNP-0.82.2.jar wgbs.md.replace.bam ~/practice/Genome/hg38/hg38.chr.fa ~/practice/Genome/hg38/dbsnp_146.hg38.sort.vcf</span><br></pre></td></tr></table></figure><h2 id="如果去冗余，则需要添加参数"><a href="#如果去冗余，则需要添加参数" class="headerlink" title="如果去冗余，则需要添加参数"></a>如果去冗余，则需要添加参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl ./BisSNP_Utils/bissnp_easy_usage.pl --duplicate ~/software/picard-tools-1.119/ -nt 8 --mmq 20 ./BisSNP-1.0.0.jar wgbs.new.replace.bam ../hg38/bowtie2_chr_index/hg38.chr.fa ./dbsnp_146.hg38.sort.vcf</span><br></pre></td></tr></table></figure><p>=======</p><h2 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">input=$<span class="number">1</span></span><br><span class="line">SAMPLE=$<span class="number">2</span></span><br><span class="line">java -jar ~/software/picard-tools<span class="number">-1.119</span>/AddOrReplaceReadGroups.jar I=$&#123;input&#125; O=wgbs.replace.bam SORT_ORDER=coordinate RGPL=Illumina CREATE_INDEX=True RGLB=LaneX RGPU=NONE RGSM=$&#123;SAMPLE&#125;</span><br><span class="line">java -Xmx10G -jar ~/software/BisSNP<span class="number">-0.82</span><span class="number">.2</span>.jar -R ~/practice/Genome/hg38/hg38.chr.fa -I wgbs.replace.bam -D /<span class="keyword">public</span></span><br><span class="line">~/practice/Genome/hg38/dbsnp_146.hg38.sort.vcf -T BisulfiteGenotyper -vfn1 wgbs.replace.cpg.raw.vcf -vfn2 wgbs.replace.snp.raw.vcf -C CG,<span class="number">1</span> -</span><br><span class="line">C CH,<span class="number">1</span> -out_modes DEFAULT_FOR_TCGA -stand_call_conf <span class="number">20</span> -stand_emit_conf <span class="number">0</span> -nt <span class="number">8</span> -minConv <span class="number">1</span> -vcfCache <span class="number">1000000</span> -mmq <span class="number">20</span> -mbq <span class="number">5</span></span><br><span class="line">perl ~/software/BisSNP_Utils/sortByRefAndCor.pl --k <span class="number">1</span> --c <span class="number">2</span> --tmp ./ wgbs.replace.cpg.raw.vcf ~/practice/Genome/hg3</span><br><span class="line"><span class="number">8</span>/hg38.chr.fa.fai &gt; wgbs.replace.cpg.raw.sort.vcf</span><br><span class="line">java -Xmx10G -jar ~/software/BisSNP<span class="number">-0.82</span><span class="number">.2</span>.jar -R ~/practice/Genome/hg38/hg38.chr.fa -T VCFpostprocess -qual <span class="number">20</span> -C </span><br><span class="line">CG -C CH -oldVcf wgbs.replace.cpg.raw.sort.vcf -snpVcf wgbs.replace.snp.raw.sort.vcf -newVcf wgbs.replace.cpg.filtered.sort.vcf -o wgbs.replace.cpg.fil</span><br><span class="line">tered.sort.vcf.cpgSummary.txt -minCT <span class="number">1</span></span><br><span class="line">java -Xmx10G -jar ~/software/BisSNP<span class="number">-0.82</span><span class="number">.2</span>.jar -R ~/practice/Genome/hg38/hg38.chr.fa -T VCFpostprocess -qual <span class="number">20</span> -C </span><br><span class="line">CG -C CH -oldVcf wgbs.replace.snp.raw.sort.vcf -snpVcf wgbs.replace.snp.raw.sort.vcf -newVcf wgbs.replace.snp.filtered.sort.vcf -o wgbs.replace.snp.fil</span><br><span class="line">tered.sort.vcf.cpgSummary.txt</span><br></pre></td></tr></table></figure><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>9ab464f75714d060237c83716d7871c179cfe0a3</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><ul><li>step 1, download dbsnp: <code>wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/hg38/dbsnp_146.hg38.vcf.gz</code></li><li>step 2, sort vcf: <code>sh run.sort.sh dbsnp_146.hg38.vcf dbsnp_146.hg38.sort.vcf</code></li><li>step 3, ReplaceReadGroups: <code>java -jar ~/software/picard-tools-1.119/AddOrReplaceReadGroups.jar I=wgbs.md.sort.bam O=wgbs.md.replace.bam SORT_ORDER=coordinate RGPL=Illumina CREATE_INDEX=True RGLB=LaneX RGPU=NONE RGSM=SAMPLENAME</code></li><li>step 4, run BisSNP: <code>perl ~/software/BisSNP_Utils/bissnp_easy_usage.pl -nt 8 --mmq 20 ~/software/BisSNP-0.82.2.jar wgbs.md.replace.bam ~/practice/Genome/hg38/hg38.chr.fa ~/practice/Genome/hg38/dbsnp_146.hg38.sort.vcf</code></li></ul><ul><li>注意本地java版本与BisSNP.jar版本，BisSNP-0.82.2.jar需要本地java version &lt; 1.8，BisSNP-1.0.jar则需要本地java版本 &gt; 1.8。</li></ul>]]></content>
    
    <summary type="html">
    
      BisSNP分析BS-seq数据检测SNP过程总结，DNA甲基化数据比对与分析过程就不在此讲述了（可以参见DNA甲基化分析流程软件BatMeth2）。
    
    </summary>
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/"/>
    
      <category term="DNA methylation" scheme="https://zhouqiangwei.github.io/categories/bioinformatics/DNA-methylation/"/>
    
    
      <category term="bioinformatics" scheme="https://zhouqiangwei.github.io/tags/bioinformatics/"/>
    
      <category term="BisSNP" scheme="https://zhouqiangwei.github.io/tags/BisSNP/"/>
    
      <category term="DNA甲基化" scheme="https://zhouqiangwei.github.io/tags/DNA%E7%94%B2%E5%9F%BA%E5%8C%96/"/>
    
      <category term="SNP" scheme="https://zhouqiangwei.github.io/tags/SNP/"/>
    
      <category term="sort vcf" scheme="https://zhouqiangwei.github.io/tags/sort-vcf/"/>
    
  </entry>
  
</feed>
